"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[2403],{2403:(O,T,g)=>{var C,y;C=[g(69749),g(29930),g(49897)],y=function(j,k,v){const f={};let s,l,h={};f.init=function(t){t=t||function(){},!s&&app.parseAndTranslate("modals/merge-topic",{},function(r){s=r,$("body").append(s),l=s.find("#merge_topics_confirm"),s.find("#merge_topics_cancel").on("click",n),$("#content").on("click",'[component="topic/select"]',x),o(),l.on("click",function(){e(l)}),j.enableQuickSearch({searchElements:{inputEl:s.find(".topic-search-input"),resultEl:s.find(".quick-search-container")},searchOptions:{in:"titles"},dropdown:{maxWidth:"400px",maxHeight:"350px"}}),s.on("click","[data-tid]",function(){const c=$(this).attr("data-tid");return c&&f.addTopic(c),!1}),s.on("click","[data-remove-tid]",function(){const c=$(this).attr("data-remove-tid");return c&&f.removeTopic(c),!1}),t()})},f.addTopic=function(t,r){r=r||function(){},v.get(`/topics/${t}`,{}).then(function(c){const a=c?c.title:"No title";h[t]=a,i(),o(),r()}).catch(k.error)},f.removeTopic=function(t){h[t]&&delete h[t],i(),o()};function x(t){if(!s)return;const r=$(this).parents('[component="category/topic"]'),c=r.hasClass("selected"),a=r.attr("data-tid");return c?f.addTopic(a):f.removeTopic(a),t.preventDefault(),t.stopPropagation(),!1}function e(t){t.attr("disabled",!0);const r=Object.keys(h),c={};s.find(".merge-main-topic-radio").is(":checked")?c.mainTid=s.find(".merge-main-topic-select").val():s.find(".merge-new-title-radio").is(":checked")&&(c.newTopicTitle=s.find(".merge-new-title-input").val()),socket.emit("topics.merge",{tids:r,options:c},function(a,u){if(t.removeAttr("disabled"),a)return k.error(a);ajaxify.go("/topic/"+u),n()})}function o(){if(!s)return;const t=Object.keys(h);t.sort(function(c,a){return c-a});const r=t.map(function(c){return{tid:c,title:h[c]}});t.length?app.parseAndTranslate("modals/merge-topic",{config,topics:r},function(c){s.find(".topics-section").html(c.find(".topics-section").html()),s.find(".merge-main-topic-select").html(c.find(".merge-main-topic-select").html())}):(s.find(".topics-section").translateHtml("[[error:no-topics-selected]]"),s.find(".merge-main-topic-select").html(""))}function i(){Object.keys(h).length?l.removeAttr("disabled"):l.attr("disabled",!0)}function n(){s&&(s.remove(),s=null),h={},$("#content").off("click",'[component="topic/select"]',x)}return f}.apply(T,C),y!==void 0&&(O.exports=y)},69749:(O,T,g)=>{var C,y;C=[g(17459),g(68636),g(91749),g(29930),g(89336)],y=function(j,k,v,f,s){const l={current:{}};l.init=function(e){if(!config.searchEnabled)return;e=e||{in:config.searchDefaultInQuick||"titles"},$('[component="search/form"]').each((i,n)=>{h($(n),e)})};function h(e,o){const i=e.find('[component="search/button"]'),n=e.find('[component="search/fields"]'),t=n.find('input[name="query"]'),r=n.find("#quick-search-container");n.hasClass("hidden")&&t.off("blur").on("blur",function(){setTimeout(function(){t.is(":focus")||(n.addClass("hidden"),i.removeClass("hidden"))},200)}),t.off("focus");const a={inputEl:t,resultEl:r};l.enableQuickSearch({searchOptions:o,searchElements:a}),i.off("click").on("click",function(u){return!config.loggedIn&&!app.user.privileges["search:content"]?(f.alert({message:"[[error:search-requires-login]]",timeout:3e3}),ajaxify.go("login"),!1):(u.stopPropagation(),l.showAndFocusInput(e),!1)}),e.off("submit").on("submit",function(){const u=$(this).find('input[name="query"]'),m=l.getSearchPreferences();return m.term=u.val(),m.in=o.in,v.fire("action:search.submit",{searchOptions:m,searchElements:a}),l.query(m,function(){u.val(""),t.trigger("blur")}),!1})}l.enableQuickSearch=function(e){if(!config.searchEnabled||!app.user.privileges["search:content"])return;const o=Object.assign({in:config.searchDefaultInQuick||"titles"},e.searchOptions),i=e.searchElements.resultEl,n=e.searchElements.inputEl;let t=n.val();const r=i.find(".filter-category");function c(){ajaxify.data.template.category&&ajaxify.data.cid&&j.translate("[[search:search-in-category, "+ajaxify.data.name+"]]",function(d){const p=$("<div></div>").html(d).text();r.find(".name").text(p)}),r.toggleClass("hidden",!(ajaxify.data.template.category&&ajaxify.data.cid))}function a(){e.searchOptions=Object.assign({},o),e.searchOptions.term=n.val(),c(),ajaxify.data.template.category&&ajaxify.data.cid&&r.find('input[type="checkbox"]').is(":checked")&&(e.searchOptions.categories=[ajaxify.data.cid],e.searchOptions.searchChildren=!0),e.hideDuringSearch||(i.removeClass("hidden").find(".quick-search-results-container").html(""),i.find(".loading-indicator").removeClass("hidden")),v.fire("action:search.quick.start",e),e.searchOptions.searchOnly=1,l.api(e.searchOptions,function(d){if(i.find(".loading-indicator").addClass("hidden"),!d.posts||e.hideOnNoMatches&&!d.posts.length)return i.addClass("hidden").find(".quick-search-results-container").html("");d.posts.forEach(function(p){const E=$("<div>"+p.content+"</div>").text(),S=n.val().toLowerCase().replace(/^in:topic-\d+/,""),b=Math.max(0,E.toLowerCase().indexOf(S)-40);p.snippet=utils.escapeHTML((b>0?"...":"")+E.slice(b,b+80)+(E.length-b>80?"...":""))}),d.dropdown={maxWidth:"400px",maxHeight:"500px",...e.dropdown},app.parseAndTranslate("partials/quick-search-results",d,function(p){p.length&&p.find(".timeago").timeago(),i.toggleClass("hidden",!p.length||!n.is(":focus")).find(".quick-search-results-container").html(p.length?p:"");const E=i.find(".quick-search-results .quick-search-title, .quick-search-results .snippet");l.highlightMatches(e.searchOptions.term,E),v.fire("action:search.quick.complete",{data:d,options:e})})})}i.find('.filter-category input[type="checkbox"]').on("change",function(){n.focus(),a()}),n.off("keyup").on("keyup",utils.debounce(function(){if(n.val().length<3){i.addClass("hidden"),t=n.val();return}if(n.val()!==t){if(t=n.val(),!n.is(":focus"))return i.addClass("hidden");a()}},500));let u=!1;i.on("mousedown",".quick-search-results > *",function(){$(window).one("mouseup",function(){i.addClass("hidden")}),u=!0}),n.on("blur",function(){setTimeout(function(){!n.is(":focus")&&!u&&!i.hasClass("hidden")&&i.addClass("hidden")},200)});let m=!1;v.on("action:ajaxify.end",function(){ajaxify.isCold()||(m=!0)}),n.on("focus",function(){u=!1;const d=n.val();t=d,d&&i.find("#quick-search-results").children().length&&(c(),m?(a(),m=!1):i.removeClass("hidden"),n[0].setSelectionRange(d.startsWith("in:topic")?d.indexOf(" ")+1:0,d.length))}),n.off("refresh").on("refresh",function(){a()})},l.showAndFocusInput=function(e){const o=e.parents(".dropdown-menu");if(o.length){const i=o.siblings("[data-bs-toggle]"),n=s.Dropdown.getOrCreateInstance(i[0]);n&&n.show()}else e.find('[component="search/fields"]').removeClass("hidden"),e.find('[component="search/button"]').addClass("hidden"),e.find('[component="search/fields"] input[name="query"]').trigger("focus")},l.query=function(e,o){o=o||function(){},ajaxify.go("search?"+x(e),o)},l.api=function(e,o){const i=config.relative_path+"/api/search?"+x(e);e.hasOwnProperty("searchOnly")&&delete e.searchOnly;const n=config.relative_path+"/search?"+x(e);$.get(i,function(t){t.url=n,o(t)})};function x(e){const o=e.in||"titles";let i=e.term.replace(/^[ ?#]*/,"");try{i=encodeURIComponent(i)}catch{return f.error("[[error:invalid-search-term]]")}const n={...e,term:i,in:o};return v.fire("action:search.createQueryString",{query:n,data:e}),decodeURIComponent($.param(n))}return l.getSearchPreferences=function(){try{return JSON.parse(k.getItem("search-preferences")||"{}")}catch{return{}}},l.highlightMatches=function(e,o){if(!e||!o.length)return;e=utils.escapeHTML(e.replace(/^"/,"").replace(/"$/,"").trim());const i=e.split(" ").filter(t=>t.length>1).map(function(t){return utils.escapeRegexChars(t)}).join("|"),n=new RegExp("("+i+")","gi");o.each(function(){const t=$(this),r=[];t.find("*").each(function(){$(this).after("<!-- "+r.length+" -->"),r.push($("<div></div>").append($(this)))}),t.html(t.html().replace(n,function(c,a){return'<strong class="search-match fw-bold text-decoration-underline">'+a+"</strong>"})),r.forEach(function(c,a){t.html(t.html().replace("<!-- "+a+" -->",function(){return c.html()}))})}),$(".search-result-text").find("img:not(.not-responsive)").addClass("img-fluid")},l}.apply(T,C),y!==void 0&&(O.exports=y)}}]);
