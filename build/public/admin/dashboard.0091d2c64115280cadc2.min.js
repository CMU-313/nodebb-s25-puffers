"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[14037,25432,15794],{37971:(_,b,c)=>{c.r(b),c.d(b,{init:()=>z});var l=c(92262),v=c(81335),I=c.n(v),R=c(40027),L=c.n(R),K=c(29930),M=c(17459),ee=c.n(M),p=c(30076),te=c.n(p);l.t1.register(l.ZT,l.ju,l.PP,l.kc,l.No,l.FN,l.Bs,l.m_,l.dN,l.s$);const g={rooms:!1,graphs:!1};let H=!1;const m={rooms:{},traffic:{}},y={units:"hours",until:void 0},A={roomInterval:1e4,graphInterval:15e3,realtimeInterval:1500},O=[];$(window).on("action:ajaxify.start",function(){clearInterval(g.rooms),clearInterval(g.graphs),g.rooms=null,g.graphs=null,m.rooms=null,m.traffic=null,O.length=0});function z(){app.enterRoom("admin"),H=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),Y(),Q(),V(function(){socket.emit("admin.rooms.getAll",N),W()}),X()}function N(n,r){if(n)return K.error(n);JSON.stringify(m.rooms)!==JSON.stringify(r)&&(m.rooms=r,Z(r.onlineRegisteredCount,r.onlineGuestCount),G(r.users),T(r.topTenTopics),$("#active-users-loggedin").text((0,p.formattedNumber)(r.onlineRegisteredCount)),$("#active-users-guests").text((0,p.formattedNumber)(r.onlineGuestCount)),$("#active-users-total").text((0,p.formattedNumber)(r.onlineRegisteredCount+r.onlineGuestCount)),$("#active-users-connections").text((0,p.formattedNumber)(r.socketCount)))}const s={traffic:null,registered:null,presence:null,topics:null},F=["#bf616a","#5B90BF","#d08770","#ebcb8b","#a3be8c","#96b5b4","#8fa1b3","#b48ead","#ab7967","#46BFBD"];function J(n,r){let e=!1;n[0]==="#"&&(n=n.slice(1),e=!0);const t=parseInt(n,16);let a=(t>>16)+r;a>255?a=255:a<0&&(a=0);let o=(t>>8&255)+r;o>255?o=255:o<0&&(o=0);let i=(t&255)+r;return i>255?i=255:i<0&&(i=0),(e?"#":"")+(i|o<<8|a<<16).toString(16)}function V(n){n=n||function(){};const r=document.getElementById("analytics-traffic"),e=document.getElementById("analytics-registered"),t=document.getElementById("analytics-presence"),a=document.getElementById("analytics-topics"),o=r.getContext("2d"),i=e.getContext("2d"),C=t.getContext("2d"),x=a.getContext("2d"),w=utils.getHoursArray();H&&(l.t1.defaults.plugins.tooltip.enabled=!1);const d=M.Translator.create();Promise.all([d.translateKey("admin/dashboard:graphs.page-views",[]),d.translateKey("admin/dashboard:graphs.page-views-registered",[]),d.translateKey("admin/dashboard:graphs.page-views-guest",[]),d.translateKey("admin/dashboard:graphs.page-views-bot",[]),d.translateKey("admin/dashboard:graphs.unique-visitors",[]),d.translateKey("admin/dashboard:graphs.registered-users",[]),d.translateKey("admin/dashboard:graphs.guest-users",[]),d.translateKey("admin/dashboard:on-categories",[]),d.translateKey("admin/dashboard:reading-posts",[]),d.translateKey("admin/dashboard:browsing-topics",[]),d.translateKey("admin/dashboard:recent",[]),d.translateKey("admin/dashboard:unread",[])]).then(function(f){const k={labels:w,datasets:[{label:f[0],fill:"origin",tension:.25,backgroundColor:"rgba(220,220,220,0.2)",borderColor:"rgba(220,220,220,1)",pointBackgroundColor:"rgba(220,220,220,1)",pointHoverBackgroundColor:"#fff",pointBorderColor:"#fff",pointHoverBorderColor:"rgba(220,220,220,1)",data:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{label:f[1],fill:"origin",tension:.25,backgroundColor:"#ab464233",borderColor:"#ab4642",pointBackgroundColor:"#ab4642",pointHoverBackgroundColor:"#ab4642",pointBorderColor:"#fff",pointHoverBorderColor:"#ab4642",data:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{label:f[2],fill:"origin",tension:.25,backgroundColor:"#ba8baf33",borderColor:"#ba8baf",pointBackgroundColor:"#ba8baf",pointHoverBackgroundColor:"#ba8baf",pointBorderColor:"#fff",pointHoverBorderColor:"#ba8baf",data:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{label:f[3],fill:"origin",tension:.25,backgroundColor:"#f7ca8833",borderColor:"#f7ca88",pointBackgroundColor:"#f7ca88",pointHoverBackgroundColor:"#f7ca88",pointBorderColor:"#fff",pointHoverBorderColor:"#f7ca88",data:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{label:f[4],fill:"origin",tension:.25,backgroundColor:"rgba(151,187,205,0.2)",borderColor:"rgba(151,187,205,1)",pointBackgroundColor:"rgba(151,187,205,1)",pointHoverBackgroundColor:"rgba(151,187,205,1)",pointBorderColor:"#fff",pointHoverBorderColor:"rgba(151,187,205,1)",data:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}]};r.width=$(r).parent().width(),k.datasets[0].yAxisID="left-y-axis",k.datasets[1].yAxisID="left-y-axis",k.datasets[2].yAxisID="left-y-axis",k.datasets[3].yAxisID="left-y-axis",k.datasets[4].yAxisID="right-y-axis",s.traffic=new l.t1(o,{type:"line",data:k,options:{responsive:!0,scales:{"left-y-axis":{position:"left",type:"linear",title:{display:!0,text:f[0]},beginAtZero:!0},"right-y-axis":{position:"right",type:"linear",title:{display:!0,text:f[4]},beginAtZero:!0}},plugins:{legend:{position:"bottom"}},interaction:{intersect:!1,mode:"index"}}});const S={responsive:!0,plugins:{legend:{display:!1}}};s.registered=new l.t1(i,{type:"doughnut",data:{labels:f.slice(5,7),datasets:[{data:[1,1],backgroundColor:["#F7464A","#46BFBD"],hoverBackgroundColor:["#FF5A5E","#5AD3D1"]}]},options:S}),s.presence=new l.t1(C,{type:"doughnut",data:{labels:f.slice(7,12),datasets:[{data:[1,1,1,1,1],backgroundColor:["#F7464A","#46BFBD","#FDB45C","#949FB1","#9FB194"],hoverBackgroundColor:["#FF5A5E","#5AD3D1","#FFC870","#A8B3C5","#A8B3C5"]}]},options:S}),s.topics=new l.t1(x,{type:"doughnut",data:{labels:[],datasets:[{data:[],backgroundColor:[],hoverBackgroundColor:[]}]},options:S}),D(),$('[data-action="updateGraph"]:not([data-units="custom"])').on("click",function(){let h=new Date;const q=$(this).attr("data-amount");$(this).attr("data-units")==="days"&&h.setHours(0,0,0,0),h=h.getTime(),D($(this).attr("data-units"),h,q),Promise.resolve().then(function(){var P=[c(17459)];(function(j){j.translate("[[admin/dashboard:page-views-custom]]",function(u){$('[data-action="updateGraph"][data-units="custom"]').text(u)})}).apply(null,P)}).catch(c.oe)}),$('[data-action="updateGraph"][data-units="custom"]').on("click",function(){const h=$(this);v.render("admin/partials/pageviews-range-select",{}).then(function(q){const P=R.dialog({title:"[[admin/dashboard:page-views-custom]]",message:q,buttons:{submit:{label:"[[global:search]]",className:"btn-primary",callback:j}}}).on("shown.bs.modal",function(){const u=new Date,U=u.toISOString().slice(0,10);u.setDate(u.getDate()-1);const B=u.toISOString().slice(0,10);P.find("#startRange").val(h.attr("data-startRange")||B),P.find("#endRange").val(h.attr("data-endRange")||U)});function j(){const u=P.find("form").serializeObject(),U=/\d{4}-\d{2}-\d{2}/;if(!u.startRange&&!u.endRange){D("days");return}else if(!U.test(u.startRange)||!U.test(u.endRange))return P.find(".alert-danger").removeClass("hidden"),!1;let B=new Date(u.endRange);B.setDate(B.getDate()+1),B=B.getTime();const ae=(B-new Date(u.startRange).getTime())/(1e3*60*60*24);D("days",B,ae),h.attr("data-startRange",u.startRange),h.attr("data-endRange",u.endRange),h.html(u.startRange+" &ndash; "+u.endRange)}})}),n()})}function D(n,r,e){app.isFocused&&socket.emit("admin.analytics.get",{graph:"traffic",units:n||"hours",until:r,amount:e},function(t,a){if(t)return K.error(t);if(JSON.stringify(m.traffic)===JSON.stringify(a))return;m.traffic=a,n==="days"?s.traffic.data.xLabels=utils.getDaysArray(r,e):(s.traffic.data.xLabels=utils.getHoursArray(),$("#pageViewsThirty").html((0,p.formattedNumber)(a.summary.thirty)),$("#pageViewsSeven").html((0,p.formattedNumber)(a.summary.seven)),$("#pageViewsPastDay").html((0,p.formattedNumber)(a.pastDay))),s.traffic.data.datasets[0].data=a.pageviews,s.traffic.data.datasets[1].data=a.pageviewsRegistered,s.traffic.data.datasets[2].data=a.pageviewsGuest,s.traffic.data.datasets[3].data=a.pageviewsBot,s.traffic.data.datasets[4].data=a.uniqueVisitors,s.traffic.data.labels=s.traffic.data.xLabels,s.traffic.update(),y.units=n,y.until=r,y.amount=e;const o=$("#view-as-json"),i=$.param({units:n||"hours",until:r,count:e});o.attr("href",config.relative_path+"/api/admin/analytics?"+i)})}function Z(n,r){$("#analytics-legend .registered").parent().find(".count").text(n),$("#analytics-legend .guest").parent().find(".count").text(r),s.registered.data.datasets[0].data[0]=n,s.registered.data.datasets[0].data[1]=r,s.registered.update()}function G(n){$("#analytics-presence-legend .on-categories").parent().find(".count").text(n.categories),$("#analytics-presence-legend .reading-posts").parent().find(".count").text(n.topics),$("#analytics-presence-legend .browsing-topics").parent().find(".count").text(n.category),$("#analytics-presence-legend .recent").parent().find(".count").text(n.recent),$("#analytics-presence-legend .unread").parent().find(".count").text(n.unread),s.presence.data.datasets[0].data[0]=n.categories,s.presence.data.datasets[0].data[1]=n.topics,s.presence.data.datasets[0].data[2]=n.category,s.presence.data.datasets[0].data[3]=n.recent,s.presence.data.datasets[0].data[4]=n.unread,s.presence.update()}function T(n){if(!n.length){M.translate("[[admin/dashboard:no-users-browsing]]",function(e){n=[{title:e,count:1}],T(n)});return}s.topics.data.labels=[],s.topics.data.datasets[0].data=[],s.topics.data.datasets[0].backgroundColor=[],s.topics.data.datasets[0].hoverBackgroundColor=[],n.forEach(function(e,t){s.topics.data.labels.push(e.title),s.topics.data.datasets[0].data.push(e.count),s.topics.data.datasets[0].backgroundColor.push(F[t]),s.topics.data.datasets[0].hoverBackgroundColor.push(J(F[t],10))});function r(){let e="";n.forEach(function(t,a){const o=t.tid?'<a title="'+t.title+'"href="'+config.relative_path+"/topic/"+t.tid+'" target="_blank"> '+t.title+"</a>":t.title,i=t.count==="0"?t.title:o;e+='<li><div style="background-color: '+F[a]+';"></div><span> ('+t.count+") "+i+"</span></li>"}),$("#topics-legend").translateHtml(e)}r(),s.topics.update()}function Y(){let n=localStorage.getItem("data-bs-theme")||"light";$("#toggle-dark-mode").prop("checked",n==="dark").on("click",function(){n=$(this).is(":checked")?"dark":"light",$("html").attr("data-bs-theme",n),localStorage.setItem("data-bs-theme",n)})}function Q(){$("#toggle-realtime").on("click",function(){W($(this).is(":checked"))})}function W(n){clearInterval(g.rooms),clearInterval(g.graphs),g.rooms=setInterval(function(){app.isFocused&&socket.connected&&socket.emit("admin.rooms.getAll",N)},n?A.realtimeInterval:A.roomInterval),g.graphs=setInterval(function(){D(y.units,y.until,y.amount)},n?A.realtimeInterval:A.graphInterval)}function X(){const n=document.getElementById("analytics-panel"),r=$(n),e=r.find("#expand-analytics");let t,a;n.requestFullscreen?(t="requestFullscreen",a="exitFullscreen"):n.mozRequestFullScreen?(t="mozRequestFullScreen",a="mozCancelFullScreen"):n.webkitRequestFullscreen?(t="webkitRequestFullscreen",a="webkitCancelFullScreen"):n.msRequestFullscreen&&(t="msRequestFullscreen",a="msCancelFullScreen"),t&&e.on("click",function(){r.hasClass("fullscreen")?(document[a](),r.removeClass("fullscreen")):(n[t](),r.addClass("fullscreen"))})}},29869:_=>{_.exports=function(b,c,l){c.setGlobal("true",!0),c.setGlobal("false",!1);const v=24*60*60*1e3,I={displayMenuItem:L,buildMetaTag:K,buildLinkTag:M,stringify:ee,escape:p,stripTags:te,buildCategoryIcon:g,buildCategoryLabel:H,generateCategoryBackground:m,generateChildrenCategories:y,generateTopicClass:A,membershipBtn:O,spawnPrivilegeStates:z,localeToHTML:N,renderTopicImage:s,renderDigestAvatar:F,userAgentIcons:J,buildAvatar:V,increment:D,generateWroteReplied:Z,generateRepliedTo:G,generateWrote:T,isoTimeToLocaleString:Y,shouldHideReplyContainer:Q,humanReadableNumber:W,formattedNumber:X,generatePlaceholderWave:n,register:r,__escape:R};function R(e){return e}function L(e,t){const a=e.navigation[t];return!(!a||a.route.match("/users")&&e.user&&!e.user.privileges["view:users"]||a.route.match("/tags")&&e.user&&!e.user.privileges["view:tags"]||a.route.match("/groups")&&e.user&&!e.user.privileges["view:groups"])}function K(e){const t=e.name?'name="'+e.name+'" ':"",a=e.property?'property="'+e.property+'" ':"",o=e.content?'content="'+e.content.replace(/\n/g," ")+'" ':"";return"<meta "+t+a+o+`/>
	`}function M(e){const t=["link","rel","as","type","href","sizes","title","crossorigin"],[a,o,i,C,x,w,d,f]=t.map(E=>e[E]?`${E}="${e[E]}" `:"");return"<link "+a+o+i+C+w+d+x+f+`/>
	`}function ee(e){return JSON.stringify(e).replace(/&/gm,"&amp;").replace(/</gm,"&lt;").replace(/>/gm,"&gt;").replace(/"/g,"&quot;")}function p(e){return b.escapeHTML(e)}function te(e){return b.stripHTMLTags(e)}function g(e,t,a){return e?`<span class="icon d-inline-flex justify-content-center align-items-center align-middle ${a}" style="${m(e)} width:${t}; height: ${t}; font-size: ${parseInt(t,10)/2}px;">${e.icon?`<i class="fa fa-fw ${e.icon}"></i>`:""}</span>`:""}function H(e,t="a",a=""){if(!e)return"";const o=t==="a"?`href="${l}/category/${e.slug}"`:"";return`<${t} ${o} class="badge px-1 text-truncate text-decoration-none ${a}" style="color: ${e.color};background-color: ${e.bgColor};border-color: ${e.bgColor}!important; max-width: 70vw;">
			${e.icon&&e.icon!=="fa-nbb-none"?`<i class="fa fa-fw ${e.icon}"></i>`:""}
			${e.name}
		</${t}>`}function m(e){if(!e)return"";const t=[];return e.bgColor&&(t.push("background-color: "+e.bgColor),t.push(`border-color: ${e.bgColor}!important`)),e.color&&t.push("color: "+e.color),e.backgroundImage&&(t.push("background-image: url("+e.backgroundImage+")"),e.imageClass&&t.push("background-size: "+e.imageClass)),t.join("; ")+";"}function y(e){let t="";return!e||!e.children||!e.children.length||(e.children.forEach(function(a){if(a&&!a.isSection){const o=a.link?a.link:l+"/category/"+a.slug;t+='<span class="category-children-item float-start"><div role="presentation" class="icon float-start" style="'+m(a)+'"><i class="fa fa-fw '+a.icon+'"></i></div><a href="'+o+'"><small>'+a.name+"</small></a></span>"}}),t=t&&'<span class="category-children">'+t+"</span>"),t}function A(e){return["locked","pinned","deleted","unread","scheduled"].filter(a=>!!e[a]).join(" ")}function O(e,t=""){return e.isMember&&e.name!=="administrators"?`<button class="btn btn-danger ${t}" data-action="leave" data-group="${e.displayName}" ${e.disableLeave?" disabled":""}><i class="fa fa-times"></i> [[groups:membership.leave-group]]</button>`:e.isPending&&e.name!=="administrators"?`<button class="btn btn-warning disabled ${t}"><i class="fa fa-clock-o"></i> [[groups:membership.invitation-pending]]</button>`:e.isInvited?`<button class="btn btn-warning" data-action="rejectInvite" data-group="${e.displayName}">[[groups:membership.reject]]</button><button class="btn btn-success" data-action="acceptInvite" data-group="${e.name}"><i class="fa fa-plus"></i> [[groups:membership.accept-invitation]]</button>`:!e.disableJoinRequests&&e.name!=="administrators"?`<button class="btn btn-success ${t}" data-action="join" data-group="${e.displayName}"><i class="fa fa-plus"></i> [[groups:membership.join-group]]</button>`:""}function z(e,t,a){const o=[];for(const i in t)t.hasOwnProperty(i)&&o.push({name:i,state:t[i],type:a[i]});return o.map(function(i){const C=["groups:moderate","groups:posts:upvote","groups:posts:downvote","groups:local:login","groups:group:create"],x=["groups:find","groups:read","groups:topics:read","groups:view:users","groups:view:tags","groups:view:groups"],w=["groups:moderate"],d=e==="guests"&&(C.includes(i.name)||i.name.startsWith("groups:admin:"))||e==="spiders"&&!x.includes(i.name)||e==="Global Moderators"&&w.includes(i.name);return`
				<td data-privilege="${i.name}" data-value="${i.state}" data-type="${i.type}">
					<div class="form-check text-center">
						<input class="form-check-input float-none" autocomplete="off" type="checkbox"${i.state?" checked":""}${d?' disabled="disabled"':""} />
					</div>
				</td>
			`}).join("")}function N(e,t){return e=e||t||"en-GB",e.replace("_","-")}function s(e){return e.thumb?'<img src="'+e.thumb+'" class="img-circle user-img" title="'+e.user.username+'" />':'<img component="user/picture" data-uid="'+e.user.uid+'" src="'+e.user.picture+'" class="user-img" title="'+e.user.username+'" />'}function F(e){return e.teaser?e.teaser.user.picture?'<img style="vertical-align: middle; width: 32px; height: 32px; border-radius: 50%;" src="'+e.teaser.user.picture+'" title="'+e.teaser.user.username+'" />':'<div style="vertical-align: middle; width: 32px; height: 32px; line-height: 32px; font-size: 16px; background-color: '+e.teaser.user["icon:bgColor"]+'; color: white; text-align: center; display: inline-block; border-radius: 50%;">'+e.teaser.user["icon:text"]+"</div>":e.user.picture?'<img style="vertical-align: middle; width: 32px; height: 32px; border-radius: 50%;" src="'+e.user.picture+'" title="'+e.user.username+'" />':'<div style="vertical-align: middle; width: 32px; height: 32px; line-height: 32px; font-size: 16px; background-color: '+e.user["icon:bgColor"]+'; color: white; text-align: center; display: inline-block; border-radius: 50%;">'+e.user["icon:text"]+"</div>"}function J(e){let t="";switch(e.platform){case"Linux":t+='<i class="fa fa-fw fa-linux"></i>';break;case"Microsoft Windows":t+='<i class="fa fa-fw fa-windows"></i>';break;case"Apple Mac":t+='<i class="fa fa-fw fa-apple"></i>';break;case"Android":t+='<i class="fa fa-fw fa-android"></i>';break;case"iPad":t+='<i class="fa fa-fw fa-tablet"></i>';break;case"iPod":case"iPhone":t+='<i class="fa fa-fw fa-mobile"></i>';break;default:t+='<i class="fa fa-fw fa-question-circle"></i>';break}switch(e.browser){case"Chrome":t+='<i class="fa fa-fw fa-chrome"></i>';break;case"Firefox":t+='<i class="fa fa-fw fa-firefox"></i>';break;case"Safari":t+='<i class="fa fa-fw fa-safari"></i>';break;case"IE":t+='<i class="fa fa-fw fa-internet-explorer"></i>';break;case"Edge":t+='<i class="fa fa-fw fa-edge"></i>';break;default:t+='<i class="fa fa-fw fa-question-circle"></i>';break}return t}function V(e,t,a,o,i){e||(e=this),o=o||"";const C=new Map([["title",e.username],["data-uid",e.uid],["class",`avatar ${o}${a?" avatar-rounded":""}`]]),x=[`--avatar-size: ${t};`],w=f=>Array.from(f).reduce((E,[k,S])=>(E+=` ${k}="${S}"`,E),"");let d="";return e.picture&&(d+=`<img${w(C)} alt="${e.username}" loading="lazy" component="${i||"avatar/picture"}" src="${e.picture}" style="${x.join(" ")}" onError="this.remove()" itemprop="image" />`),d+=`<span${w(C)} component="${i||"avatar/icon"}" style="${x.join(" ")} background-color: ${e["icon:bgColor"]}">${e["icon:text"]}</span>`,d}function D(e,t){return String(e+parseInt(t,10))}function Z(e,t){return e.toPid?G(e,t):T(e,t)}function G(e,t){const a=e.parent&&e.parent.displayname?e.parent.displayname:"[[global:guest]]";return`[[topic:replied-to-user-${e.timestamp<Date.now()-t*v?"on":"ago"}, ${e.toPid}, ${l}/post/${e.toPid}, ${a}, ${l}/post/${e.pid}, ${e.timestampISO}]]`}function T(e,t){return`[[topic:wrote-${e.timestamp<Date.now()-t*v?"on":"ago"}, ${l}/post/${e.pid}, ${e.timestampISO}]]`}function Y(e,t="en-GB"){return new Date(e).toLocaleString([t],{dateStyle:"short",timeStyle:"short"}).replace(/,/g,"&#44;")}function Q(e){return!!(e.replies.count<=0||e.replies.hasSingleImmediateReply)}function W(e,t=1){return b.makeNumberHumanReadable(e,t)}function X(e){return b.addCommas(e)}function n(e){return e.map(a=>a==="divider"?'<li class="dropdown-divider"></li>':`
			<li class="dropdown-item placeholder-wave">
				<div class="placeholder" style="width: 20px;"></div>
				<div class="placeholder col-${a}"></div>
			</li>`)}function r(){Object.keys(I).forEach(function(e){c.registerHelper(e,I[e])})}return I}},30076:(_,b,c)=>{var l,v;const I=c(29869);l=[c(77918),c(81335)],v=function(R,L){return I(R,L,config.relative_path)}.apply(b,l),v!==void 0&&(_.exports=v)}}]);
