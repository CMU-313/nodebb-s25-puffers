"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,18470,34271,49897,89379,99127],{27693:(T,O,c)=>{var y,k;y=[c(70012),c(57576),c(40027),c(81335),c(49897),c(29930)],k=function(E,D,l,h,m,f){const p={};p.init=function(){E.load("core.api",$(".core-api-settings")),$("#save").on("click",()=>{E.save("core.api",$(".core-api-settings"))});const e=document.querySelectorAll('[data-component="acp/tokens"] [data-action="copy"]');new D(e),$('[data-action="create"]').on("click",t),n()};function n(){const e=document.querySelector("#content form");e&&e.addEventListener("click",s=>{const r=s.target.closest("[data-action]");if(r)switch(r.getAttribute("data-action")){case"edit":a(r);break;case"delete":o(r);break;case"roll":i(r);break}})}async function t(){const e=await h.render("admin/partials/edit-token-modal",{}),s=async function(){const r=this,u=this.get(0).querySelector("form"),d=document.querySelector('[data-component="acp/tokens"] tbody'),g=u.reportValidity();if(u&&g){const P=new FormData(u),R=P.get("uid"),A=P.get("description");try{const v=await m.post("/admin/tokens",{uid:R,description:A});if(!d)return r.modal("hide"),ajaxify.refresh();ajaxify.data.tokens.push(v);const S=(await app.parseAndTranslate(ajaxify.data.template.name,"tokens",{tokens:[v]})).get(0);d.append(S),$(S).find(".timeago").timeago(),r.modal("hide")}catch(v){f.error(v)}}return!1};l.dialog({title:"[[admin/settings/api:create-token]]",message:e,buttons:{submit:{label:"[[modules:bootbox.submit]]",className:"btn-primary",callback:s}}})}async function a(e){const s=e.closest("[data-token]"),r=s.getAttribute("data-token"),{uid:u,description:d}=await m.get(`/admin/tokens/${r}`),g=async function(){const R=this,A=this.get(0).querySelector("form"),v=A.reportValidity();if(A&&v){const S=new FormData(A),C=S.get("uid"),j=S.get("description");try{const x=await m.put(`/admin/tokens/${r}`,{uid:C,description:j}),w=(await app.parseAndTranslate(ajaxify.data.template.name,"tokens",{tokens:[x]})).get(0);s.replaceWith(w),$(w).find(".timeago").timeago(),R.modal("hide")}catch(x){f.error(x)}}return!1},P=await h.render("admin/partials/edit-token-modal",{uid:u,description:d});l.dialog({title:"[[admin/settings/api:update-token]]",message:P,buttons:{submit:{label:"[[modules:bootbox.submit]]",className:"btn-primary",callback:g}}})}async function o(e){const s=e.closest("[data-token]"),r=s.getAttribute("data-token");l.confirm("[[admin/settings/api:delete-confirm]]",async u=>{if(u){try{await m.del(`/admin/tokens/${r}`)}catch(d){f.error(d)}s.remove()}})}async function i(e){const s=e.closest("[data-token]"),r=s.getAttribute("data-token");l.confirm("[[admin/settings/api:roll-confirm]]",async u=>{if(u)try{const d=await m.post(`/admin/tokens/${r}/roll`),g=(await app.parseAndTranslate(ajaxify.data.template.name,"tokens",{tokens:[d]})).get(0);s.replaceWith(g),$(g).find(".timeago").timeago()}catch(d){f.error(d)}})}return p}.apply(O,y),k!==void 0&&(T.exports=k)},49897:(T,O,c)=>{c.r(O),c.d(O,{del:()=>o,get:()=>f,head:()=>p,patch:()=>t,post:()=>n,put:()=>a});var y=c(91749),k=c.n(y),E=c(40027),D=c.n(E);const l=config.relative_path+"/api/v3";async function h(i,e){if(i.url=i.url.startsWith("/api")?config.relative_path+i.url:l+i.url,typeof e=="function"){m(i).then(s=>e(null,s),s=>e(s));return}try{return await m(i)}catch(s){if(s.message==="A valid login session was not found. Please log in and try again."){const{url:r}=await(0,y.fire)("filter:admin.reauth",{url:"login"});return(0,E.confirm)("[[error:api.reauth-required]]",u=>{u&&ajaxify.go(r)})}throw s}}async function m(i){const{url:e}=i;delete i.url,i.data&&!(i.data instanceof FormData)&&(i.data=JSON.stringify(i.data||{}),i.headers["content-type"]="application/json; charset=utf-8"),{options:i}=await(0,y.fire)("filter:api.options",{options:i}),i.data&&(i.body=i.data,delete i.data);const s=await fetch(e,i),{headers:r}=s,u=r.get("content-type"),d=u&&u.startsWith("application/json");let g;if(i.method!=="HEAD"&&(d?g=await s.json():g=await s.text()),!s.ok)throw g?new Error(d?g.status.message:g):new Error(s.statusText);return d&&g&&g.hasOwnProperty("status")&&g.hasOwnProperty("response")?g.response:g}function f(i,e,s){return h({url:i+(e&&Object.keys(e).length?"?"+$.param(e):"")},s)}function p(i,e,s){return h({url:i+(e&&Object.keys(e).length?"?"+$.param(e):""),method:"HEAD"},s)}function n(i,e,s){return h({url:i,method:"POST",data:e,headers:{"x-csrf-token":config.csrf_token}},s)}function t(i,e,s){return h({url:i,method:"PATCH",data:e,headers:{"x-csrf-token":config.csrf_token}},s)}function a(i,e,s){return h({url:i,method:"PUT",data:e,headers:{"x-csrf-token":config.csrf_token}},s)}function o(i,e,s){return h({url:i,method:"DELETE",data:e,headers:{"x-csrf-token":config.csrf_token}},s)}},70012:(T,O,c)=>{var y,k;y=[c(91749),c(29930)],k=function(E,D){let l,h=[],m=0,f;function p(n,t){typeof n!="string"&&(n=$(n),n=n.data("type")||n.attr("type")||n.prop("tagName"));const a=l.plugins[n.toLowerCase()];if(a==null)return;const o=a[t];return typeof o=="function"?o:null}return f={deepClone:function(n){return typeof n=="object"?JSON.parse(JSON.stringify(n)):n},createElement:function(n,t,a){const o=document.createElement(n);for(const i in t)t.hasOwnProperty(i)&&o.setAttribute(i,t[i]);return a&&o.appendChild(document.createTextNode(a)),o},initElement:function(n){const t=p(n,"init");t?.call(l,$(n))},destructElement:function(n){const t=p(n,"destruct");t?.call(l,$(n))},createElementOfType:function(n,t,a){let o;const i=p(n,"create");return i!=null?o=$(i.call(l,n,t,a)):(a==null&&(a={}),n!=null&&(a.type=n),o=$(f.createElement(t||"input",a))),o.data("type",n),f.initElement(o),o},cleanArray:function(n,t,a){const o=[];if(!t&&a)return n;for(let i=0;i<n.length;i+=1){let e=n[i];t&&(e===!!e?e=+e:e&&typeof e.trim=="function"&&(e=e.trim())),(a||e!=null&&e.length)&&o.push(e)}return o},isTrue:function(n){return n==="true"||+n==1},isFalse:function(n){return n==="false"||+n==0},readValue:function(n){let t=!f.isFalse(n.data("empty"));const a=!f.isFalse(n.data("trim")),o=n.data("split"),i=p(n,"get");let e;if(i!=null)return i.call(l,n,a,t);if(o!=null){t=f.isTrue(n.data("empty")),e=n.val();const s=e!=null&&e.split(o||",")||[];return f.cleanArray(s,a,t)}if(e=n.val(),a&&e!=null&&typeof e.trim=="function"&&(e=e.trim()),t||e!==void 0&&(e==null||e.length!==0))return e},fillField:function(n,t){const a=p(n,"set");let o=n.data("trim");if(o=o!=="false"&&+o!=0,a!=null)return a.call(l,n,t,o);t instanceof Array&&(t=t.join(n.data("split")||(o?", ":","))),o&&t&&typeof t.trim=="function"?(t=t.trim(),typeof t.toString=="function"&&(t=t.toString())):t!=null?(typeof t.toString=="function"&&(t=t.toString()),o&&(t=t.trim())):t="",t!==void 0&&n.val(t)},initFields:function(n){$("[data-key]",n).each(function(t,a){a=$(a);const o=p(a,"init"),i=a.data("key").split(".");let e=l.get();o?.call(l,a);for(let s=0;s<i.length;s+=1){const r=i[s];r&&e!=null&&(e=e[r])}f.fillField(a,e)})},registerReadyJobs:function(n){return m+=n,m},beforeReadyJobsDecreased:function(n){if(n==null&&(n=1),m>0&&(m-=n,m<=0)){for(let t=0;t<h.length;t+=1)h[t]();h=[]}},whenReady:function(n){m<=0?n():h.push(n)},serializeForm:function(n){const t=n.serializeObject();return n.find('input[type="checkbox"]').each(function(a,o){o=$(o),o.is(":checked")||(t[o.attr("name")]="off")}),n.find("select[multiple]").each(function(a,o){o=$(o),t[o.attr("name")]=JSON.stringify(o.val())}),t},persistSettings:function(n,t,a,o){t!=null&&t._!=null&&typeof t._!="string"&&(t=f.deepClone(t),t._=JSON.stringify(t._)),socket.emit("admin.settings.set",{hash:n,values:t},function(i){a&&(i?D.alert({title:"[[admin/admin:changes-not-saved]]",type:"danger",message:`[[admin/admin/changes-not-saved-message, ${i.message}]]`,timeout:5e3}):D.alert({title:"[[admin/admin:changes-saved]]",type:"success",message:"[[admin/admin:changes-saved-message]]",timeout:2500})),typeof o=="function"&&o(i)})},use:function(n){try{n._=JSON.parse(n._)}catch{}l.cfg=n}},l={helper:f,plugins:{},cfg:{},get:function(){return l.cfg!=null&&l.cfg._!==void 0?l.cfg._:l.cfg},registerPlugin:function(n,t){t==null?t=n.types:n.types=t,typeof n.use=="function"&&n.use.call(l);for(let a=0;a<t.length;a+=1){const o=t[a].toLowerCase();l.plugins[o]==null&&(l.plugins[o]=n)}},set:function(n,t,a,o,i){i==null&&(i=!0),f.whenReady(function(){f.use(t),f.initFields(a||"form"),f.persistSettings(n,t,i,o)})},sync:function(n,t,a){socket.emit("admin.settings.get",{hash:n},function(o,i){o?typeof a=="function"&&a(o):f.whenReady(function(){f.use(i),f.initFields(t||"form"),typeof a=="function"&&a()})})},persist:function(n,t,a,o){const i=[],e=$("[data-key]",t||"form").toArray();o==null&&(o=!0);for(let s=0;s<e.length;s+=1){const r=$(e[s]),u=f.readValue(r);let d=l.get();const g=r.data("key").split("."),P=g[g.length-1];if(g.length>1)for(let R=0;R<g.length-1;R+=1){const A=g[R];A&&d!=null&&(d=d[A])}d!=null?u!=null?d[P]=u:delete d[P]:i.push(r.data("key"))}i.length&&D.alert({title:"Attributes Not Saved",message:"'"+i.join(", ")+"' could not be saved. Please contact the plugin-author!",type:"danger",timeout:5e3}),f.persistSettings(n,l.cfg,o,a)},load:function(n,t,a){a=a||function(){};const o=t.attr("data-socket-get");socket.emit(o||"admin.settings.get",{hash:n},function(i,e){if(i)return a(i);$(t).find("select[multiple]").each(function(r,u){const d=$(u).attr("name");if(d&&e.hasOwnProperty(d))try{e[d]=JSON.parse(e[d])}catch{}}),ajaxify.data[o?n:"settings"]=e,f.whenReady(function(){$(t).find("[data-sorted-list]").each(function(r,u){p(u,"get").call(l,$(u),n)})}),$(t).deserialize(e),E.fire("action:admin.settingsLoaded"),$(t).on("change","input, select, textarea",function(){app.flags=app.flags||{},app.flags._unsaved=!0});const s=document.getElementById("save");s&&c.e(6411).then(function(){var r=[c(6411)];(function(u){u.bind("ctrl+s",function(d){s.click(),d.preventDefault()})}).apply(null,r)}).catch(c.oe),a(null,e)})},save:function(n,t,a){t=$(t);const o=t.get(0).elements;if(l.check(o)&&t.length){const e=f.serializeForm(t);f.whenReady(function(){const r=t.find("[data-sorted-list]");r.length&&r.each((u,d)=>{p(d,"set").call(l,$(d),e)})});const s=t.attr("data-socket-set");socket.emit(s||"admin.settings.set",{hash:n,values:e},function(r){if(app.flags._unsaved=!1,ajaxify.data[s?n:"settings"]=e,typeof a=="function")a(r);else if(r)D.alert({title:"[[admin/admin:changes-not-saved]]",message:`[[admin/admin:changes-not-saved-message, ${r.message}]]`,type:"error",timeout:2500});else{const u=document.getElementById("save");u.classList.toggle("saved",!0),setTimeout(()=>{u.classList.toggle("saved",!1)},1500)}})}},check:function(n){const t=a=>{const o=a.target.closest(".form-group");o&&o.classList.add("has-error"),a.target.removeEventListener("invalid",t)};return Array.prototype.map.call(n,a=>{const o=a.closest(".form-group");return o&&o.classList.remove("has-error"),a.addEventListener("invalid",t),a.reportValidity()}).every(Boolean)}},f.registerReadyJobs(1),Promise.all([c.e(23662),c.e(65285),c.e(19308)]).then(function(){var n=[c(75210),c(474),c(50397),c(71575),c(40054),c(17708),c(46700),c(59175)];(function(){for(let t=0;t<arguments.length;t+=1)l.registerPlugin(arguments[t]);f.beforeReadyJobsDecreased()}).apply(null,n)}).catch(c.oe),l}.apply(O,y),k!==void 0&&(T.exports=k)}}]);
