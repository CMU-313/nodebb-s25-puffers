"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,34271,49897,69185,83931,86198,99127],{49897:(w,E,d)=>{d.r(E),d.d(E,{del:()=>s,get:()=>t,head:()=>r,patch:()=>i,post:()=>h,put:()=>u});var y=d(91749),p=d.n(y),b=d(40027),x=d.n(b);const v=config.relative_path+"/api/v3";async function m(o,a){if(o.url=o.url.startsWith("/api")?config.relative_path+o.url:v+o.url,typeof a=="function"){g(o).then(e=>a(null,e),e=>a(e));return}try{return await g(o)}catch(e){if(e.message==="A valid login session was not found. Please log in and try again."){const{url:n}=await(0,y.fire)("filter:admin.reauth",{url:"login"});return(0,b.confirm)("[[error:api.reauth-required]]",c=>{c&&ajaxify.go(n)})}throw e}}async function g(o){const{url:a}=o;delete o.url,o.data&&!(o.data instanceof FormData)&&(o.data=JSON.stringify(o.data||{}),o.headers["content-type"]="application/json; charset=utf-8"),{options:o}=await(0,y.fire)("filter:api.options",{options:o}),o.data&&(o.body=o.data,delete o.data);const e=await fetch(a,o),{headers:n}=e,c=n.get("content-type"),f=c&&c.startsWith("application/json");let l;if(o.method!=="HEAD"&&(f?l=await e.json():l=await e.text()),!e.ok)throw l?new Error(f?l.status.message:l):new Error(e.statusText);return f&&l&&l.hasOwnProperty("status")&&l.hasOwnProperty("response")?l.response:l}function t(o,a,e){return m({url:o+(a&&Object.keys(a).length?"?"+$.param(a):"")},e)}function r(o,a,e){return m({url:o+(a&&Object.keys(a).length?"?"+$.param(a):""),method:"HEAD"},e)}function h(o,a,e){return m({url:o,method:"POST",data:a,headers:{"x-csrf-token":config.csrf_token}},e)}function i(o,a,e){return m({url:o,method:"PATCH",data:a,headers:{"x-csrf-token":config.csrf_token}},e)}function u(o,a,e){return m({url:o,method:"PUT",data:a,headers:{"x-csrf-token":config.csrf_token}},e)}function s(o,a,e){return m({url:o,method:"DELETE",data:a,headers:{"x-csrf-token":config.csrf_token}},e)}},65348:(w,E,d)=>{var y,p;y=[d(96349),d(40027),d(91749),d(17459)],p=function(b,x,v,m){const g={};return g.init=function(t,r){if(!t||!t.length)return;r=r||{};const h=r.onSelect||function(){};r.states=r.states||["watching","tracking","notwatching","ignoring"],r.template=r.template||"partials/category/selector-dropdown-left",v.fire("action:category.selector.options",{el:t,options:r}),b.init(t,r);const i={el:t,selectedCategory:null};t.on("click","[data-cid]",function(){const s=$(this);return s.hasClass("disabled")?!1:(i.selectCategory(s.attr("data-cid")),h(i.selectedCategory))});let u=i.el.find('[component="category-selector-selected"]').html();return m.translate(u,s=>{u=s}),i.selectCategory=function(s){const o=i.el.find('[data-cid="'+s+'"]');i.selectedCategory={cid:s,name:o.attr("data-name")},o.length?i.el.find('[component="category-selector-selected"]').html(o.find('[component="category-markup"]').html()):i.el.find('[component="category-selector-selected"]').html(u)},i.getSelectedCategory=function(){return i.selectedCategory},i.getSelectedCid=function(){return i.selectedCategory?i.selectedCategory.cid:0},r.hasOwnProperty("selectedCategory")&&app.parseAndTranslate(r.template,{selectedCategory:r.selectedCategory},function(s){i.el.find('[component="category-selector-selected"]').html(s.find('[component="category-selector-selected"]').html())}),i},g.modal=function(t){t=t||{},t.onSelect=t.onSelect||function(){},t.onSubmit=t.onSubmit||function(){},app.parseAndTranslate("admin/partials/categories/select-category",{message:t.message},function(r){const h=x.dialog({title:t.title||"[[modules:composer.select-category]]",message:r,buttons:{save:{label:"[[global:select]]",className:"btn-primary",callback:u}}}),i=g.init(h.find('[component="category-selector"]'),t);function u(s){return s.preventDefault(),i.selectedCategory&&(t.onSubmit(i.selectedCategory),h.modal("hide")),!1}t.openOnLoad&&h.on("shown.bs.modal",function(){h.find(".dropdown-toggle").dropdown("toggle")}),h.find("form").on("submit",u)})},g}.apply(E,y),p!==void 0&&(w.exports=p)},86871:(w,E,d)=>{var y,p;y=[d(24187),d(67308),d(65348),d(81335),d(49897),d(40027),d(29930),d(54222)],p=function(b,x,v,m,g,t,r,h){const i={};let u={};i.init=function(){const a=$("#category-settings"),e=$('[component="category/preview"]');a.find("select").each(function(){const n=$(this);n.val(n.attr("data-value"))}),v.init($('[component="settings/main/header"] [component="category-selector"]'),{onSelect:function(n){ajaxify.go("admin/manage/categories/"+n.cid)},cacheList:!1,showLinks:!0,template:"admin/partials/category/selector-dropdown-right"}),v.init($('#parent-category-selector [component="category-selector"]'),{onSelect:function(n){const c=$("#parent-cid");c.val(n.cid),s(c[0])},selectedCategory:ajaxify.data.category.parent,localCategories:[{cid:0,name:"[[admin/manage/categories:parent-category-none]]",icon:"fa-list"}],cacheList:!1,showLinks:!0,template:"admin/partials/category/selector-dropdown-right"}),o(),a.find("input, select, textarea").on("change",function(n){s(n.target)}),$('[type="checkbox"]').on("change",function(){s($(this))}),$('[data-name="imageClass"]').on("change",function(){$(".category-preview").css("background-size",$(this).val())}),$('[data-name="bgColor"], [data-name="color"]').on("input",function(){const n=$(this);n.attr("data-name")==="bgColor"?e.css("background-color",n.val()):n.attr("data-name")==="color"&&e.css("color",n.val()),s(n[0])}),$("#save").on("click",function(){const n=$("#tag-whitelist").val()?$("#tag-whitelist").val().split(","):[];if(n.length&&n.length<parseInt($("#cid-min-tags").val(),10))return r.error("[[admin/manage/categories:alert.not-enough-whitelisted-tags]]");const c=ajaxify.data.category.cid;return g.put("/categories/"+c,u).then(()=>{app.flags._unsaved=!1,h.toggleSaveSuccess($("#save")),u={}}).catch(r.error),!1}),$(".purge").on("click",function(n){n.preventDefault(),m.render("admin/partials/categories/purge",{name:ajaxify.data.category.name,topic_count:ajaxify.data.category.topic_count}).then(function(c){const f=t.dialog({title:"[[admin/manage/categories:purge]]",message:c,size:"large",buttons:{save:{label:"[[modules:bootbox.confirm]]",className:"btn-primary",callback:function(){f.find(".modal-footer button").prop("disabled",!0);const l=setInterval(async()=>{if(ajaxify.data.category)try{const{count:C}=await g.get(`/categories/${ajaxify.data.category.cid}/count`);let k=0;ajaxify.data.category.topic_count>0&&(k=Math.max(0,1-C/ajaxify.data.category.topic_count)*100),f.find(".progress-bar").css({width:k+"%"})}catch(C){clearInterval(l),r.error(C)}},1e3);return g.del("/categories/"+ajaxify.data.category.cid).then(()=>{setTimeout(()=>{l&&clearInterval(l),f.modal("hide"),r.success("[[admin/manage/categories:alert.purge-success]]"),ajaxify.go("admin/manage/categories")},5e3)}).catch(r.error),!1}}}})})}),$(".copy-settings").on("click",function(){return m.render("admin/partials/categories/copy-settings",{}).then(function(n){let c;const f=t.dialog({title:"[[modules:composer.select-category]]",message:n,buttons:{save:{label:"[[modules:bootbox.confirm]]",className:"btn-primary",callback:function(){if(!(!c||parseInt(c,10)===parseInt(ajaxify.data.category.cid,10)))return socket.emit("admin.categories.copySettingsFrom",{fromCid:c,toCid:ajaxify.data.category.cid,copyParent:f.find("#copyParent").prop("checked")},function(l){if(l)return r.error(l);f.modal("hide"),alert.success("[[admin/manage/categories:alert.copy-success]]"),ajaxify.refresh()}),!1}}}});f.find(".modal-footer button").prop("disabled",!0),v.init(f.find('[component="category-selector"]'),{onSelect:function(l){c=l&&l.cid,c&&f.find(".modal-footer button").prop("disabled",!1)},showLinks:!0})}),!1}),$(".upload-button").on("click",function(){const c=$(this).attr("data-cid");b.show({title:"[[admin/manage/categories:alert.upload-image]]",route:config.relative_path+"/api/admin/category/uploadpicture",params:{cid:c}},function(f){$("#category-image").val(f),e.css("background-image","url("+f+"?"+new Date().getTime()+")"),s($("#category-image"))})}),$("#category-image").on("change",function(){e.css("background-image",$(this).val()?'url("'+$(this).val()+'")':""),s($("#category-image"))}),$(".delete-image").on("click",function(n){n.preventDefault();const c=$("#category-image");c.val(""),e.css("background-image",""),s(c[0])}),e.on("click",function(){x.init($(this).find("i"),s)}),$('button[data-action="toggle"]').on("click",function(){const n=$(this),c=n.attr("data-disabled")==="1";g.put("/categories/"+ajaxify.data.category.cid,{disabled:c?0:1}).then(()=>{n.find(".label").translateText(c?"[[admin/manage/categories:disable]]":"[[admin/manage/categories:enable]]"),n.find("i").toggleClass(["fa-check","text-success"],!c).toggleClass(["fa-ban","text-danger"],c),n.attr("data-disabled",c?0:1)}).catch(r.error)})};function s(a){let e;$(a).is(":checkbox")?e=$(a).is(":checked")?1:0:e=$(a).val();const c=$(a).attr("data-name").match(/[^\][.]+/g);function f(l,C){C!==c.length&&(l[c[C]]=l[c[C]]||{},C===c.length-1&&(l[c[C]]=e),f(l[c[C]],C+1))}c&&c.length&&(c.length===1?u[c[0]]=e:c.length>1&&f(u,0)),app.flags=app.flags||{},app.flags._unsaved=!0}function o(){const a=$("#tag-whitelist");a.tagsinput({tagClass:"badge bg-info",confirmKeys:[13,44],trimValue:!0}),ajaxify.data.category.tagWhitelist.forEach(function(e){a.tagsinput("add",e)}),a.on("itemAdded itemRemoved",function(){s(a)})}return i}.apply(E,y),p!==void 0&&(w.exports=p)},96349:(w,E,d)=>{var y,p;y=[d(29930),d(89336),d(49897)],p=function(b,x,v){const m={};return m.init=function(g,t){let r=null;t=t||{},t.privilege=t.privilege||"topics:read",t.states=t.states||["watching","tracking","notwatching","ignoring"],t.cacheList=t.hasOwnProperty("cacheList")?t.cacheList:!0;let h=[];Array.isArray(t.localCategories)&&(h=t.localCategories.map(a=>({...a}))),t.selectedCids=t.selectedCids||ajaxify.data.selectedCids||[];const i=g.find('[component="category-selector-search"]');if(!i.length)return;const u=i.parent('[component="category/dropdown"]').length>0||i.parent('[component="category-selector"]').length>0;g.on("show.bs.dropdown",function(){u&&(g.find(".dropdown-toggle").css({visibility:"hidden"}),i.removeClass("hidden"),i.css({"z-index":g.find(".dropdown-toggle").css("z-index")+1}));function a(){const e=i.find("input").val();e.length>1||!e&&!r?s(e,function(n){r=t.cacheList&&(r||n),o(n)}):!e&&r&&o(r)}i.on("click",function(e){e.preventDefault(),e.stopPropagation()}),i.find("input").val("").on("keyup",utils.debounce(a,300)),a()}),g.on("shown.bs.dropdown",function(){["xs","sm"].includes(utils.findBootstrapEnvironment())||i.find("input").focus()}),g.on("hide.bs.dropdown",function(){u&&(g.find(".dropdown-toggle").css({visibility:"inherit"}),i.addClass("hidden")),i.off("click"),i.find("input").off("keyup")});function s(a,e){v.get("/search/categories",{search:a,query:utils.params(),parentCid:t.parentCid||0,selectedCids:t.selectedCids,privilege:t.privilege,states:t.states,showLinks:t.showLinks},function(n,{categories:c}){if(n)return b.error(n);e(h.concat(c))})}function o(a){const e=t.selectedCids.map(String);a.forEach(function(n){n.selected=e.includes(String(n.cid))}),app.parseAndTranslate(t.template,{categoryItems:a.slice(0,200),selectedCategory:ajaxify.data.selectedCategory,allCategoriesUrl:ajaxify.data.allCategoriesUrl},function(n){g.find('[component="category/list"]').html(n.find('[component="category/list"]').html()),g.find('[component="category/list"] [component="category/no-matches"]').toggleClass("hidden",!!a.length);const c=x.Dropdown.getInstance(g.find(".dropdown-toggle").get(0));c&&c.update()})}},m}.apply(E,y),p!==void 0&&(w.exports=p)}}]);
