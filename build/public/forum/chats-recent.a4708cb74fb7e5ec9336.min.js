"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[56418,61462,99127,34271,1091,49897,26832],{26832:(y,u,o)=>{var f,h;f=[o(29930),o(49897),o(92619)],h=function(d,D,E){const c={};c.init=function(){Promise.all([o.e(6411),o.e(54516),o.e(60419),o.e(16255)]).then(function(){var a=[o(38636)];(function(i){$('[component="chat/nav-wrapper"]').on("click",'[component="chat/recent/room"], [component="chat/public/room"]',function(r){r.stopPropagation(),r.preventDefault();const l=this.getAttribute("data-roomid");i.switchChat(l)}).on("click",".mark-read",function(r){r.stopPropagation();const l=this.closest("[data-roomid]");E.toggleReadState(l)}),$('[component="chat/recent"]').on("scroll",utils.debounce(function(){const r=$(this),l=(r[0].scrollHeight-r.height())*.9;r.scrollTop()>l&&g()},100))}).apply(null,a)}).catch(o.oe)};async function g(){const a=$('[component="chat/recent"]');a.attr("loading")||(a.attr("loading",1),D.get("/chats",{uid:ajaxify.data.uid,start:a.attr("data-nextstart")}).then(({rooms:i,nextStart:r})=>{i.length?p({rooms:i,nextStart:r},function(){a.removeAttr("loading"),a.attr("data-nextstart",r)}):a.removeAttr("loading")}).catch(d.error))}function p(a,i){if(!a.rooms.length)return i();a.loadingMore=!0,app.parseAndTranslate("chats","rooms",a,function(r){$('[component="chat/recent"]').append(r),r.find(".timeago").timeago(),i()})}return c}.apply(u,f),h!==void 0&&(y.exports=h)},49897:(y,u,o)=>{o.r(u),o.d(u,{del:()=>O,get:()=>p,head:()=>a,patch:()=>r,post:()=>i,put:()=>l});var f=o(91749),h=o.n(f),d=o(40027),D=o.n(d);const E=config.relative_path+"/api/v3";async function c(t,e){if(t.url=t.url.startsWith("/api")?config.relative_path+t.url:E+t.url,typeof e=="function"){g(t).then(n=>e(null,n),n=>e(n));return}try{return await g(t)}catch(n){if(n.message==="A valid login session was not found. Please log in and try again."){const{url:A}=await(0,f.fire)("filter:admin.reauth",{url:"login"});return(0,d.confirm)("[[error:api.reauth-required]]",m=>{m&&ajaxify.go(A)})}throw n}}async function g(t){const{url:e}=t;delete t.url,t.data&&!(t.data instanceof FormData)&&(t.data=JSON.stringify(t.data||{}),t.headers["content-type"]="application/json; charset=utf-8"),{options:t}=await(0,f.fire)("filter:api.options",{options:t}),t.data&&(t.body=t.data,delete t.data);const n=await fetch(e,t),{headers:A}=n,m=A.get("content-type"),P=m&&m.startsWith("application/json");let s;if(t.method!=="HEAD"&&(P?s=await n.json():s=await n.text()),!n.ok)throw s?new Error(P?s.status.message:s):new Error(n.statusText);return P&&s&&s.hasOwnProperty("status")&&s.hasOwnProperty("response")?s.response:s}function p(t,e,n){return c({url:t+(e&&Object.keys(e).length?"?"+$.param(e):"")},n)}function a(t,e,n){return c({url:t+(e&&Object.keys(e).length?"?"+$.param(e):""),method:"HEAD"},n)}function i(t,e,n){return c({url:t,method:"POST",data:e,headers:{"x-csrf-token":config.csrf_token}},n)}function r(t,e,n){return c({url:t,method:"PATCH",data:e,headers:{"x-csrf-token":config.csrf_token}},n)}function l(t,e,n){return c({url:t,method:"PUT",data:e,headers:{"x-csrf-token":config.csrf_token}},n)}function O(t,e,n){return c({url:t,method:"DELETE",data:e,headers:{"x-csrf-token":config.csrf_token}},n)}}}]);
