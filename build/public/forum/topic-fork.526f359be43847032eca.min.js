"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,34271,38395,49771,49897,69185,86198,95431,99127],{16227:(A,E,l)=>{var h,g;h=[l(52473)],g=function(k){const i={};let C;i.pids=[];let m=!1;i.init=function(t,r){i.pids.length=0,C=t,r=r||{},m=r.allowMainPostSelect||!1,$("#content").on("click",'[component="topic"] [component="post"]',s),c()};function s(t){t.stopPropagation();const r=$(this).attr("data-pid"),d=$('[component="topic"] [data-pid="'+r+'"]');!m&&parseInt($(this).attr("data-index"),10)===0||i.togglePostSelection(d,r)}i.disable=function(){i.pids.forEach(function(t){k.get("post","pid",t).toggleClass("selected",!1)}),$("#content").off("click",'[component="topic"] [component="post"]',s),u()},i.togglePostSelection=function(t,r){if(r){const d=i.pids.indexOf(r);d===-1?(i.pids.push(r),t.toggleClass("selected",!0)):(i.pids.splice(d,1),t.toggleClass("selected",!1)),i.pids.length&&i.pids.sort(function(n,a){return n-a}),typeof C=="function"&&C()}};function e(){return!1}function c(){$("#content").on("click",'[component="post"] button, [component="post"] a',e)}function u(){$("#content").off("click",'[component="post"] button, [component="post"] a',e)}return i}.apply(E,h),g!==void 0&&(A.exports=g)},49771:(A,E,l)=>{var h,g;h=[l(52473),l(16227),l(29930),l(65348)],g=function(k,i,C,m){const s={};let e,c,u,t;s.init=function(){u=ajaxify.data.tid,t=ajaxify.data.category,$(window).off("action:ajaxify.end",r).on("action:ajaxify.end",r),!e&&app.parseAndTranslate("modals/fork-topic",{selectedCategory:t},function(f){e=f,c=e.find("#fork_thread_commit"),$("body").append(e),m.init(e.find('[component="category-selector"]'),{onSelect:function(y){t=y},privilege:"moderate"}),e.find("#fork_thread_cancel").on("click",o),e.find("#fork-title").on("keyup",a),i.init(function(){a(),n()}),n(),c.on("click",d)})};function r(){(ajaxify.data.template.name!=="topic"||ajaxify.data.tid!==u)&&(o(),$(window).off("action:ajaxify.end",r))}function d(){t&&(c.attr("disabled",!0),socket.emit("topics.createTopicFromPosts",{title:e.find("#fork-title").val(),pids:i.pids,fromTid:u,cid:t.cid},function(f,y){function P(p){k.get("post","pid",p).fadeOut(500,function(){$(this).remove()})}if(c.removeAttr("disabled"),f)return C.error(f.message);C.alert({timeout:5e3,title:"[[global:alert.success]]",message:"[[topic:fork-success]]",type:"success",clickfn:function(){ajaxify.go("topic/"+y.slug)}}),i.pids.forEach(function(p){P(p)}),o()}))}function n(){i.pids.length?e.find("#fork-pids").translateHtml("[[topic:fork-pid-count, "+i.pids.length+"]]"):e.find("#fork-pids").translateHtml("[[topic:fork-no-pids]]")}function a(){e.find("#fork-title").val().length&&i.pids.length?c.removeAttr("disabled"):c.attr("disabled",!0)}function o(){e&&(e.remove(),e=null,i.disable())}return s}.apply(E,h),g!==void 0&&(A.exports=g)},49897:(A,E,l)=>{l.r(E),l.d(E,{del:()=>d,get:()=>e,head:()=>c,patch:()=>t,post:()=>u,put:()=>r});var h=l(91749),g=l.n(h),k=l(40027),i=l.n(k);const C=config.relative_path+"/api/v3";async function m(n,a){if(n.url=n.url.startsWith("/api")?config.relative_path+n.url:C+n.url,typeof a=="function"){s(n).then(o=>a(null,o),o=>a(o));return}try{return await s(n)}catch(o){if(o.message==="A valid login session was not found. Please log in and try again."){const{url:f}=await(0,h.fire)("filter:admin.reauth",{url:"login"});return(0,k.confirm)("[[error:api.reauth-required]]",y=>{y&&ajaxify.go(f)})}throw o}}async function s(n){const{url:a}=n;delete n.url,n.data&&!(n.data instanceof FormData)&&(n.data=JSON.stringify(n.data||{}),n.headers["content-type"]="application/json; charset=utf-8"),{options:n}=await(0,h.fire)("filter:api.options",{options:n}),n.data&&(n.body=n.data,delete n.data);const o=await fetch(a,n),{headers:f}=o,y=f.get("content-type"),P=y&&y.startsWith("application/json");let p;if(n.method!=="HEAD"&&(P?p=await o.json():p=await o.text()),!o.ok)throw p?new Error(P?p.status.message:p):new Error(o.statusText);return P&&p&&p.hasOwnProperty("status")&&p.hasOwnProperty("response")?p.response:p}function e(n,a,o){return m({url:n+(a&&Object.keys(a).length?"?"+$.param(a):"")},o)}function c(n,a,o){return m({url:n+(a&&Object.keys(a).length?"?"+$.param(a):""),method:"HEAD"},o)}function u(n,a,o){return m({url:n,method:"POST",data:a,headers:{"x-csrf-token":config.csrf_token}},o)}function t(n,a,o){return m({url:n,method:"PATCH",data:a,headers:{"x-csrf-token":config.csrf_token}},o)}function r(n,a,o){return m({url:n,method:"PUT",data:a,headers:{"x-csrf-token":config.csrf_token}},o)}function d(n,a,o){return m({url:n,method:"DELETE",data:a,headers:{"x-csrf-token":config.csrf_token}},o)}},65348:(A,E,l)=>{var h,g;h=[l(96349),l(40027),l(91749),l(17459)],g=function(k,i,C,m){const s={};return s.init=function(e,c){if(!e||!e.length)return;c=c||{};const u=c.onSelect||function(){};c.states=c.states||["watching","tracking","notwatching","ignoring"],c.template=c.template||"partials/category/selector-dropdown-left",C.fire("action:category.selector.options",{el:e,options:c}),k.init(e,c);const t={el:e,selectedCategory:null};e.on("click","[data-cid]",function(){const d=$(this);return d.hasClass("disabled")?!1:(t.selectCategory(d.attr("data-cid")),u(t.selectedCategory))});let r=t.el.find('[component="category-selector-selected"]').html();return m.translate(r,d=>{r=d}),t.selectCategory=function(d){const n=t.el.find('[data-cid="'+d+'"]');t.selectedCategory={cid:d,name:n.attr("data-name")},n.length?t.el.find('[component="category-selector-selected"]').html(n.find('[component="category-markup"]').html()):t.el.find('[component="category-selector-selected"]').html(r)},t.getSelectedCategory=function(){return t.selectedCategory},t.getSelectedCid=function(){return t.selectedCategory?t.selectedCategory.cid:0},c.hasOwnProperty("selectedCategory")&&app.parseAndTranslate(c.template,{selectedCategory:c.selectedCategory},function(d){t.el.find('[component="category-selector-selected"]').html(d.find('[component="category-selector-selected"]').html())}),t},s.modal=function(e){e=e||{},e.onSelect=e.onSelect||function(){},e.onSubmit=e.onSubmit||function(){},app.parseAndTranslate("admin/partials/categories/select-category",{message:e.message},function(c){const u=i.dialog({title:e.title||"[[modules:composer.select-category]]",message:c,buttons:{save:{label:"[[global:select]]",className:"btn-primary",callback:r}}}),t=s.init(u.find('[component="category-selector"]'),e);function r(d){return d.preventDefault(),t.selectedCategory&&(e.onSubmit(t.selectedCategory),u.modal("hide")),!1}e.openOnLoad&&u.on("shown.bs.modal",function(){u.find(".dropdown-toggle").dropdown("toggle")}),u.find("form").on("submit",r)})},s}.apply(E,h),g!==void 0&&(A.exports=g)},96349:(A,E,l)=>{var h,g;h=[l(29930),l(89336),l(49897)],g=function(k,i,C){const m={};return m.init=function(s,e){let c=null;e=e||{},e.privilege=e.privilege||"topics:read",e.states=e.states||["watching","tracking","notwatching","ignoring"],e.cacheList=e.hasOwnProperty("cacheList")?e.cacheList:!0;let u=[];Array.isArray(e.localCategories)&&(u=e.localCategories.map(a=>({...a}))),e.selectedCids=e.selectedCids||ajaxify.data.selectedCids||[];const t=s.find('[component="category-selector-search"]');if(!t.length)return;const r=t.parent('[component="category/dropdown"]').length>0||t.parent('[component="category-selector"]').length>0;s.on("show.bs.dropdown",function(){r&&(s.find(".dropdown-toggle").css({visibility:"hidden"}),t.removeClass("hidden"),t.css({"z-index":s.find(".dropdown-toggle").css("z-index")+1}));function a(){const o=t.find("input").val();o.length>1||!o&&!c?d(o,function(f){c=e.cacheList&&(c||f),n(f)}):!o&&c&&n(c)}t.on("click",function(o){o.preventDefault(),o.stopPropagation()}),t.find("input").val("").on("keyup",utils.debounce(a,300)),a()}),s.on("shown.bs.dropdown",function(){["xs","sm"].includes(utils.findBootstrapEnvironment())||t.find("input").focus()}),s.on("hide.bs.dropdown",function(){r&&(s.find(".dropdown-toggle").css({visibility:"inherit"}),t.addClass("hidden")),t.off("click"),t.find("input").off("keyup")});function d(a,o){C.get("/search/categories",{search:a,query:utils.params(),parentCid:e.parentCid||0,selectedCids:e.selectedCids,privilege:e.privilege,states:e.states,showLinks:e.showLinks},function(f,{categories:y}){if(f)return k.error(f);o(u.concat(y))})}function n(a){const o=e.selectedCids.map(String);a.forEach(function(f){f.selected=o.includes(String(f.cid))}),app.parseAndTranslate(e.template,{categoryItems:a.slice(0,200),selectedCategory:ajaxify.data.selectedCategory,allCategoriesUrl:ajaxify.data.allCategoriesUrl},function(f){s.find('[component="category/list"]').html(f.find('[component="category/list"]').html()),s.find('[component="category/list"] [component="category/no-matches"]').toggleClass("hidden",!!a.length);const y=i.Dropdown.getInstance(s.find(".dropdown-toggle").get(0));y&&y.update()})}},m}.apply(E,h),g!==void 0&&(A.exports=g)}}]);
