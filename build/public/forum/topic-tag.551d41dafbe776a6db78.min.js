"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[63,1091,13417,27509,34271,34405,49897,99127],{63:(D,A,f)=>{var h,E;h=[f(29930),f(34405),f(49897),f(81335)],E=function(T,x,d,m){const y={};let o,a,i,s;y.init=function(e,t,r){o||(i=e,s=t||[],app.parseAndTranslate("modals/tag-topic",{topics:i,tagWhitelist:s},function(l){o=l,a=o.find("#tag-topic-commit"),$("body").append(o),o.find("#tag-topic-cancel").on("click",n),a.on("click",async()=>{await u(),r&&r()}),o.find(".tags").each((g,p)=>{const P=$(p),O=P.tagsinput({tagClass:"badge bg-info",confirmKeys:[13,44],trimValue:!0}),v=O[0].$input;i[g].tags.forEach(_=>P.tagsinput("add",_.value)),P.on("itemAdded",function(_){s.length&&!s.includes(_.item)&&(P.tagsinput("remove",_.item),T.error("[[error:tag-not-allowed]]")),v.length&&v.autocomplete("close")}),c({input:v,container:O[0].$container})})}))};function c(e){x.init({input:e.input,position:{my:"left bottom",at:"left top",collision:"flip"},appendTo:e.container,source:async(t,r)=>{socket.emit("topics.autocompleteTags",{query:t.term},function(l,g){if(l)return T.error(l);g&&r(g)})}})}async function u(){await Promise.all(o.find(".tags").map(async(e,t)=>{const r=i[e],l=$(t);r.tags=await d.put(`/topics/${r.tid}/tags`,{tags:l.tagsinput("items")}),y.updateTopicTags([r])})),n()}y.updateTopicTags=function(e){e.forEach(t=>{const r=ajaxify.data.template.topic?"partials/topic/tags":"partials/category/tags";m.render(r,{tags:t.tags}).then(function(l){const g=$(`[data-tid="${t.tid}"][component="topic/tags"]`);g.fadeOut(250,function(){g.toggleClass("hidden",t.tags.length===0),g.html(l).fadeIn(250)})})})};function n(){o&&(o.remove(),o=null)}return y}.apply(A,h),E!==void 0&&(D.exports=E)},34405:(D,A,f)=>{var h,E;h=[f(49897),f(29930)],E=function(T,x){const d={},m={delay:200,appendTo:null};d.init=o=>{const a={...m,...o},{input:i,onSelect:s}=a;app.loadJQueryUI(function(){i.autocomplete({...a,open:function(){$(this).autocomplete("widget").css("z-index",100005)},select:function(c,u){y(i,s,c,u)}})})},d.user=function(o,a,i){typeof a=="function"&&(i=a,a={}),a=a||{},d.init({input:o,onSelect:i,source:(s,c)=>{a.query=s.term,T.get("/api/users",a,function(u,n){if(u)return x.error(u);if(n&&n.users){const e=n.users.map(function(t){const r=$("<div></div>").html(t.username).text();return t&&{label:r,value:r,user:{uid:t.uid,name:t.username,slug:t.userslug,username:t.username,userslug:t.userslug,picture:t.picture,banned:t.banned,"icon:text":t["icon:text"],"icon:bgColor":t["icon:bgColor"]}}});c(e)}$(".ui-autocomplete a").attr("data-ajaxify","false")})}})},d.group=function(o,a){d.init({input:o,onSelect:a,source:(i,s)=>{socket.emit("groups.search",{query:i.term},function(c,u){if(c)return x.error(c);if(u&&u.length){const n=u.map(function(e){return e&&{label:e.name,value:e.name,group:e}});s(n)}$(".ui-autocomplete a").attr("data-ajaxify","false")})}})},d.tag=function(o,a){d.init({input:o,onSelect:a,delay:100,source:(i,s)=>{socket.emit("topics.autocompleteTags",{query:i.term,cid:ajaxify.data.cid||0},function(c,u){if(c)return x.error(c);u&&s(u),$(".ui-autocomplete a").attr("data-ajaxify","false")})}})};function y(o,a,i,s){a=a||function(){};const c=jQuery.Event("keypress");c.which=13,c.keyCode=13,setTimeout(function(){o.trigger(c)},100),a(i,s)}return d}.apply(A,h),E!==void 0&&(D.exports=E)},49897:(D,A,f)=>{f.r(A),f.d(A,{del:()=>u,get:()=>o,head:()=>a,patch:()=>s,post:()=>i,put:()=>c});var h=f(91749),E=f.n(h),T=f(40027),x=f.n(T);const d=config.relative_path+"/api/v3";async function m(n,e){if(n.url=n.url.startsWith("/api")?config.relative_path+n.url:d+n.url,typeof e=="function"){y(n).then(t=>e(null,t),t=>e(t));return}try{return await y(n)}catch(t){if(t.message==="A valid login session was not found. Please log in and try again."){const{url:r}=await(0,h.fire)("filter:admin.reauth",{url:"login"});return(0,T.confirm)("[[error:api.reauth-required]]",l=>{l&&ajaxify.go(r)})}throw t}}async function y(n){const{url:e}=n;delete n.url,n.data&&!(n.data instanceof FormData)&&(n.data=JSON.stringify(n.data||{}),n.headers["content-type"]="application/json; charset=utf-8"),{options:n}=await(0,h.fire)("filter:api.options",{options:n}),n.data&&(n.body=n.data,delete n.data);const t=await fetch(e,n),{headers:r}=t,l=r.get("content-type"),g=l&&l.startsWith("application/json");let p;if(n.method!=="HEAD"&&(g?p=await t.json():p=await t.text()),!t.ok)throw p?new Error(g?p.status.message:p):new Error(t.statusText);return g&&p&&p.hasOwnProperty("status")&&p.hasOwnProperty("response")?p.response:p}function o(n,e,t){return m({url:n+(e&&Object.keys(e).length?"?"+$.param(e):"")},t)}function a(n,e,t){return m({url:n+(e&&Object.keys(e).length?"?"+$.param(e):""),method:"HEAD"},t)}function i(n,e,t){return m({url:n,method:"POST",data:e,headers:{"x-csrf-token":config.csrf_token}},t)}function s(n,e,t){return m({url:n,method:"PATCH",data:e,headers:{"x-csrf-token":config.csrf_token}},t)}function c(n,e,t){return m({url:n,method:"PUT",data:e,headers:{"x-csrf-token":config.csrf_token}},t)}function u(n,e,t){return m({url:n,method:"DELETE",data:e,headers:{"x-csrf-token":config.csrf_token}},t)}}}]);
