"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,12533,22765,34271,49897,92747,99127],{2269:(D,E)=>{var c,u;c=[],u=function(){const h={},d=/-resized(\.[\w]+)?$/;return h.wrapImagesInLinks=function(m){m.find('[component="post/content"] img:not(.emoji)').each(function(){h.wrapImageInLink($(this))})},h.wrapImageInLink=function(m){let a=m.attr("src")||"";if(a!=="about:blank"&&!m.parent().is("a")){utils.isRelativeUrl(a)&&d.test(a)&&(a=a.replace(d,"$1"));const r=m.attr("alt")||"",y=a.split(".").slice(1).pop(),g=r.split("/").pop(),s=g.split(".").slice(1).pop();m.wrap('<a href="'+a+'" '+(!y&&s?' download="'+utils.escapeHTML(g)+'" ':"")+' target="_blank" rel="noopener">')}},h}.apply(E,c),u!==void 0&&(D.exports=u)},49897:(D,E,c)=>{c.r(E),c.d(E,{del:()=>i,get:()=>g,head:()=>s,patch:()=>l,post:()=>f,put:()=>o});var u=c(91749),h=c.n(u),d=c(40027),m=c.n(d);const a=config.relative_path+"/api/v3";async function r(t,n){if(t.url=t.url.startsWith("/api")?config.relative_path+t.url:a+t.url,typeof n=="function"){y(t).then(e=>n(null,e),e=>n(e));return}try{return await y(t)}catch(e){if(e.message==="A valid login session was not found. Please log in and try again."){const{url:_}=await(0,u.fire)("filter:admin.reauth",{url:"login"});return(0,d.confirm)("[[error:api.reauth-required]]",b=>{b&&ajaxify.go(_)})}throw e}}async function y(t){const{url:n}=t;delete t.url,t.data&&!(t.data instanceof FormData)&&(t.data=JSON.stringify(t.data||{}),t.headers["content-type"]="application/json; charset=utf-8"),{options:t}=await(0,u.fire)("filter:api.options",{options:t}),t.data&&(t.body=t.data,delete t.data);const e=await fetch(n,t),{headers:_}=e,b=_.get("content-type"),P=b&&b.startsWith("application/json");let p;if(t.method!=="HEAD"&&(P?p=await e.json():p=await e.text()),!e.ok)throw p?new Error(P?p.status.message:p):new Error(e.statusText);return P&&p&&p.hasOwnProperty("status")&&p.hasOwnProperty("response")?p.response:p}function g(t,n,e){return r({url:t+(n&&Object.keys(n).length?"?"+$.param(n):"")},e)}function s(t,n,e){return r({url:t+(n&&Object.keys(n).length?"?"+$.param(n):""),method:"HEAD"},e)}function f(t,n,e){return r({url:t,method:"POST",data:n,headers:{"x-csrf-token":config.csrf_token}},e)}function l(t,n,e){return r({url:t,method:"PATCH",data:n,headers:{"x-csrf-token":config.csrf_token}},e)}function o(t,n,e){return r({url:t,method:"PUT",data:n,headers:{"x-csrf-token":config.csrf_token}},e)}function i(t,n,e){return r({url:t,method:"DELETE",data:n,headers:{"x-csrf-token":config.csrf_token}},e)}},92747:(D,E,c)=>{var u,h;u=[c(49897),c(40027),c(29930),c(2269)],h=function(d,m,a){const r={},y={year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric"};r.open=function(s){config.enablePostHistory&&d.get(`/posts/${s}/diffs`,{}).then(f=>{g(f).then(l=>{const o=m.dialog({title:"[[topic:diffs.title]]",message:l,size:"large",onEscape:!0,backdrop:!0});if(!f.timestamps.length)return;const i=o.find("select"),t=o.find('button[data-action="restore"]'),n=o.find('button[data-action="delete"]'),e=o.find("ul.posts-list"),_=o.find(".number-of-diffs strong");i.on("change",function(){r.load(s,this.value,e),t.prop("disabled",f.timestamps.indexOf(this.value)===0),n.prop("disabled",f.timestamps.indexOf(this.value)===0)}),t.on("click",function(){r.restore(s,i.val(),o)}),n.on("click",function(){r.delete(s,i.val(),i,_)}),o.on("shown.bs.modal",function(){r.load(s,i.val(),e),t.prop("disabled",!0),n.prop("disabled",!0)})})}).catch(a.error)},r.load=function(s,f,l){config.enablePostHistory&&d.get(`/posts/${s}/diffs/${f}`,{}).then(o=>{o.deleted=!!parseInt(o.deleted,10),app.parseAndTranslate("partials/posts_list","posts",{posts:[o]},function(i){l.empty().append(i),l.find(".timeago").timeago()})}).catch(a.error)},r.restore=function(s,f,l){config.enablePostHistory&&d.put(`/posts/${s}/diffs/${f}`,{}).then(()=>{l.modal("hide"),a.success("[[topic:diffs.post-restored]]")}).catch(a.error)},r.delete=function(s,f,l,o){d.del(`/posts/${s}/diffs/${f}`).then(i=>{g(i,"diffs").then(t=>{l.empty().append(t),l.trigger("change");const n=l.find("option").length;o.text(n),a.success("[[topic:diffs.deleted]]")})}).catch(a.error)};function g(s,f){return new Promise(l=>{const o=[{diffs:s.revisions.map(function(i){const t=parseInt(i.timestamp,10);return{username:i.username,timestamp:t,pretty:new Date(t).toLocaleString(config.userLang.replace("_","-"),y)}}),numDiffs:s.timestamps.length,editable:s.editable,deletable:s.deletable},function(i){l(i)}];f&&o.unshift(f),app.parseAndTranslate("modals/post-history",...o)})}return r}.apply(E,u),h!==void 0&&(D.exports=h)}}]);
