"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,34271,49897,66131,95737,99127],{30637:(C,E,a)=>{var f,h;f=[a(49897),a(81335),a(40027),a(29930)],h=function(m,D,A,r){const i={};function o(){return ajaxify.data.template.name.startsWith("admin/")}return i.handle=function(){$('[component="user/invite"]').on("click",function(p){p.preventDefault(),m.get(`/api/v3/users/${app.user.uid}/invites/groups`,{}).then(g=>{D.parse("modals/invite",{groups:g},function(u){A.dialog({message:u,title:`[[${o()?"admin/manage/users:invite":"users:invite"}]]`,onEscape:!0,buttons:{cancel:{label:`[[${o()?"admin/manage/users:alerts.button-cancel":"modules:bootbox.cancel"}]]`,className:"btn-default"},invite:{label:`[[${o()?"admin/manage/users:invite":"users:invite"}]]`,className:"btn-primary",callback:i.send}}})})}).catch(r.error)})},i.send=function(){const p=$("#invite-modal-emails"),g=$("#invite-modal-groups"),u={emails:p.val().split(",").map(v=>v.trim()).filter(Boolean).filter((v,y,t)=>y===t.indexOf(v)).join(","),groupsToJoin:g.val()};u.emails&&m.post(`/users/${app.user.uid}/invites`,u).then(()=>{r.success(`[[${o()?"admin/manage/users:alerts.email-sent-to":"users:invitation-email-sent"}, ${u.emails.replace(/,/g,"&#44; ")}]]`)}).catch(r.error)},i}.apply(E,f),h!==void 0&&(C.exports=h)},34567:(C,E,a)=>{var f,h;f=[a(81335),a(49897),a(29930),a(30637)],h=function(m,D,A,r){const i={};let o=0;i.init=function(){app.enterRoom("user_list");const e=utils.param("section")?"?section="+utils.param("section"):"",s=$('[component="user/list/menu"]');s.find("a").removeClass("active"),s.find('a[href="'+window.location.pathname+e+'"]').addClass("active"),i.handleSearch(),r.handle(),socket.removeListener("event:user_status_change",y),socket.on("event:user_status_change",y)},i.handleSearch=function(e){o=e&&e.resultCount,$("#search-user").on("keyup",utils.debounce(p,250)),$('.search select, .search input[type="checkbox"]').on("change",p)};function p(){if(!ajaxify.data.template.users)return;$('[component="user/search/icon"]').removeClass("fa-search").addClass("fa-spinner fa-spin");const e=$("#search-user").val(),s=n(),c={section:s,page:1};if(!e)return u(c);c.query=e,c.sortBy=g();const d=[];($(".search .online-only").is(":checked")||s==="online")&&d.push("online"),s==="banned"&&d.push("banned"),s==="flagged"&&d.push("flagged"),d.length&&(c.filters=d),u(c)}function g(){let e;const s=n();return s==="sort-posts"?e="postcount":s==="sort-reputation"?e="reputation":s==="users"&&(e="joindate"),e}function u(e){D.get("/api/users",e).then(v).catch(A.error)}function v(e){m.render("partials/paginator",{pagination:e.pagination}).then(function(s){$(".pagination-container").replaceWith(s)}),o&&(e.users=e.users.slice(0,o)),e.isAdminOrGlobalMod=app.user.isAdmin||app.user.isGlobalMod,app.parseAndTranslate("users","users",e,function(s){$("#users-container").html(s),s.find(".timeago").timeago(),$('[component="user/search/icon"]').addClass("fa-search").removeClass("fa-spinner fa-spin")})}function y(e){const s=n();(s.startsWith("online")||s.startsWith("users"))&&t(e)}function t(e){app.updateUserStatus($('#users-container [data-uid="'+e.uid+'"] [component="user/status"]'),e.status)}function n(){return utils.param("section")||""}return i}.apply(E,f),h!==void 0&&(C.exports=h)},49897:(C,E,a)=>{a.r(E),a.d(E,{del:()=>y,get:()=>o,head:()=>p,patch:()=>u,post:()=>g,put:()=>v});var f=a(91749),h=a.n(f),m=a(40027),D=a.n(m);const A=config.relative_path+"/api/v3";async function r(t,n){if(t.url=t.url.startsWith("/api")?config.relative_path+t.url:A+t.url,typeof n=="function"){i(t).then(e=>n(null,e),e=>n(e));return}try{return await i(t)}catch(e){if(e.message==="A valid login session was not found. Please log in and try again."){const{url:s}=await(0,f.fire)("filter:admin.reauth",{url:"login"});return(0,m.confirm)("[[error:api.reauth-required]]",c=>{c&&ajaxify.go(s)})}throw e}}async function i(t){const{url:n}=t;delete t.url,t.data&&!(t.data instanceof FormData)&&(t.data=JSON.stringify(t.data||{}),t.headers["content-type"]="application/json; charset=utf-8"),{options:t}=await(0,f.fire)("filter:api.options",{options:t}),t.data&&(t.body=t.data,delete t.data);const e=await fetch(n,t),{headers:s}=e,c=s.get("content-type"),d=c&&c.startsWith("application/json");let l;if(t.method!=="HEAD"&&(d?l=await e.json():l=await e.text()),!e.ok)throw l?new Error(d?l.status.message:l):new Error(e.statusText);return d&&l&&l.hasOwnProperty("status")&&l.hasOwnProperty("response")?l.response:l}function o(t,n,e){return r({url:t+(n&&Object.keys(n).length?"?"+$.param(n):"")},e)}function p(t,n,e){return r({url:t+(n&&Object.keys(n).length?"?"+$.param(n):""),method:"HEAD"},e)}function g(t,n,e){return r({url:t,method:"POST",data:n,headers:{"x-csrf-token":config.csrf_token}},e)}function u(t,n,e){return r({url:t,method:"PATCH",data:n,headers:{"x-csrf-token":config.csrf_token}},e)}function v(t,n,e){return r({url:t,method:"PUT",data:n,headers:{"x-csrf-token":config.csrf_token}},e)}function y(t,n,e){return r({url:t,method:"DELETE",data:n,headers:{"x-csrf-token":config.csrf_token}},e)}}}]);
