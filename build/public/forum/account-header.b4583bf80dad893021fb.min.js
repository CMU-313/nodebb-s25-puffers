(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,4884,5719,16852,34271,42289,43400,49897,97082,99127],{7524:(y,b,u)=>{"use strict";var m,h;m=[u(72254),u(49897),u(40027),u(29930)],h=((p,i,r,n)=>{const o={};o.openChangeModal=()=>{socket.emit("user.getProfilePictures",{uid:ajaxify.data.uid},function(a,f){if(a)return n.error(a);const l=f.reduce(function(c,e){return c||e.type==="uploaded"},!1);app.parseAndTranslate("modals/change-picture",{pictures:f,uploaded:l,icon:{text:ajaxify.data["icon:text"],bgColor:ajaxify.data["icon:bgColor"]},defaultAvatar:ajaxify.data.defaultAvatar,allowProfileImageUploads:ajaxify.data.allowProfileImageUploads,iconBackgrounds:ajaxify.data.iconBackgrounds,user:{uid:ajaxify.data.uid,username:ajaxify.data.username,picture:ajaxify.data.picture,"icon:text":ajaxify.data["icon:text"],"icon:bgColor":ajaxify.data["icon:bgColor"]}},function(c){const e=r.dialog({className:"picture-switcher",title:"[[user:change-picture]]",message:c,show:!0,size:"large",buttons:{close:{label:"[[global:close]]",callback:A,className:"btn-link"},update:{label:"[[global:save-changes]]",callback:g}}});e.on("shown.bs.modal",d),e.on("click",".list-group-item",function(){e.find(".list-group-item").removeClass("active"),$(this).addClass("active")}),e.on("change",'input[type="radio"][name="icon:bgColor"]',x=>{const D=x.target.value;e.find('[component="avatar/icon"]').css("background-color",D)}),t(e);function d(){ajaxify.data.picture?e.find(".list-group-item img").each(function(){this.getAttribute("src")===ajaxify.data.picture&&$(this).parents(".list-group-item").addClass("active")}):e.find('[data-type="default"]').addClass("active");const x=document.querySelector(`.modal input[type="radio"][value="${ajaxify.data["icon:bgColor"]}"]`);x?x.checked=!0:document.querySelector('.modal input[type="radio"]').checked=!0}function g(){const x=e.find(".list-group-item.active").attr("data-type"),D=document.querySelector('.modal.picture-switcher input[type="radio"]:checked').value||"transparent";s(x,D).then(()=>{o.updateHeader(x==="default"?"":e.find(".list-group-item.active img").attr("src"),D),ajaxify.refresh()}).catch(n.error)}function A(){e.modal("hide")}})})},o.updateHeader=(a,f)=>{if(parseInt(ajaxify.data.theirid,10)!==parseInt(ajaxify.data.yourid,10))return;!a&&ajaxify.data.defaultAvatar&&(a=ajaxify.data.defaultAvatar);const l=$('[component="header/avatar"] [component="avatar/picture"]'),c=$('[component="header/avatar"] [component="avatar/icon"]');if(a){if(!l.length&&c.length){const e=$("<img/>");$(c[0].attributes).each(function(){e.attr(this.nodeName,this.nodeValue)}),e.attr("component","avatar/picture").attr("src",a).insertBefore(c)}}else l.remove();f&&c.css({"background-color":f})};function t(a){function f(c){c=(c.startsWith("http")?"":config.relative_path)+c;const e=c+"?"+Date.now();o.updateHeader(e),ajaxify.data.picture&&ajaxify.data.picture.length?($(`#user-current-picture, img[data-uid="${ajaxify.data.theirid}"].avatar`).attr("src",e),ajaxify.data.uploadedpicture=c,ajaxify.data.picture=c):ajaxify.refresh(function(){$(`#user-current-picture, img[data-uid="${ajaxify.data.theirid}"].avatar`).attr("src",e)})}function l(){ajaxify.data.uploadedpicture===ajaxify.data.picture&&(ajaxify.refresh(),o.updateHeader())}a.find('[data-action="upload"]').on("click",function(){return a.modal("hide"),p.show({socketMethod:"user.uploadCroppedPicture",route:config.relative_path+"/api/user/"+ajaxify.data.userslug+"/uploadpicture",aspectRatio:1/1,paramName:"uid",paramValue:ajaxify.data.theirid,fileSize:ajaxify.data.maximumProfileImageSize,allowSkippingCrop:!1,title:"[[user:upload-picture]]",description:"[[user:upload-a-picture]]",accept:ajaxify.data.allowedProfileImageExtensions},function(c){f(c)}),!1}),a.find('[data-action="upload-url"]').on("click",function(){return a.modal("hide"),app.parseAndTranslate("modals/upload-picture-from-url",{},function(c){c.modal("show"),c.find(".upload-btn").on("click",function(){const e=c.find("#uploadFromUrl").val();return e&&(c.modal("hide"),p.handleImageCrop({url:e,socketMethod:"user.uploadCroppedPicture",aspectRatio:1,allowSkippingCrop:!1,paramName:"uid",paramValue:ajaxify.data.theirid},f)),!1})}),!1}),a.find('[data-action="remove-uploaded"]').on("click",function(){socket.emit("user.removeUploadedPicture",{uid:ajaxify.data.theirid},function(c){if(a.modal("hide"),c)return n.error(c);l()})})}function s(a,f){return i.put(`/users/${ajaxify.data.theirid}/picture`,{type:a,bgColor:f})}return o}).apply(b,m),h!==void 0&&(y.exports=h)},18675:()=>{(function(y){var b=y(window),u=function(i,r,n,o){if(arguments.length===3||o){if(n<i)return i;if(n>r)return r}return n},m=function(i){i.clientX=i.originalEvent.touches[0].clientX,i.clientY=i.originalEvent.touches[0].clientY},h=function(i){var r=(i.css("background-image").match(/^url\(['"]?(.*?)['"]?\)$/i)||[])[1];if(r){var n={width:0,height:0},o=new Image;return o.onload=function(){if(i.css("background-size")=="cover"){var t=i.innerWidth(),s=i.innerHeight(),a=t/s;imageAspectRatio=o.width/o.height,scale=1,imageAspectRatio>=a?scale=s/o.height:scale=t/o.width,n.width=o.width*scale,n.height=o.height*scale}else n.width=o.width,n.height=o.height},o.src=r,n}};function p(i,r){this.element=i,this.options=r,this.init()}p.prototype.init=function(){var i=y(this.element),r=(i.css("background-image").match(/^url\(['"]?(.*?)['"]?\)$/i)||[])[1],n=this.options;if(r){var o={width:0,height:0};(n.bound||n.units=="percent")&&(o=h(i)),i.on("mousedown.dbg touchstart.dbg",function(t){if(t.target===i[0]){if(t.preventDefault(),t.originalEvent.touches)m(t);else if(t.which!==1)return;var s=t.clientX,a=t.clientY,f=i.css("background-position").match(/(-?\d+).*?\s(-?\d+)/)||[],l=parseInt(f[1])||0,c=parseInt(f[2])||0;n.units=="percent"&&(l=Math.round(l/-200*o.width),c=Math.round(c/-200*o.height)),b.on("mousemove.dbg touchmove.dbg",function(e){e.preventDefault(),e.originalEvent.touches&&m(e);var d=e.clientX,g=e.clientY;n.units=="percent"?(l=n.axis==="y"?l:u(-o.width/2,0,l+d-s,n.bound),c=n.axis==="x"?c:u(-o.height/2,0,c+g-a,n.bound),i.css("background-position",l/o.width*-200+"% "+c/o.height*-200+"%")):(l=n.axis==="y"?l:u(i.innerWidth()-o.width,0,l+d-s,n.bound),c=n.axis==="x"?c:u(i.innerHeight()-o.height,0,c+g-a,n.bound),i.css("background-position",l+"px "+c+"px")),s=d,a=g}),b.on("mouseup.dbg touchend.dbg mouseleave.dbg",function(){n.done&&n.done(),b.off("mousemove.dbg touchmove.dbg"),b.off("mouseup.dbg touchend.dbg mouseleave.dbg")})}})}},p.prototype.disable=function(){var i=y(this.element);i.off("mousedown.dbg touchstart.dbg"),b.off("mousemove.dbg touchmove.dbg mouseup.dbg touchend.dbg mouseleave.dbg")},y.fn.backgroundDraggable=function(r){var r=r,n=Array.prototype.slice.call(arguments,1);return this.each(function(){var o=y(this);if(typeof r>"u"||typeof r=="object"){r=y.extend({},y.fn.backgroundDraggable.defaults,r);var t=new p(this,r);o.data("dbg",t)}else if(typeof r=="string"&&o.data("dbg")){var t=o.data("dbg");p.prototype[r].apply(t,n)}})},y.fn.backgroundDraggable.defaults={bound:!0,axis:void 0,units:"pixels"}})(jQuery)},28061:(y,b,u)=>{"use strict";var m,h;m=[u(81335),u(49897),u(40027),u(29930)],h=function(p,i,r,n){const o={};o.banAccount=function(s,a){s=s||ajaxify.data.theirid,t({tpl:"modals/temporary-ban",title:"[[user:ban-account]]",onSubmit:function(f){const l=f.length>0?Date.now()+f.length*1e3*60*60*(parseInt(f.unit,10)?24:1):0;i.put("/users/"+s+"/ban",{until:l,reason:f.reason||""}).then(()=>{if(typeof a=="function")return a();ajaxify.refresh()}).catch(n.error)}})},o.unbanAccount=function(s){t({tpl:"modals/unban",title:"[[user:unban-account]]",onSubmit:function(a){i.del("/users/"+s+"/ban",{reason:a.reason||""}).then(()=>{ajaxify.refresh()}).catch(n.error)}})},o.muteAccount=function(s,a){s=s||ajaxify.data.theirid,t({tpl:"modals/temporary-mute",title:"[[user:mute-account]]",onSubmit:function(f){const l=f.length>0?Date.now()+f.length*1e3*60*60*(parseInt(f.unit,10)?24:1):0;i.put("/users/"+s+"/mute",{until:l,reason:f.reason||""}).then(()=>{if(typeof a=="function")return a();ajaxify.refresh()}).catch(n.error)}})},o.unmuteAccount=function(s){t({tpl:"modals/unmute",title:"[[user:unmute-account]]",onSubmit:function(a){i.del("/users/"+s+"/mute",{reason:a.reason||""}).then(()=>{ajaxify.refresh()}).catch(n.error)}})};function t(s){p.render(s.tpl,{}).then(function(a){const f=r.dialog({title:s.title,message:a,show:!0,onEscape:!0,buttons:{close:{label:"[[global:close]]",className:"btn-link"},submit:{label:s.title,callback:function(){const l=f.find("form").serializeArray().reduce(function(c,e){return c[e.name]=e.value,c},{});s.onSubmit(l)}}}})})}return o}.apply(b,m),h!==void 0&&(y.exports=h)},36684:(y,b,u)=>{"use strict";var m,h;m=[u(29930),u(18675)],h=function(p){const i={coverEl:null,saveFn:null};i.init=function(n,o,t,s){i.coverEl=n,i.saveFn=o,n.find(".upload").on("click",t),n.find(".resize").on("click",function(){r(n)}),n.find(".remove").on("click",s),n.on("dragover",i.onDragOver).on("drop",i.onDrop),n.find(".save").on("click",i.save),n.addClass("initialised")},i.onDragOver=function(n){n.stopPropagation(),n.preventDefault(),n.originalEvent.dataTransfer.dropEffect="copy"},i.onDrop=function(n){n.stopPropagation(),n.preventDefault();const o=n.originalEvent.dataTransfer.files,t=new FileReader;o.length&&o[0].type.match("image.*")&&(t.onload=function(s){i.coverEl.css("background-image","url("+s.target.result+")"),i.newCover=s.target.result},t.readAsDataURL(o[0]),r(i.coverEl))};function r(n){n.toggleClass("active",1).backgroundDraggable({axis:"y",units:"percent"}),p.alert({alert_id:"drag_start",title:"[[modules:cover.dragging-title]]",message:"[[modules:cover.dragging-message]]",timeout:5e3})}return i.save=function(){i.coverEl.addClass("saving"),i.saveFn(i.newCover||void 0,i.coverEl.css("background-position"),function(n){n?p.error(n):(i.coverEl.toggleClass("active",0),i.coverEl.backgroundDraggable("disable"),i.coverEl.off("dragover",i.onDragOver),i.coverEl.off("drop",i.onDrop),p.success("[[modules:cover.saved]]")),i.coverEl.removeClass("saving")})},i}.apply(b,m),h!==void 0&&(y.exports=h)},47283:(y,b,u)=>{"use strict";var m,h;m=[u(49897),u(40027),u(29930)],h=function(p,i,r){const n={};n.account=function(t,s){o(t,"[[user:delete-this-account-confirm]]","/account","[[user:account-deleted]]",s)},n.content=function(t,s){o(t,"[[user:delete-account-content-confirm]]","/content","[[user:account-content-deleted]]",s)},n.purge=function(t,s){o(t,"[[user:delete-all-confirm]]","","[[user:account-deleted]]",s)};function o(t,s,a,f,l){i.confirm(s,function(c){c&&p.del(`/users/${t}${a}`,{}).then(()=>{if(r.success(f),typeof l=="function")return l()}).catch(r.error)})}return n}.apply(b,m),h!==void 0&&(y.exports=h)},49897:(y,b,u)=>{"use strict";u.r(b),u.d(b,{del:()=>c,get:()=>t,head:()=>s,patch:()=>f,post:()=>a,put:()=>l});var m=u(91749),h=u.n(m),p=u(40027),i=u.n(p);const r=config.relative_path+"/api/v3";async function n(e,d){if(e.url=e.url.startsWith("/api")?config.relative_path+e.url:r+e.url,typeof d=="function"){o(e).then(g=>d(null,g),g=>d(g));return}try{return await o(e)}catch(g){if(g.message==="A valid login session was not found. Please log in and try again."){const{url:A}=await(0,m.fire)("filter:admin.reauth",{url:"login"});return(0,p.confirm)("[[error:api.reauth-required]]",x=>{x&&ajaxify.go(A)})}throw g}}async function o(e){const{url:d}=e;delete e.url,e.data&&!(e.data instanceof FormData)&&(e.data=JSON.stringify(e.data||{}),e.headers["content-type"]="application/json; charset=utf-8"),{options:e}=await(0,m.fire)("filter:api.options",{options:e}),e.data&&(e.body=e.data,delete e.data);const g=await fetch(d,e),{headers:A}=g,x=A.get("content-type"),D=x&&x.startsWith("application/json");let E;if(e.method!=="HEAD"&&(D?E=await g.json():E=await g.text()),!g.ok)throw E?new Error(D?E.status.message:E):new Error(g.statusText);return D&&E&&E.hasOwnProperty("status")&&E.hasOwnProperty("response")?E.response:E}function t(e,d,g){return n({url:e+(d&&Object.keys(d).length?"?"+$.param(d):"")},g)}function s(e,d,g){return n({url:e+(d&&Object.keys(d).length?"?"+$.param(d):""),method:"HEAD"},g)}function a(e,d,g){return n({url:e,method:"POST",data:d,headers:{"x-csrf-token":config.csrf_token}},g)}function f(e,d,g){return n({url:e,method:"PATCH",data:d,headers:{"x-csrf-token":config.csrf_token}},g)}function l(e,d,g){return n({url:e,method:"PUT",data:d,headers:{"x-csrf-token":config.csrf_token}},g)}function c(e,d,g){return n({url:e,method:"DELETE",data:d,headers:{"x-csrf-token":config.csrf_token}},g)}},67910:(y,b,u)=>{"use strict";var m,h;m=[u(36684),u(72254),u(52473),u(17459),u(47283),u(28061),u(7524),u(49897),u(40027),u(29930)],h=function(p,i,r,n,o,t,s,a,f,l){const c={};let e;c.init=function(){e=ajaxify.data.isAdmin||ajaxify.data.isSelf||ajaxify.data.isGlobalModerator,d(),g(),e&&A(),r.get("account/follow").on("click",()=>x("follow")),r.get("account/unfollow").on("click",()=>x("unfollow")),r.get("account/chat").on("click",async function(){const{roomId:v}=await a.get(`/users/${ajaxify.data.uid}/chat`),C=await app.require("chat");v?C.openChat(v):C.newChat(ajaxify.data.uid)}),r.get("account/new-chat").on("click",async function(){(await app.require("chat")).newChat(ajaxify.data.uid,function(){r.get("account/chat").parent().removeClass("hidden")})}),r.get("account/ban").on("click",()=>t.banAccount(ajaxify.data.theirid)),r.get("account/mute").on("click",()=>t.muteAccount(ajaxify.data.theirid)),r.get("account/unban").on("click",()=>t.unbanAccount(ajaxify.data.theirid)),r.get("account/unmute").on("click",()=>t.unmuteAccount(ajaxify.data.theirid)),r.get("account/delete-account").on("click",()=>o.account(ajaxify.data.theirid)),r.get("account/delete-content").on("click",()=>o.content(ajaxify.data.theirid)),r.get("account/delete-all").on("click",()=>o.purge(ajaxify.data.theirid)),r.get("account/flag").on("click",D),r.get("account/block").on("click",()=>E("block")),r.get("account/unblock").on("click",()=>E("unblock"))};function d(){$(".account-sub-links li a").removeClass("active").each(function(){const v=$(this).attr("href");if(decodeURIComponent(v)===decodeURIComponent(window.location.pathname))return $(this).addClass("active"),!1})}function g(){$('[component="profile/change/picture"]').on("click",function(){return s.openChangeModal(),!1})}function A(){p.init(r.get("account/cover"),function(v,C,w){socket.emit("user.updateCover",{uid:ajaxify.data.uid,imageData:v,position:C},w)},function(){i.show({title:"[[user:upload-cover-picture]]",socketMethod:"user.updateCover",aspectRatio:NaN,allowSkippingCrop:!0,restrictImageDimension:!1,paramName:"uid",paramValue:ajaxify.data.theirid,accept:".png,.jpg,.bmp"},function(v){v=(v.startsWith("http")?"":config.relative_path)+v+"?"+Date.now(),r.get("account/cover").css("background-image","url("+v+")")})},j)}function x(v){return a[v==="follow"?"put":"del"]("/users/"+ajaxify.data.uid+"/follow",void 0,function(C){if(C)return l.error(C);r.get("account/follow").toggleClass("hide",v==="follow"),r.get("account/unfollow").toggleClass("hide",v==="unfollow"),l.success("[[global:alert."+v+", "+ajaxify.data.username+"]]")}),!1}function D(){u.e(6574).then(function(){var v=[u(6574)];(function(C){C.showFlagModal({type:"user",id:ajaxify.data.uid})}).apply(null,v)}).catch(u.oe)}function E(v){return socket.emit("user.toggleBlock",{blockeeUid:ajaxify.data.uid,blockerUid:app.user.uid,action:v},function(C,w){if(C)return l.error(C);r.get("account/block").toggleClass("hidden",w),r.get("account/unblock").toggleClass("hidden",!w)}),!1}function j(){n.translate("[[user:remove-cover-picture-confirm]]",function(v){f.confirm(v,function(C){C&&socket.emit("user.removeCover",{uid:ajaxify.data.uid},function(w){w?l.error(w):ajaxify.refresh()})})})}return c}.apply(b,m),h!==void 0&&(y.exports=h)},72254:(y,b,u)=>{"use strict";var m,h;m=[u(29930)],h=function(p){const i={};i.show=function(t,s){const a=t.hasOwnProperty("fileSize")&&t.fileSize!==void 0?parseInt(t.fileSize,10):!1;app.parseAndTranslate("modals/upload-file",{showHelp:t.hasOwnProperty("showHelp")&&t.showHelp!==void 0?t.showHelp:!0,fileSize:a,title:t.title||"[[global:upload-file]]",description:t.description||"",button:t.button||"[[global:upload]]",accept:t.accept?t.accept.replace(/,/g,"&#44; "):""},function(f){f.modal("show"),f.on("hidden.bs.modal",function(){f.remove()});const l=f.find("#uploadForm");t.route&&l.attr("action",t.route),f.find("#fileUploadSubmitBtn").on("click",function(){return $(this).addClass("disabled"),t.uploadModal=f,o(t,s),!1})})},i.handleImageCrop=function(t,s){$("#crop-picture-modal").remove(),app.parseAndTranslate("modals/crop_picture",{url:utils.escapeHTML(t.url)},async function(a){a.modal({backdrop:"static"}).modal("show");const f=parseInt($(window).height()/2,10),l=document.getElementById("cropped-image");$(l).css("max-height",f);const c=(await u.e(60239).then(u.t.bind(u,65643,23))).default;let e=new c(l,{aspectRatio:t.aspectRatio,autoCropArea:1,viewMode:1,checkCrossOrigin:!0,cropmove:function(){t.restrictImageDimension&&(e.cropBoxData.width>t.imageDimension&&e.setCropBoxData({width:t.imageDimension}),e.cropBoxData.height>t.imageDimension&&e.setCropBoxData({height:t.imageDimension}))},ready:function(){if(!n(e,t))return a.modal("hide");if(t.restrictImageDimension){const d=l.width<l.height?l.width:l.height,g=d>t.imageDimension?t.imageDimension:d;e.setCropBoxData({width:g,height:g})}a.find(".rotate").on("click",function(){const d=this.getAttribute("data-degrees");e.rotate(d)}),a.find(".flip").on("click",function(){const d=this.getAttribute("data-option");this.getAttribute("data-method")==="scaleX"?e.scaleX(d):e.scaleY(d),this.setAttribute("data-option",d*-1)}),a.find(".reset").on("click",function(){e.reset()}),a.find(".crop-btn").on("click",function(){$(this).addClass("disabled");const d=n(e,t);d&&(a.find("#upload-progress-bar").css("width","0%"),a.find("#upload-progress-box").show().removeClass("hide"),r({data:t,imageData:d,progressBarEl:a.find("#upload-progress-bar")},function(g,A){if(g)return a.find("#upload-progress-box").hide(),a.find(".upload-btn").removeClass("disabled"),a.find(".crop-btn").removeClass("disabled"),p.error(g);s(A.url),a.modal("hide")}))}),a.find(".upload-btn").on("click",async function(){$(this).addClass("disabled"),e.destroy();const d=(await u.e(60239).then(u.t.bind(u,65643,23))).default;e=new d(l,{viewMode:1,autoCropArea:1,ready:function(){a.find(".crop-btn").trigger("click")}})})}})})};function r(t,s){const a={};a[t.data.paramName]=t.data.paramValue,a.method=t.data.socketMethod,a.size=t.imageData.length,a.progress=0;const f=1e5;function l(){const c=t.imageData.slice(a.progress,a.progress+f);socket.emit("uploads.upload",{chunk:c,params:a},function(e,d){if(e)return p.error(e);if(a.progress+f<a.size)return a.progress+=c.length,t.progressBarEl.css("width",(a.progress/a.size*100).toFixed(2)+"%"),setTimeout(l,100);t.progressBarEl.css("width","100%"),s(null,d)})}l()}function n(t,s){let a;try{a=s.imageType?t.getCroppedCanvas().toDataURL(s.imageType):t.getCroppedCanvas().toDataURL()}catch(f){["The operation is insecure.","Failed to execute 'toDataURL' on 'HTMLCanvasElement': Tainted canvases may not be exported."].indexOf(f.message)!==-1?p.error("[[error:cors-error]]"):p.error(f.message);return}return a}function o(t,s){function a(d,g){d==="error"&&t.uploadModal.find("#fileUploadSubmitBtn").removeClass("disabled"),t.uploadModal.find("#alert-"+d).translateText(g).removeClass("hide")}const f=t.uploadModal.find("#fileInput");if(!f.val())return a("error","[[uploads:select-file-to-upload]]");const l=f[0].files[0],c=t.hasOwnProperty("fileSize")&&t.fileSize!==void 0?parseInt(t.fileSize,10):!1;if(c&&l.size>c*1024)return a("error","[[error:file-too-big, "+c+"]]");if(l.name.endsWith(".gif")){u.e(98463).then(function(){var d=[u(24187)];(function(g){g.ajaxSubmit(t.uploadModal,s)}).apply(null,d)}).catch(u.oe);return}const e=new FileReader;e.addEventListener("load",function(){const d=e.result;t.uploadModal.modal("hide"),i.handleImageCrop({url:d,imageType:l.type,socketMethod:t.socketMethod,aspectRatio:t.aspectRatio,allowSkippingCrop:t.allowSkippingCrop,restrictImageDimension:t.restrictImageDimension,imageDimension:t.imageDimension,paramName:t.paramName,paramValue:t.paramValue},s)},!1),l&&e.readAsDataURL(l)}return i}.apply(b,m),h!==void 0&&(y.exports=h)}}]);
