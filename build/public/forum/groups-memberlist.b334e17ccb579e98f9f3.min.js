"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,15794,20644,25432,34271,49897,99127],{29869:E=>{E.exports=function(h,u,m){u.setGlobal("true",!0),u.setGlobal("false",!1);const b=24*60*60*1e3,p={displayMenuItem:w,buildMetaTag:g,buildLinkTag:y,stringify:C,escape:S,stripTags:I,buildCategoryIcon:R,buildCategoryLabel:L,generateCategoryBackground:v,generateChildrenCategories:a,generateTopicClass:i,membershipBtn:n,spawnPrivilegeStates:s,localeToHTML:l,renderTopicImage:o,renderDigestAvatar:d,userAgentIcons:x,buildAvatar:_,increment:H,generateWroteReplied:U,generateRepliedTo:B,generateWrote:N,isoTimeToLocaleString:K,shouldHideReplyContainer:z,humanReadableNumber:F,formattedNumber:G,generatePlaceholderWave:J,register:j,__escape:A};function A(e){return e}function w(e,t){const r=e.navigation[t];return!(!r||r.route.match("/users")&&e.user&&!e.user.privileges["view:users"]||r.route.match("/tags")&&e.user&&!e.user.privileges["view:tags"]||r.route.match("/groups")&&e.user&&!e.user.privileges["view:groups"])}function g(e){const t=e.name?'name="'+e.name+'" ':"",r=e.property?'property="'+e.property+'" ':"",f=e.content?'content="'+e.content.replace(/\n/g," ")+'" ':"";return"<meta "+t+r+f+`/>
	`}function y(e){const t=["link","rel","as","type","href","sizes","title","crossorigin"],[r,f,c,M,T,P,k,W]=t.map(D=>e[D]?`${D}="${e[D]}" `:"");return"<link "+r+f+c+M+P+k+T+W+`/>
	`}function C(e){return JSON.stringify(e).replace(/&/gm,"&amp;").replace(/</gm,"&lt;").replace(/>/gm,"&gt;").replace(/"/g,"&quot;")}function S(e){return h.escapeHTML(e)}function I(e){return h.stripHTMLTags(e)}function R(e,t,r){return e?`<span class="icon d-inline-flex justify-content-center align-items-center align-middle ${r}" style="${v(e)} width:${t}; height: ${t}; font-size: ${parseInt(t,10)/2}px;">${e.icon?`<i class="fa fa-fw ${e.icon}"></i>`:""}</span>`:""}function L(e,t="a",r=""){if(!e)return"";const f=t==="a"?`href="${m}/category/${e.slug}"`:"";return`<${t} ${f} class="badge px-1 text-truncate text-decoration-none ${r}" style="color: ${e.color};background-color: ${e.bgColor};border-color: ${e.bgColor}!important; max-width: 70vw;">
			${e.icon&&e.icon!=="fa-nbb-none"?`<i class="fa fa-fw ${e.icon}"></i>`:""}
			${e.name}
		</${t}>`}function v(e){if(!e)return"";const t=[];return e.bgColor&&(t.push("background-color: "+e.bgColor),t.push(`border-color: ${e.bgColor}!important`)),e.color&&t.push("color: "+e.color),e.backgroundImage&&(t.push("background-image: url("+e.backgroundImage+")"),e.imageClass&&t.push("background-size: "+e.imageClass)),t.join("; ")+";"}function a(e){let t="";return!e||!e.children||!e.children.length||(e.children.forEach(function(r){if(r&&!r.isSection){const f=r.link?r.link:m+"/category/"+r.slug;t+='<span class="category-children-item float-start"><div role="presentation" class="icon float-start" style="'+v(r)+'"><i class="fa fa-fw '+r.icon+'"></i></div><a href="'+f+'"><small>'+r.name+"</small></a></span>"}}),t=t&&'<span class="category-children">'+t+"</span>"),t}function i(e){return["locked","pinned","deleted","unread","scheduled"].filter(r=>!!e[r]).join(" ")}function n(e,t=""){return e.isMember&&e.name!=="administrators"?`<button class="btn btn-danger ${t}" data-action="leave" data-group="${e.displayName}" ${e.disableLeave?" disabled":""}><i class="fa fa-times"></i> [[groups:membership.leave-group]]</button>`:e.isPending&&e.name!=="administrators"?`<button class="btn btn-warning disabled ${t}"><i class="fa fa-clock-o"></i> [[groups:membership.invitation-pending]]</button>`:e.isInvited?`<button class="btn btn-warning" data-action="rejectInvite" data-group="${e.displayName}">[[groups:membership.reject]]</button><button class="btn btn-success" data-action="acceptInvite" data-group="${e.name}"><i class="fa fa-plus"></i> [[groups:membership.accept-invitation]]</button>`:!e.disableJoinRequests&&e.name!=="administrators"?`<button class="btn btn-success ${t}" data-action="join" data-group="${e.displayName}"><i class="fa fa-plus"></i> [[groups:membership.join-group]]</button>`:""}function s(e,t,r){const f=[];for(const c in t)t.hasOwnProperty(c)&&f.push({name:c,state:t[c],type:r[c]});return f.map(function(c){const M=["groups:moderate","groups:posts:upvote","groups:posts:downvote","groups:local:login","groups:group:create"],T=["groups:find","groups:read","groups:topics:read","groups:view:users","groups:view:tags","groups:view:groups"],P=["groups:moderate"],k=e==="guests"&&(M.includes(c.name)||c.name.startsWith("groups:admin:"))||e==="spiders"&&!T.includes(c.name)||e==="Global Moderators"&&P.includes(c.name);return`
				<td data-privilege="${c.name}" data-value="${c.state}" data-type="${c.type}">
					<div class="form-check text-center">
						<input class="form-check-input float-none" autocomplete="off" type="checkbox"${c.state?" checked":""}${k?' disabled="disabled"':""} />
					</div>
				</td>
			`}).join("")}function l(e,t){return e=e||t||"en-GB",e.replace("_","-")}function o(e){return e.thumb?'<img src="'+e.thumb+'" class="img-circle user-img" title="'+e.user.username+'" />':'<img component="user/picture" data-uid="'+e.user.uid+'" src="'+e.user.picture+'" class="user-img" title="'+e.user.username+'" />'}function d(e){return e.teaser?e.teaser.user.picture?'<img style="vertical-align: middle; width: 32px; height: 32px; border-radius: 50%;" src="'+e.teaser.user.picture+'" title="'+e.teaser.user.username+'" />':'<div style="vertical-align: middle; width: 32px; height: 32px; line-height: 32px; font-size: 16px; background-color: '+e.teaser.user["icon:bgColor"]+'; color: white; text-align: center; display: inline-block; border-radius: 50%;">'+e.teaser.user["icon:text"]+"</div>":e.user.picture?'<img style="vertical-align: middle; width: 32px; height: 32px; border-radius: 50%;" src="'+e.user.picture+'" title="'+e.user.username+'" />':'<div style="vertical-align: middle; width: 32px; height: 32px; line-height: 32px; font-size: 16px; background-color: '+e.user["icon:bgColor"]+'; color: white; text-align: center; display: inline-block; border-radius: 50%;">'+e.user["icon:text"]+"</div>"}function x(e){let t="";switch(e.platform){case"Linux":t+='<i class="fa fa-fw fa-linux"></i>';break;case"Microsoft Windows":t+='<i class="fa fa-fw fa-windows"></i>';break;case"Apple Mac":t+='<i class="fa fa-fw fa-apple"></i>';break;case"Android":t+='<i class="fa fa-fw fa-android"></i>';break;case"iPad":t+='<i class="fa fa-fw fa-tablet"></i>';break;case"iPod":case"iPhone":t+='<i class="fa fa-fw fa-mobile"></i>';break;default:t+='<i class="fa fa-fw fa-question-circle"></i>';break}switch(e.browser){case"Chrome":t+='<i class="fa fa-fw fa-chrome"></i>';break;case"Firefox":t+='<i class="fa fa-fw fa-firefox"></i>';break;case"Safari":t+='<i class="fa fa-fw fa-safari"></i>';break;case"IE":t+='<i class="fa fa-fw fa-internet-explorer"></i>';break;case"Edge":t+='<i class="fa fa-fw fa-edge"></i>';break;default:t+='<i class="fa fa-fw fa-question-circle"></i>';break}return t}function _(e,t,r,f,c){e||(e=this),f=f||"";const M=new Map([["title",e.username],["data-uid",e.uid],["class",`avatar ${f}${r?" avatar-rounded":""}`]]),T=[`--avatar-size: ${t};`],P=W=>Array.from(W).reduce((D,[Y,Q])=>(D+=` ${Y}="${Q}"`,D),"");let k="";return e.picture&&(k+=`<img${P(M)} alt="${e.username}" loading="lazy" component="${c||"avatar/picture"}" src="${e.picture}" style="${T.join(" ")}" onError="this.remove()" itemprop="image" />`),k+=`<span${P(M)} component="${c||"avatar/icon"}" style="${T.join(" ")} background-color: ${e["icon:bgColor"]}">${e["icon:text"]}</span>`,k}function H(e,t){return String(e+parseInt(t,10))}function U(e,t){return e.toPid?B(e,t):N(e,t)}function B(e,t){const r=e.parent&&e.parent.displayname?e.parent.displayname:"[[global:guest]]";return`[[topic:replied-to-user-${e.timestamp<Date.now()-t*b?"on":"ago"}, ${e.toPid}, ${m}/post/${e.toPid}, ${r}, ${m}/post/${e.pid}, ${e.timestampISO}]]`}function N(e,t){return`[[topic:wrote-${e.timestamp<Date.now()-t*b?"on":"ago"}, ${m}/post/${e.pid}, ${e.timestampISO}]]`}function K(e,t="en-GB"){return new Date(e).toLocaleString([t],{dateStyle:"short",timeStyle:"short"}).replace(/,/g,"&#44;")}function z(e){return!!(e.replies.count<=0||e.replies.hasSingleImmediateReply)}function F(e,t=1){return h.makeNumberHumanReadable(e,t)}function G(e){return h.addCommas(e)}function J(e){return e.map(r=>r==="divider"?'<li class="dropdown-divider"></li>':`
			<li class="dropdown-item placeholder-wave">
				<div class="placeholder" style="width: 20px;"></div>
				<div class="placeholder col-${r}"></div>
			</li>`)}function j(){Object.keys(p).forEach(function(e){u.registerHelper(e,p[e])})}return p}},30076:(E,h,u)=>{var m,b;const p=u(29869);m=[u(77918),u(81335)],b=function(A,w){return p(A,w,config.relative_path)}.apply(h,m),b!==void 0&&(E.exports=b)},49897:(E,h,u)=>{u.r(h),u.d(h,{del:()=>v,get:()=>C,head:()=>S,patch:()=>R,post:()=>I,put:()=>L});var m=u(91749),b=u.n(m),p=u(40027),A=u.n(p);const w=config.relative_path+"/api/v3";async function g(a,i){if(a.url=a.url.startsWith("/api")?config.relative_path+a.url:w+a.url,typeof i=="function"){y(a).then(n=>i(null,n),n=>i(n));return}try{return await y(a)}catch(n){if(n.message==="A valid login session was not found. Please log in and try again."){const{url:s}=await(0,m.fire)("filter:admin.reauth",{url:"login"});return(0,p.confirm)("[[error:api.reauth-required]]",l=>{l&&ajaxify.go(s)})}throw n}}async function y(a){const{url:i}=a;delete a.url,a.data&&!(a.data instanceof FormData)&&(a.data=JSON.stringify(a.data||{}),a.headers["content-type"]="application/json; charset=utf-8"),{options:a}=await(0,m.fire)("filter:api.options",{options:a}),a.data&&(a.body=a.data,delete a.data);const n=await fetch(i,a),{headers:s}=n,l=s.get("content-type"),o=l&&l.startsWith("application/json");let d;if(a.method!=="HEAD"&&(o?d=await n.json():d=await n.text()),!n.ok)throw d?new Error(o?d.status.message:d):new Error(n.statusText);return o&&d&&d.hasOwnProperty("status")&&d.hasOwnProperty("response")?d.response:d}function C(a,i,n){return g({url:a+(i&&Object.keys(i).length?"?"+$.param(i):"")},n)}function S(a,i,n){return g({url:a+(i&&Object.keys(i).length?"?"+$.param(i):""),method:"HEAD"},n)}function I(a,i,n){return g({url:a,method:"POST",data:i,headers:{"x-csrf-token":config.csrf_token}},n)}function R(a,i,n){return g({url:a,method:"PATCH",data:i,headers:{"x-csrf-token":config.csrf_token}},n)}function L(a,i,n){return g({url:a,method:"PUT",data:i,headers:{"x-csrf-token":config.csrf_token}},n)}function v(a,i,n){return g({url:a,method:"DELETE",data:i,headers:{"x-csrf-token":config.csrf_token}},n)}},89664:(E,h,u)=>{var m,b;m=[u(49897),u(40027),u(29930),u(30076)],b=function(p,A,w,g){const y={};let C;y.init=function(n){C=n||"groups/details",S(),R(),L()},y.refresh=async function(){const{group:n}=await p.get(`/api/groups/${ajaxify.data.group.slug}`),s=await i(n.members);$('[component="groups/members"] tbody').html(s),$('[component="group/member/count"]').text(g.humanReadableNumber(n.memberCount)),$('[component="group/pending/count"]').text(g.humanReadableNumber(n.pending.length)),$('[component="group/invited/count"]').text(g.humanReadableNumber(n.invited.length)),ajaxify.data.group.members=n.members,ajaxify.data.group.memberCount=n.memberCount,ajaxify.data.group.invited=n.invited,ajaxify.data.group.pending=n.pending};function S(){$('[component="groups/members/add"]').on("click",function(){app.parseAndTranslate("admin/partials/groups/add-members",{},function(n){const s=[],l=A.dialog({title:"[[groups:details.add-member]]",message:n,buttons:{OK:{label:"[[groups:details.add-member]]",callback:function(){const o=[];l.find("[data-uid][data-selected]").each(function(d,x){o.push(s[$(x).attr("data-uid")])}),I(o).then(()=>{l.modal("hide")})}}}});l.on("click","[data-username]",function(){$(this).attr("data-selected")==="1"?$(this).removeAttr("data-selected"):$(this).attr("data-selected",1),$(this).find("i").toggleClass("invisible")}),l.find("input").on("keyup",function(){p.get("/api/users",{query:$(this).val(),paginate:!1},function(o,d){if(o)return w.error(o);d.users.forEach(function(x){s[x.uid]=x}),app.parseAndTranslate("admin/partials/groups/add-members","users",{users:d.users},function(x){l.find("#search-result").html(x)})})})})})}async function I(n){const s=n.map(o=>o.uid);ajaxify.data.group.name==="administrators"?await socket.emit("admin.user.makeAdmins",s).catch(w.error):await Promise.all(s.map(o=>p.put("/groups/"+ajaxify.data.group.slug+"/membership/"+o))).catch(w.error),n=n.filter(o=>!$('[component="groups/members"] [data-uid="'+o.uid+'"]').length);const l=await i(n);$('[component="groups/members"] tbody').prepend(l)}function R(){const n=$('[component="groups/members/search"]');n.on("keyup",utils.debounce(async function(){const s=n.val(),l=await p.get(`/groups/${ajaxify.data.group.slug}/members`,{query:s}),o=await i(l.users);$('[component="groups/members"] tbody').html(o),$('[component="groups/members"]').attr("data-nextstart",20)},250))}function L(){$('[component="groups/members"]').on("scroll",utils.debounce(function(){const n=$(this),s=(n[0].scrollHeight-n.innerHeight())*.9;n.scrollTop()>s&&!$('[component="groups/members/search"]').val()&&v()},250))}async function v(){const n=$('[component="groups/members"]');if(n.attr("loading"))return;n.attr("loading",1);const s=await p.get(`/groups/${ajaxify.data.group.slug}/members`,{after:n.attr("data-nextstart")}).catch(w.error);s&&s.users.length?(await a(s.users),n.removeAttr("loading"),n.attr("data-nextstart",s.nextStart)):n.removeAttr("loading")}async function a(n){n=n.filter(function(l){return!$('[component="groups/members"] [data-uid="'+l.uid+'"]').length});const s=await i(n);$('[component="groups/members"] tbody').append(s)}async function i(n){return await app.parseAndTranslate(C,"group.members",{group:{members:n,isOwner:ajaxify.data.group.isOwner}})}return y}.apply(h,m),b!==void 0&&(E.exports=b)}}]);
