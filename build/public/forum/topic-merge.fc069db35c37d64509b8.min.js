"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[18593,99127,34271,1091,92717,87212,49897,2403],{2403:(k,O,h)=>{var v,p;v=[h(69749),h(29930),h(49897)],p=function(g,m,o){const f={};let c,u,x={};f.init=function(t){t=t||function(){},!c&&app.parseAndTranslate("modals/merge-topic",{},function(i){c=i,$("body").append(c),u=c.find("#merge_topics_confirm"),c.find("#merge_topics_cancel").on("click",e),$("#content").on("click",'[component="topic/select"]',w),l(),u.on("click",function(){n(u)}),g.enableQuickSearch({searchElements:{inputEl:c.find(".topic-search-input"),resultEl:c.find(".quick-search-container")},searchOptions:{in:"titles"},dropdown:{maxWidth:"400px",maxHeight:"350px"}}),c.on("click","[data-tid]",function(){const s=$(this).attr("data-tid");return s&&f.addTopic(s),!1}),c.on("click","[data-remove-tid]",function(){const s=$(this).attr("data-remove-tid");return s&&f.removeTopic(s),!1}),t()})},f.addTopic=function(t,i){i=i||function(){},o.get(`/topics/${t}`,{}).then(function(s){const a=s?s.title:"No title";x[t]=a,r(),l(),i()}).catch(m.error)},f.removeTopic=function(t){x[t]&&delete x[t],r(),l()};function w(t){if(!c)return;const i=$(this).parents('[component="category/topic"]'),s=i.hasClass("selected"),a=i.attr("data-tid");return s?f.addTopic(a):f.removeTopic(a),t.preventDefault(),t.stopPropagation(),!1}function n(t){t.attr("disabled",!0);const i=Object.keys(x),s={};c.find(".merge-main-topic-radio").is(":checked")?s.mainTid=c.find(".merge-main-topic-select").val():c.find(".merge-new-title-radio").is(":checked")&&(s.newTopicTitle=c.find(".merge-new-title-input").val()),socket.emit("topics.merge",{tids:i,options:s},function(a,y){if(t.removeAttr("disabled"),a)return m.error(a);ajaxify.go("/topic/"+y),e()})}function l(){if(!c)return;const t=Object.keys(x);t.sort(function(s,a){return s-a});const i=t.map(function(s){return{tid:s,title:x[s]}});t.length?app.parseAndTranslate("modals/merge-topic",{config,topics:i},function(s){c.find(".topics-section").html(s.find(".topics-section").html()),c.find(".merge-main-topic-select").html(s.find(".merge-main-topic-select").html())}):(c.find(".topics-section").translateHtml("[[error:no-topics-selected]]"),c.find(".merge-main-topic-select").html(""))}function r(){Object.keys(x).length?u.removeAttr("disabled"):u.attr("disabled",!0)}function e(){c&&(c.remove(),c=null),x={},$("#content").off("click",'[component="topic/select"]',w)}return f}.apply(O,v),p!==void 0&&(k.exports=p)},49897:(k,O,h)=>{h.r(O),h.d(O,{del:()=>r,get:()=>u,head:()=>x,patch:()=>n,post:()=>w,put:()=>l});var v=h(91749),p=h.n(v),g=h(40027),m=h.n(g);const o=config.relative_path+"/api/v3";async function f(e,t){if(e.url=e.url.startsWith("/api")?config.relative_path+e.url:o+e.url,typeof t=="function"){c(e).then(i=>t(null,i),i=>t(i));return}try{return await c(e)}catch(i){if(i.message==="A valid login session was not found. Please log in and try again."){const{url:s}=await(0,v.fire)("filter:admin.reauth",{url:"login"});return(0,g.confirm)("[[error:api.reauth-required]]",a=>{a&&ajaxify.go(s)})}throw i}}async function c(e){const{url:t}=e;delete e.url,e.data&&!(e.data instanceof FormData)&&(e.data=JSON.stringify(e.data||{}),e.headers["content-type"]="application/json; charset=utf-8"),{options:e}=await(0,v.fire)("filter:api.options",{options:e}),e.data&&(e.body=e.data,delete e.data);const i=await fetch(t,e),{headers:s}=i,a=s.get("content-type"),y=a&&a.startsWith("application/json");let d;if(e.method!=="HEAD"&&(y?d=await i.json():d=await i.text()),!i.ok)throw d?new Error(y?d.status.message:d):new Error(i.statusText);return y&&d&&d.hasOwnProperty("status")&&d.hasOwnProperty("response")?d.response:d}function u(e,t,i){return f({url:e+(t&&Object.keys(t).length?"?"+$.param(t):"")},i)}function x(e,t,i){return f({url:e+(t&&Object.keys(t).length?"?"+$.param(t):""),method:"HEAD"},i)}function w(e,t,i){return f({url:e,method:"POST",data:t,headers:{"x-csrf-token":config.csrf_token}},i)}function n(e,t,i){return f({url:e,method:"PATCH",data:t,headers:{"x-csrf-token":config.csrf_token}},i)}function l(e,t,i){return f({url:e,method:"PUT",data:t,headers:{"x-csrf-token":config.csrf_token}},i)}function r(e,t,i){return f({url:e,method:"DELETE",data:t,headers:{"x-csrf-token":config.csrf_token}},i)}},69749:(k,O,h)=>{var v,p;v=[h(17459),h(68636),h(91749),h(29930),h(89336)],p=function(g,m,o,f,c){const u={current:{}};u.init=function(n){if(!config.searchEnabled)return;n=n||{in:config.searchDefaultInQuick||"titles"},$('[component="search/form"]').each((r,e)=>{x($(e),n)})};function x(n,l){const r=n.find('[component="search/button"]'),e=n.find('[component="search/fields"]'),t=e.find('input[name="query"]'),i=e.find("#quick-search-container");e.hasClass("hidden")&&t.off("blur").on("blur",function(){setTimeout(function(){t.is(":focus")||(e.addClass("hidden"),r.removeClass("hidden"))},200)}),t.off("focus");const a={inputEl:t,resultEl:i};u.enableQuickSearch({searchOptions:l,searchElements:a}),r.off("click").on("click",function(y){return!config.loggedIn&&!app.user.privileges["search:content"]?(f.alert({message:"[[error:search-requires-login]]",timeout:3e3}),ajaxify.go("login"),!1):(y.stopPropagation(),u.showAndFocusInput(n),!1)}),n.off("submit").on("submit",function(){const y=$(this).find('input[name="query"]'),d=u.getSearchPreferences();return d.term=y.val(),d.in=l.in,o.fire("action:search.submit",{searchOptions:d,searchElements:a}),u.query(d,function(){y.val(""),t.trigger("blur")}),!1})}u.enableQuickSearch=function(n){if(!config.searchEnabled||!app.user.privileges["search:content"])return;const l=Object.assign({in:config.searchDefaultInQuick||"titles"},n.searchOptions),r=n.searchElements.resultEl,e=n.searchElements.inputEl;let t=e.val();const i=r.find(".filter-category");function s(){ajaxify.data.template.category&&ajaxify.data.cid&&g.translate("[[search:search-in-category, "+ajaxify.data.name+"]]",function(E){const C=$("<div></div>").html(E).text();i.find(".name").text(C)}),i.toggleClass("hidden",!(ajaxify.data.template.category&&ajaxify.data.cid))}function a(){n.searchOptions=Object.assign({},l),n.searchOptions.term=e.val(),s(),ajaxify.data.template.category&&ajaxify.data.cid&&i.find('input[type="checkbox"]').is(":checked")&&(n.searchOptions.categories=[ajaxify.data.cid],n.searchOptions.searchChildren=!0),n.hideDuringSearch||(r.removeClass("hidden").find(".quick-search-results-container").html(""),r.find(".loading-indicator").removeClass("hidden")),o.fire("action:search.quick.start",n),n.searchOptions.searchOnly=1,u.api(n.searchOptions,function(E){if(r.find(".loading-indicator").addClass("hidden"),!E.posts||n.hideOnNoMatches&&!E.posts.length)return r.addClass("hidden").find(".quick-search-results-container").html("");E.posts.forEach(function(C){const S=$("<div>"+C.content+"</div>").text(),_=e.val().toLowerCase().replace(/^in:topic-\d+/,""),T=Math.max(0,S.toLowerCase().indexOf(_)-40);C.snippet=utils.escapeHTML((T>0?"...":"")+S.slice(T,T+80)+(S.length-T>80?"...":""))}),E.dropdown={maxWidth:"400px",maxHeight:"500px",...n.dropdown},app.parseAndTranslate("partials/quick-search-results",E,function(C){C.length&&C.find(".timeago").timeago(),r.toggleClass("hidden",!C.length||!e.is(":focus")).find(".quick-search-results-container").html(C.length?C:"");const S=r.find(".quick-search-results .quick-search-title, .quick-search-results .snippet");u.highlightMatches(n.searchOptions.term,S),o.fire("action:search.quick.complete",{data:E,options:n})})})}r.find('.filter-category input[type="checkbox"]').on("change",function(){e.focus(),a()}),e.off("keyup").on("keyup",utils.debounce(function(){if(e.val().length<3){r.addClass("hidden"),t=e.val();return}if(e.val()!==t){if(t=e.val(),!e.is(":focus"))return r.addClass("hidden");a()}},500));let y=!1;r.on("mousedown",".quick-search-results > *",function(){$(window).one("mouseup",function(){r.addClass("hidden")}),y=!0}),e.on("blur",function(){setTimeout(function(){!e.is(":focus")&&!y&&!r.hasClass("hidden")&&r.addClass("hidden")},200)});let d=!1;o.on("action:ajaxify.end",function(){ajaxify.isCold()||(d=!0)}),e.on("focus",function(){y=!1;const E=e.val();t=E,E&&r.find("#quick-search-results").children().length&&(s(),d?(a(),d=!1):r.removeClass("hidden"),e[0].setSelectionRange(E.startsWith("in:topic")?E.indexOf(" ")+1:0,E.length))}),e.off("refresh").on("refresh",function(){a()})},u.showAndFocusInput=function(n){const l=n.parents(".dropdown-menu");if(l.length){const r=l.siblings("[data-bs-toggle]"),e=c.Dropdown.getOrCreateInstance(r[0]);e&&e.show()}else n.find('[component="search/fields"]').removeClass("hidden"),n.find('[component="search/button"]').addClass("hidden"),n.find('[component="search/fields"] input[name="query"]').trigger("focus")},u.query=function(n,l){l=l||function(){},ajaxify.go("search?"+w(n),l)},u.api=function(n,l){const r=config.relative_path+"/api/search?"+w(n);n.hasOwnProperty("searchOnly")&&delete n.searchOnly;const e=config.relative_path+"/search?"+w(n);$.get(r,function(t){t.url=e,l(t)})};function w(n){const l=n.in||"titles";let r=n.term.replace(/^[ ?#]*/,"");try{r=encodeURIComponent(r)}catch{return f.error("[[error:invalid-search-term]]")}const e={...n,term:r,in:l};return o.fire("action:search.createQueryString",{query:e,data:n}),decodeURIComponent($.param(e))}return u.getSearchPreferences=function(){try{return JSON.parse(m.getItem("search-preferences")||"{}")}catch{return{}}},u.highlightMatches=function(n,l){if(!n||!l.length)return;n=utils.escapeHTML(n.replace(/^"/,"").replace(/"$/,"").trim());const r=n.split(" ").filter(t=>t.length>1).map(function(t){return utils.escapeRegexChars(t)}).join("|"),e=new RegExp("("+r+")","gi");l.each(function(){const t=$(this),i=[];t.find("*").each(function(){$(this).after("<!-- "+i.length+" -->"),i.push($("<div></div>").append($(this)))}),t.html(t.html().replace(e,function(s,a){return'<strong class="search-match fw-bold text-decoration-underline">'+a+"</strong>"})),i.forEach(function(s,a){t.html(t.html().replace("<!-- "+a+" -->",function(){return s.html()}))})}),$(".search-result-text").find("img:not(.not-responsive)").addClass("img-fluid")},u}.apply(O,v),p!==void 0&&(k.exports=p)},68636:(k,O,h)=>{var v;v=function(){function p(){this._store={},this._keys=[]}p.prototype.isMock=!0,p.prototype.setItem=function(o,f){o=String(o),this._keys.indexOf(o)===-1&&this._keys.push(o),this._store[o]=f},p.prototype.getItem=function(o){return o=String(o),this._keys.indexOf(o)===-1?null:this._store[o]},p.prototype.removeItem=function(o){o=String(o),this._keys=this._keys.filter(function(f){return f!==o}),this._store[o]=null},p.prototype.clear=function(){this._keys=[],this._store={}},p.prototype.key=function(o){return o=parseInt(o,10)||0,this._keys[o]},Object.defineProperty&&Object.defineProperty(p.prototype,"length",{get:function(){return this._keys.length}});let g;const m=Date.now().toString();try{if(g=window.localStorage,g.setItem(m,m),g.getItem(m)!==m)throw Error("localStorage behaved unexpectedly");return g.removeItem(m),g}catch(o){console.warn(o),console.warn("localStorage failed, falling back on sessionStorage");try{if(g=window.sessionStorage,g.setItem(m,m),g.getItem(m)!==m)throw Error("sessionStorage behaved unexpectedly");return g.removeItem(m),g}catch(f){return console.warn(f),console.warn("sessionStorage failed, falling back on memory storage"),new p}}}.call(O,h,O,k),v!==void 0&&(k.exports=v)}}]);
