"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[85940,22765,75264,37418],{22410:(b,L,s)=>{var C,A;C=[s(91749),s(29930),s(49897)],A=function(p,h,I){const S={};let g,m=0,T=!1,E,w=0;S.init=function(r,y){const v=$("body");typeof r=="function"?(g=r,E=v):(g=y,E=r||v),m=$(window).scrollTop(),$(window).off("scroll",l).on("scroll",l),v.height()<=$(window).height()&&g(1)};function l(){w&&clearTimeout(w),w=setTimeout(function(){w=0,f()},60)}function f(){const r=utils.findBootstrapEnvironment(),y=(r==="xs"||r==="sm")&&$("html").hasClass("composing");if(T||y||app.flags._glance)return;const v=$(window).scrollTop(),o=$(window).height(),n=E.height()-o,a=E.offset()?E.offset().top:0,i=100*(v-a)/(n<=0?o:n),c=15,M=85,P=v>m?1:-1;(i<c&&v<m||i>M&&v>m||i<0&&P>0&&n<0)&&g(P),m=v}return S.loadMore=function(r,y,v){if(T)return;T=!0;const o={method:r,data:y};p.fire("action:infinitescroll.loadmore",o),(o.method.startsWith("/")?I.get:socket.emit)(o.method,o.data,function(a,i){if(a)return T=!1,h.error(a);v(i,function(){T=!1})})},S.loadMoreXhr=function(r,y){if(T)return;T=!0;const v=config.relative_path+"/api"+location.pathname.replace(new RegExp("^"+config.relative_path),""),o={url:v,data:r};p.fire("action:infinitescroll.loadmore.xhr",o),$.get(v,r,function(n){y(n,function(){T=!1})}).fail(function(n){T=!1,h.error(String(n.responseJSON||"[[error:no-connection]]"))})},S.removeExtra=function(r,y,v){let o=$();if(r.length<=v)return o;const n=r.length-v;if(y>0){const a=$(document).height(),i=$(window).scrollTop();o=r.slice(0,n).remove(),$(window).scrollTop(i+($(document).height()-a))}else o=r.slice(r.length-n).remove();return o},S}.apply(L,C),A!==void 0&&(b.exports=A)},2269:(b,L)=>{var s,C;s=[],C=function(){const A={},p=/-resized(\.[\w]+)?$/;return A.wrapImagesInLinks=function(h){h.find('[component="post/content"] img:not(.emoji)').each(function(){A.wrapImageInLink($(this))})},A.wrapImageInLink=function(h){let I=h.attr("src")||"";if(I!=="about:blank"&&!h.parent().is("a")){utils.isRelativeUrl(I)&&p.test(I)&&(I=I.replace(p,"$1"));const S=h.attr("alt")||"",g=I.split(".").slice(1).pop(),m=S.split("/").pop(),T=m.split(".").slice(1).pop();h.wrap('<a href="'+I+'" '+(!g&&T?' download="'+utils.escapeHTML(m)+'" ':"")+' target="_blank" rel="noopener">')}},A}.apply(L,s),C!==void 0&&(b.exports=C)},47536:(b,L,s)=>{var C,A;C=[s(25967),s(22410),s(8454),s(2269),s(96352),s(52473),s(17459),s(91749),s(30076)],A=function(p,h,I,S,g,m,T,E,w){const l={};l.signaturesShown={};const f=$(window);l.onNewPost=function(t){!t||!t.posts||!t.posts.length||parseInt(t.posts[0].tid,10)!==parseInt(ajaxify.data.tid,10)||(t.loggedIn=!!app.user.uid,t.privileges=ajaxify.data.privileges,t.posts[0].timestamp=t.posts[0].topic.scheduled?t.posts[0].timestamp:Date.now()-1e3,t.posts[0].timestampISO=utils.toISOString(t.posts[0].timestamp),l.modifyPostsByPrivileges(t.posts),y(t.posts),r(t.posts[0]),v(t.posts),ajaxify.data.postcount+=1,I.updatePostCount(ajaxify.data.postcount),config.usePagination?o(t):a(t),s.e(18631).then(function(){var e=[s(18631)];(function(d){d.onNewPost(t)}).apply(null,e)}).catch(s.oe))};function r(t){$(".pagination-block .pagebottom .timeago").timeago("update",t.timestampISO)}l.modifyPostsByPrivileges=function(t){t.forEach(function(e){e.selfPost=!!app.user.uid&&parseInt(e.uid,10)===parseInt(app.user.uid,10),e.topicOwnerPost=parseInt(e.uid,10)===parseInt(ajaxify.data.uid,10),e.display_edit_tools=ajaxify.data.privileges["posts:edit"]&&e.selfPost||ajaxify.data.privileges.isAdminOrMod,e.display_delete_tools=ajaxify.data.privileges["posts:delete"]&&e.selfPost||ajaxify.data.privileges.isAdminOrMod,e.display_moderator_tools=e.display_edit_tools||e.display_delete_tools,e.display_move_tools=ajaxify.data.privileges.isAdminOrMod,e.display_post_menu=ajaxify.data.privileges.isAdminOrMod||e.selfPost&&!ajaxify.data.locked&&!e.deleted||e.selfPost&&e.deleted&&parseInt(e.deleterUid,10)===parseInt(app.user.uid,10)||(app.user.uid||ajaxify.data.postSharing.length)&&!e.deleted})};function y(t){for(let e=0;e<t.length;e+=1){const d=m.get("user/postcount",t[e].uid);d.html(w.formattedNumber(parseInt(d.attr("data-postcount"),10)+1))}}function v(t){config.topicPostSort==="newest_to_oldest"&&(t[0].index=1,m.get("post").not("[data-index=0]").each(function(){const e=parseInt($(this).attr("data-index"),10)+1;$(this).attr("data-index",e)}))}function o(t){function e(){i(t.posts[0])}const d=t.posts;ajaxify.data.pagination.pageCount=Math.max(1,Math.ceil(d[0].topic.postcount/config.postsPerPage));const u=config.topicPostSort==="oldest_to_newest"||config.topicPostSort==="most_votes"?1:-1;if(ajaxify.data.pagination.currentPage===ajaxify.data.pagination.pageCount&&u===1||ajaxify.data.pagination.currentPage===1&&u===-1){const R=$('[component="post"]:not([data-index=0]), [component="topic/event"]');c(t,R,u,!1,e)}else ajaxify.data.scrollToMyPost&&parseInt(d[0].uid,10)===parseInt(app.user.uid,10)?setTimeout(function(){p.loadPage(ajaxify.data.pagination.pageCount,e)},250):n()}function n(){$.get(config.relative_path+"/api/topic/pagination/"+ajaxify.data.tid,{page:ajaxify.data.pagination.currentPage},function(t){app.parseAndTranslate("partials/paginator",t,function(e){$('[component="pagination"]').after(e).remove()})})}function a(t){const e=config.topicPostSort==="oldest_to_newest"||config.topicPostSort==="most_votes"?1:-1,d=$('[component="post"][data-index="'+(t.posts[0].index-1)+'"]').length;if(!d&&(!t.posts[0].selfPost||!ajaxify.data.scrollToMyPost))return;if(!d&&t.posts[0].selfPost)return ajaxify.go("post/"+t.posts[0].pid);const u=$('[component="topic"]>[component="post"]:not([data-index=0]), [component="topic"]>[component="topic/event"]');c(t,u,e,!1,function(x){x&&x.addClass("new"),i(t.posts[0])})}function i(t){t.selfPost&&ajaxify.data.scrollToMyPost&&g.scrollBottom(t.index)}function c(t,e,d,u,x){if(x=x||function(){},!t||t.posts&&!t.posts.length)return x();function R(){const D=$('[component="post"].new');if(D.length===t.posts.length){let B=!0;if(D.each(function(j,O){parseInt($(O).attr("data-pid"),10)!==parseInt(t.posts[j].pid,10)&&(B=!1)}),B){D.each(function(){$(this).removeClass("new")}),t.posts.length=0;return}}D.length&&t.posts.length>1&&t.posts.forEach(function(B){const j=m.get("post","pid",B.pid);j.hasClass("new")&&j.remove()}),t.posts=t.posts.filter(function(B){return B.allowDupe||$('[component="post"][data-pid="'+B.pid+'"]').length===0})}if(R(),!t.posts.length)return x();let k,N;d>0&&e.length?k=e.last():d<0&&e.length&&(N=e.first()),E.fire("action:posts.loading",{posts:t.posts,after:k,before:N}),app.parseAndTranslate("topic","posts",Object.assign({},ajaxify.data,t),async function(D){D=D.filter(function(){const j=$(this),O=j.attr("data-pid"),F=j.attr("data-allow-dupe");return!j.is('[component="post"]')||F||O&&$('[component="post"][data-pid="'+O+'"]').length===0});const B=h.removeExtra($('[component="post"]'),d,Math.max(20,config.postsPerPage*2));if(k)D.insertAfter(k);else if(N){const j=$(document).height(),O=f.scrollTop();D.insertBefore(N),(u||O>0)&&f.scrollTop(O+($(document).height()-j))}else m.get("topic").append(D);await l.onNewPostsAddedToDom(D),W(B),E.fire("action:posts.loaded",{posts:t.posts}),x(D)})}l.loadMorePosts=function(t){if(!m.get("topic").length||g.scrollActive)return;const e=m.get("topic").find(m.get("post").not("[data-index=0]").not(".new")),d=t>0?e.last():e.first(),u=parseInt(d.attr("data-index"),10)||0,x=ajaxify.data.tid;if(!utils.isNumber(x)||!utils.isNumber(u)||t<0&&m.get("post","index",0).length)return;const R=$(".loading-indicator");R.is(":animated")||R.fadeIn(),h.loadMore("topics.loadMore",{tid:x,after:u+(t>0?1:0),count:config.postsPerPage,direction:t,topicPostSort:utils.params().sort||config.topicPostSort},function(k,N){if(R.fadeOut(),k&&k.posts&&k.posts.length){const D=$('[component="post"]:not([data-index=0]):not(.new), [component="topic/event"]');c(k,D,t,!0,N)}else g.update(),N()})},l.onTopicPageLoad=async function(t){U(t),S.wrapImagesInLinks(t),P(t),l.showBottomPostBar(),t.find('[component="post/content"] img:not(.not-responsive)').addClass("img-fluid"),l.addBlockquoteEllipses(t),K(t),await M()},l.addTopicEvents=async function(t){if(config.topicPostSort==="most_votes")return;const e=await Promise.all(t.map(d=>app.parseAndTranslate("partials/topic/event",{...d,privileges:ajaxify.data.privileges})));if(config.topicPostSort==="oldest_to_newest")$('[component="topic"]').append(e);else if(config.topicPostSort==="newest_to_oldest"){const d=$('[component="topic"] [component="post"][data-index="0"]');d.length?d.after(e.reverse()):$('[component="topic"]').prepend(e.reverse())}$('[component="topic/event"] .timeago').timeago()};async function M(){const t=ajaxify.data.necroThreshold*24*60*60*1e3;if(!t||config.topicPostSort!=="newest_to_oldest"&&config.topicPostSort!=="oldest_to_newest")return;const e=f.scrollTop(),d=$('[component="post"]').toArray();await Promise.all(d.map(async function(u){u=$(u);const x=u.prev('[component="post"]');if(u.is(":has(.necro-post)")||!x.length||config.topicPostSort==="newest_to_oldest"&&parseInt(x.attr("data-index"),10)===0)return;const R=u.attr("data-timestamp")-x.attr("data-timestamp");if(Math.abs(R)>=t){const k=["suffixAgo","prefixAgo","suffixFromNow","prefixFromNow"],N={};k.forEach(j=>{N[j]=$.timeago.settings.strings[j],$.timeago.settings.strings[j]=""});const D=(R>0?"[[topic:timeago-later,":"[[topic:timeago-earlier,")+$.timeago.inWords(R)+"]]";k.forEach(j=>{$.timeago.settings.strings[j]=N[j]});const B=await app.parseAndTranslate("partials/topic/necro-post",{text:D});B.attr("data-necro-post-index",x.attr("data-index")),B.insertBefore(u)}})),e>0&&f.scrollTop()<e&&f.scrollTop(e)}function P(t){ajaxify.data["signatures:hideDuplicates"]&&t.each((e,d)=>{const u=$(d).find('[component="post/signature"]'),x=u.attr("data-uid");l.signaturesShown[x]?u.addClass("hidden"):l.signaturesShown[x]=!0})}function W(t){t.each((e,d)=>{$(`[data-necro-post-index="${$(d).attr("data-index")}"]`).remove()})}function U(t){if(app.user.uid||!ajaxify.data.privateUploads)return;const e=document.createElement("a");e.className="login-required",e.href=config.relative_path+"/login",T.translate("[[topic:login-to-view]]",function(d){e.appendChild(document.createTextNode(d)),t.each(function(u,x){$(x).find('[component="post/content"] img').each(function(R,k){k=$(k),k.attr("src").startsWith(config.relative_path+config.upload_url)&&k.replaceWith(e.cloneNode(!0))})})})}l.onNewPostsAddedToDom=async function(t){await l.onTopicPageLoad(t),t.find(".timeago").timeago()},l.showBottomPostBar=function(){const t=m.get("post","index",0),e=$(".post-bar-placeholder"),d=$('[component="post"]');t.length&&d.length>1&&$(".post-bar").length<2&&e.length?($(".post-bar").clone().insertAfter(e),e.remove()):t.length&&d.length<2&&t.find(".post-bar").remove()};function K(t){t.each(function(){$(this).hasClass("deleted")&&I.toggle($(this).attr("data-pid"),!0)})}return l.addBlockquoteEllipses=function(t){t.find('[component="post/content"] blockquote').filter((u,x)=>!$(x).parent().is("blockquote")).find(">blockquote").each(function(){const u=$(this);u.find(":hidden:not(br)").length&&!u.find(".toggle").length&&u.append('<i class="d-inline-block fa fa-angle-down pointer toggle py-1 px-3 border text-bg-light"></i>')})},l}.apply(L,C),A!==void 0&&(b.exports=A)},60984:(b,L,s)=>{var C,A;C=[s(52473),s(17459),s(60644),s(47536),s(49897),s(91749),s(40027),s(29930),s(89336),s(30076)],A=function(p,h,I,S,g,m,T,E,w,l){const f={};f.init=function(o,n){r(n),$(".topic-main-buttons [title]").tooltip({container:"#content",animation:!1}),f.observeTopicLabels($('[component="topic/labels"]')),n.on("click",'[component="topic/delete"]',function(){return y("del","/state","delete"),!1}),n.on("click",'[component="topic/restore"]',function(){return y("put","/state","restore"),!1}),n.on("click",'[component="topic/purge"]',function(){return y("del","","purge"),!1}),n.on("click",'[component="topic/lock"]',function(){return y("put","/lock","lock"),!1}),n.on("click",'[component="topic/unlock"]',function(){return y("del","/lock","unlock"),!1}),n.on("click",'[component="topic/pin"]',function(){return y("put","/pin","pin"),!1}),n.on("click",'[component="topic/unpin"]',function(){return y("del","/pin","unpin"),!1}),n.on("click",'[component="topic/mark-unread"]',function(){y("del","/read",void 0,()=>{app.previousUrl&&!app.previousUrl.match("^/topic")?ajaxify.go(app.previousUrl,function(){I.onBackClicked(!0)}):ajaxify.data.category&&ajaxify.go("category/"+ajaxify.data.category.slug,I.onBackClicked),E.success("[[topic:mark-unread.success]]")})}),n.on("click",'[component="topic/mark-unread-for-all"]',function(){const i=$(this);y("put","/bump",void 0,()=>{E.success("[[topic:markAsUnreadForAll.success]]"),i.parents(".thread-tools.open").find(".dropdown-toggle").trigger("click")})}),n.on("click",'[component="topic/event/delete"]',function(){const i=$(this).attr("data-topic-event-id"),c=$(this).parents('[component="topic/event"]');T.confirm("[[topic:delete-event-confirm]]",M=>{M&&g.del(`/topics/${o}/events/${i}`,{}).then(function(){c.remove()}).catch(E.error)})}),n.on("click",'[component="topic/move"]',function(){return s.e(28310).then(function(){var i=[s(28310)];(function(c){c.init([o],ajaxify.data.cid)}).apply(null,i)}).catch(s.oe),!1}),n.on("click",'[component="topic/delete/posts"]',function(){s.e(36422).then(function(){var i=[s(36422)];(function(c){c.init()}).apply(null,i)}).catch(s.oe)}),n.on("click",'[component="topic/fork"]',function(){s.e(49771).then(function(){var i=[s(49771)];(function(c){c.init()}).apply(null,i)}).catch(s.oe)}),n.on("click",'[component="topic/merge"]',function(){s.e(2403).then(function(){var i=[s(2403)];(function(c){c.init(function(){c.addTopic(ajaxify.data.tid)})}).apply(null,i)}).catch(s.oe)}),n.on("click",'[component="topic/tag"]',function(){s.e(63).then(function(){var i=[s(63)];(function(c){c.init([ajaxify.data],ajaxify.data.tagWhitelist)}).apply(null,i)}).catch(s.oe)}),n.on("click",'[component="topic/move-posts"]',function(){s.e(90677).then(function(){var i=[s(90677)];(function(c){c.init()}).apply(null,i)}).catch(s.oe)}),n.on("click",'[component="topic/following"]',function(){a("follow")}),n.on("click",'[component="topic/not-following"]',function(){a("follow",0)}),n.on("click",'[component="topic/ignoring"]',function(){a("ignore")});function a(i,c=1){return g[c?"put":"del"](`/topics/${o}/${i}`,{},()=>{let P="";i==="follow"?P=c?"[[topic:following-topic.message]]":"[[topic:not-following-topic.message]]":i==="ignore"&&(P=c?"[[topic:ignoring-topic.message]]":"[[topic:not-following-topic.message]]"),c||(i="unfollow"),v(i),E.alert({alert_id:"follow_thread",message:P,type:"success",timeout:5e3}),m.fire("action:topics.changeWatching",{tid:o,type:i})},()=>{E.alert({type:"danger",alert_id:"topic_follow",title:"[[global:please-log-in]]",message:"[[topic:login-to-subscribe]]",timeout:5e3})}),!1}},f.observeTopicLabels=function(o){const n=new MutationObserver(function(a){const i=a[0];if(i&&i.attributeName==="class"){const c=o.children().filter((M,P)=>!$(P).hasClass("hidden"));o.toggleClass("hidden",!c.length)}});o.children().each((a,i)=>{n.observe(i,{attributes:!0})})};function r(o){o&&o.on("show.bs.dropdown",".thread-tools",async function(){const n=$(this),a=n.find(".dropdown-menu"),{top:i}=this.getBoundingClientRect();if(n.toggleClass("dropup",i>window.innerHeight/2),a.attr("data-loaded"))return;a.html(l.generatePlaceholderWave([8,8,8]));const c=await socket.emit("topics.loadTopicTools",{tid:ajaxify.data.tid,cid:ajaxify.data.cid}),M=await app.parseAndTranslate("partials/topic/topic-menu-list",c);$(a).attr("data-loaded","true").html(M),m.fire("action:topic.tools.load",{element:$(a)})})}function y(o,n,a,i){i||(i=function(){});const c=ajaxify.data.tid,M={},P=function(W){W&&g[o](`/topics/${c}${n}`,M).then(i).catch(E.error)};switch(a){case"delete":case"restore":case"purge":T.confirm(`[[topic:thread-tools.${a}-confirm]]`,P);break;case"pin":f.requestPinExpiry(M,P.bind(null,!0));break;default:P(!0);break}}f.requestPinExpiry=function(o,n){app.parseAndTranslate("modals/set-pin-expiry",{},function(a){const i=T.dialog({title:"[[topic:thread-tools.pin]]",message:a,onEscape:!0,buttons:{cancel:{label:"[[modules:bootbox.cancel]]",className:"btn-link"},save:{label:"[[global:save]]",className:"btn-primary",callback:function(){const c=i.get(0).querySelector("#expiry-date"),M=i.get(0).querySelector("#expiry-time");let P=c.value,W=M.value;if(P===""&&W==="")return n();P=P||new Date().toDateString(),W=W||new Date().toTimeString();const U=new Date(`${P} ${W}`);U.getTime()>Date.now()?(o.expiry=U.getTime(),n()):E.error("[[error:invalid-date]]")}}}})})},f.setLockedState=function(o){const n=p.get("topic");if(parseInt(o.tid,10)!==parseInt(n.attr("data-tid"),10))return;const a=o.isLocked&&!ajaxify.data.privileges.isAdminOrMod;p.get("topic/lock").toggleClass("hidden",o.isLocked).parent().attr("hidden",o.isLocked?"":null),p.get("topic/unlock").toggleClass("hidden",!o.isLocked).parent().attr("hidden",o.isLocked?null:"");const i=!!((o.isLocked||ajaxify.data.deleted)&&!ajaxify.data.privileges.isAdminOrMod);p.get("topic/reply/container").toggleClass("hidden",i),p.get("topic/reply/locked").toggleClass("hidden",ajaxify.data.privileges.isAdminOrMod||!o.isLocked||ajaxify.data.deleted),n.find('[component="post"]:not(.deleted) [component="post/reply"], [component="post"]:not(.deleted) [component="post/quote"]').toggleClass("hidden",i),n.find('[component="post/edit"], [component="post/delete"]').toggleClass("hidden",a),n.find('[component="post"][data-uid="'+app.user.uid+'"].deleted [component="post/tools"]').toggleClass("hidden",a),$('[component="topic/labels"] [component="topic/locked"]').toggleClass("hidden",!o.isLocked),$('[component="post/tools"] .dropdown-menu').html(""),ajaxify.data.locked=o.isLocked,S.addTopicEvents(o.events)},f.setDeleteState=function(o){const n=p.get("topic");if(parseInt(o.tid,10)!==parseInt(n.attr("data-tid"),10))return;p.get("topic/delete").toggleClass("hidden",o.isDelete).parent().attr("hidden",o.isDelete?"":null),p.get("topic/restore").toggleClass("hidden",!o.isDelete).parent().attr("hidden",o.isDelete?null:""),p.get("topic/purge").toggleClass("hidden",!o.isDelete).parent().attr("hidden",o.isDelete?null:""),p.get("topic/deleted/message").toggleClass("hidden",!o.isDelete),o.isDelete&&app.parseAndTranslate("partials/topic/deleted-message",{deleter:o.user,deleted:!0,deletedTimestampISO:utils.toISOString(Date.now())},function(i){p.get("topic/deleted/message").replaceWith(i),i.find(".timeago").timeago()});const a=o.isDelete&&!ajaxify.data.privileges.isAdminOrMod;p.get("topic/reply/container").toggleClass("hidden",a),p.get("topic/reply/locked").toggleClass("hidden",ajaxify.data.privileges.isAdminOrMod||!ajaxify.data.locked||o.isDelete),n.find('[component="post"]:not(.deleted) [component="post/reply"], [component="post"]:not(.deleted) [component="post/quote"]').toggleClass("hidden",a),n.toggleClass("deleted",o.isDelete),ajaxify.data.deleted=o.isDelete?1:0,S.addTopicEvents(o.events)},f.setPinnedState=function(o){const n=p.get("topic");if(parseInt(o.tid,10)!==parseInt(n.attr("data-tid"),10))return;p.get("topic/pin").toggleClass("hidden",o.pinned).parent().attr("hidden",o.pinned?"":null),p.get("topic/unpin").toggleClass("hidden",!o.pinned).parent().attr("hidden",o.pinned?null:"");const a=$('[component="topic/labels"] [component="topic/pinned"]');a.toggleClass("hidden",!o.pinned),o.pinned&&a.translateAttr("title",o.pinExpiry&&o.pinExpiryISO?"[[topic:pinned-with-expiry, "+o.pinExpiryISO+"]]":"[[topic:pinned]]"),ajaxify.data.pinned=o.pinned,S.addTopicEvents(o.events)};function v(o){const n={follow:"[[topic:watching]]",unfollow:"[[topic:not-watching]]",ignore:"[[topic:ignoring]]"};h.translate(n[o],function(i){const c=w.Tooltip.getInstance('[component="topic/watch"]');c&&c.setContent({".tooltip-inner":i})});let a=p.get("topic/following/menu");a.toggleClass("hidden",o!=="follow"),p.get("topic/following/check").toggleClass("fa-check",o==="follow"),a=p.get("topic/not-following/menu"),a.toggleClass("hidden",o!=="unfollow"),p.get("topic/not-following/check").toggleClass("fa-check",o==="unfollow"),a=p.get("topic/ignoring/menu"),a.toggleClass("hidden",o!=="ignore"),p.get("topic/ignoring/check").toggleClass("fa-check",o==="ignore")}return f}.apply(L,C),A!==void 0&&(b.exports=A)},60644:(b,L,s)=>{var C,A;C=[s(52473),s(68636),s(96352),s(25967)],A=function(p,h,I,S){const g={};let m;g.init=function(w){m=w,T(),$(window).off("action:popstate",E).on("action:popstate",E)},g.onBackClicked=E;function T(){$('[component="category"]').on("click",'[component="topic/header"]',function(){const w=$(this).parents("[data-index]").attr("data-index"),l=$(window).scrollTop();$('[component="category/topic"]').each(function(f,r){if($(r).offset().top-l>0)return h.setItem("category:bookmark",$(r).attr("data-index")),h.setItem("category:bookmark:clicked",w),h.setItem("category:bookmark:offset",$(r).offset().top-l),!1})})}function E(w){const l=w&&ajaxify.data.template.unread;if(ajaxify.data.template.category||ajaxify.data.template.recent||ajaxify.data.template.popular||l){let f=h.getItem("category:bookmark"),r=h.getItem("category:bookmark:clicked");if(h.removeItem("category:bookmark"),h.removeItem("category:bookmark:clicked"),!utils.isNumber(f))return;if(f=Math.max(0,parseInt(f,10)||0),r=Math.max(0,parseInt(r,10)||0),config.usePagination){const y=Math.ceil((parseInt(f,10)+1)/config.topicsPerPage);parseInt(y,10)!==ajaxify.data.pagination.currentPage?S.loadPage(y,function(){g.scrollToTopic(f,r)}):g.scrollToTopic(f,r)}else{if(f===0){g.scrollToTopic(f,r);return}$('[component="category"]').empty(),m(Math.max(0,f-1)+1,function(){g.scrollToTopic(f,r)})}}}return g.highlightTopic=function(w){const l=p.get("category/topic","index",w);l.length&&!l.hasClass("highlight")&&(l.addClass("highlight"),setTimeout(function(){l.removeClass("highlight")},5e3))},g.scrollToTopic=function(w,l){if(!utils.isNumber(w))return;const f=p.get("category/topic","index",w);if(f.length){const r=h.getItem("category:bookmark:offset");h.removeItem("category:bookmark:offset"),$(window).scrollTop(f.offset().top-r),g.highlightTopic(l),I.update()}},g}.apply(L,C),A!==void 0&&(b.exports=A)}}]);
