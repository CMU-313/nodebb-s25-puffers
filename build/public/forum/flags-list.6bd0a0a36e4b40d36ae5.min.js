"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[37019,99127,34271,13417,51831,69185,1091,26174,26874,49897,34405],{33491:(k,x,l)=>{l.r(x),l.d(x,{enableCheckboxes:()=>n,enableFilterForm:()=>e,getSelected:()=>E,handleBulkActions:()=>g,handleGraphs:()=>v,init:()=>u});var f=l(92262),p=l(39259),D=l.n(p),A=l(64308),_=l.n(A),m=l(34405),h=l.n(m),i=l(49897),a=l(29930),s=l(52473),o=l.n(s);f.t1.register(f.ZT,f.PP,f.kc,f.No,f.FN,f.m_,f.dN);const c=new Map([["cids",[]],["assignee",[]],["targetUid",[]],["reporterId",[]]]);function u(){e(),n(),g(),ajaxify.data.filters.hasOwnProperty("cid")&&c.set("cids",Array.isArray(ajaxify.data.filters.cid)?ajaxify.data.filters.cid:[ajaxify.data.filters.cid]),p.init($('[component="category/dropdown"]'),{privilege:"moderate",selectedCids:c.get("cids"),updateButton:function({selectedCids:r}){c.set("cids",r),t()}}),["assignee","targetUid","reporterId"].forEach(r=>{ajaxify.data.filters.hasOwnProperty("filter")&&c.set(r,ajaxify.data.selected[r]);const d=$(`[component="flags/filter/${r}"]`);A.init(d,{selectedUsers:c.get(r),template:"partials/flags/filters",selectedBlock:`selected.${r}`,onSelect:function(C){c.set(r,C)},onHidden:function(){t()}})}),s.get("flags/list").on("click","[data-flag-id]",function(r){if(["BUTTON","A"].includes(r.target.nodeName))return;const d=this.getAttribute("data-flag-id");ajaxify.go("flags/"+d)}),$("#flags-daily-wrapper").one("shown.bs.collapse",function(){v()}),m.user($("#filter-assignee, #filter-targetUid, #filter-reporterId"),(r,d)=>{setTimeout(()=>{r.target.value=d.item.user.uid})})}function e(){const r=s.get("flags/filters");if(r&&r.get(0).nodeName!=="FORM"){const d=r.get(0),C=d.querySelector("form");d.addEventListener("click",O=>{const y=O.target.closest("[data-value]");if(!y)return;const P=y.getAttribute("data-name"),b=y.getAttribute("data-value");C[P].value=b,t()})}else{for(const d in ajaxify.data.filters)ajaxify.data.filters.hasOwnProperty(d)&&r.find('[name="'+d+'"]').val(ajaxify.data.filters[d]);r.find('[name="sort"]').val(ajaxify.data.sort),document.getElementById("apply-filters").addEventListener("click",function(){t()}),r.find('button[data-target="#more-filters"]').click(d=>{const C=d.target.getAttribute("data-text-variant");C&&(d.target.setAttribute("data-text-variant",d.target.textContent),d.target.firstChild.textContent=C)})}}function t(){let r=s.get("flags/filters").get(0);if(!r)return;r.nodeName!=="FORM"&&(r=r.querySelector("form"));const d=new FormData(r);c.get("cids").forEach(function(y){d.append("cid",y)}),["assignee","targetUid","reporterId"].forEach(y=>{c.get(y).forEach(({uid:P})=>{d.append(y,P)})});const C=Array.from(d.values()).filter(Boolean),O=new URLSearchParams(d).toString();ajaxify.go("flags?"+(C?O:"reset=1"))}function n(){const r=document.querySelector('[component="flags/list"]'),d=r.querySelectorAll('[data-flag-id] input[type="checkbox"]'),C=document.querySelector('[component="flags/bulk-actions"] button');let O;document.querySelector('[data-action="toggle-all"]').addEventListener("click",function(){const y=this.checked;d.forEach(function(P){P.checked=y}),C.disabled=!y}),r.addEventListener("click",function(y){const P=y.target.closest('input[type="checkbox"]');if(P){if(y.stopImmediatePropagation(),O&&y.shiftKey&&O!==P){const b=P.checked;let M=!1;d.forEach(function(B){[P,O].some(function(I){return I===B})&&(M=!M),M&&(B.checked=b)})}C.disabled=!Array.prototype.some.call(d,function(b){return b.checked}),O=P}y.target.querySelector('input[type="checkbox"]')&&y.stopImmediatePropagation()})}function g(){document.querySelector('[component="flags/bulk-actions"]').addEventListener("click",function(r){const d=r.target.closest("[data-action]");if(d){const C=d.getAttribute("data-action"),y=E().map(P=>{const b={};return C==="bulk-assign"?b.assignee=app.user.uid:C==="bulk-mark-resolved"&&(b.state="resolved"),i.put(`/flags/${P}`,b)});Promise.allSettled(y).then(function(P){const b=P.filter(function(B){return B.status==="fulfilled"}).length,M=P.filter(function(B){return B.status==="rejected"});b&&(a.success("[[flags:bulk-success, "+b+"]]"),ajaxify.refresh()),M.forEach(function(B){a.error(B.reason)})})}})}function E(){const r=document.querySelectorAll('[component="flags/list"] [data-flag-id] input[type="checkbox"]'),d=[];return r.forEach(function(C){C.checked&&d.push(C.closest("[data-flag-id]").getAttribute("data-flag-id"))}),d}function v(){const r=document.getElementById("flags:daily"),d=utils.getDaysArray().map(function(O,y){return y%3?"":O});utils.isMobile()&&(f.t1.defaults.plugins.tooltip.enabled=!1);const C={"flags:daily":{labels:d,datasets:[{label:"",backgroundColor:"rgba(151,187,205,0.2)",borderColor:"rgba(151,187,205,1)",pointBackgroundColor:"rgba(151,187,205,1)",pointHoverBackgroundColor:"#fff",pointBorderColor:"#fff",pointHoverBorderColor:"rgba(151,187,205,1)",data:ajaxify.data.analytics}]}};r.width=$(r).parent().width(),new f.t1(r.getContext("2d"),{type:"line",data:C["flags:daily"],options:{responsive:!0,animation:!1,scales:{y:{beginAtZero:!0}}}})}},49897:(k,x,l)=>{l.r(x),l.d(x,{del:()=>u,get:()=>i,head:()=>a,patch:()=>o,post:()=>s,put:()=>c});var f=l(91749),p=l.n(f),D=l(40027),A=l.n(D);const _=config.relative_path+"/api/v3";async function m(e,t){if(e.url=e.url.startsWith("/api")?config.relative_path+e.url:_+e.url,typeof t=="function"){h(e).then(n=>t(null,n),n=>t(n));return}try{return await h(e)}catch(n){if(n.message==="A valid login session was not found. Please log in and try again."){const{url:g}=await(0,f.fire)("filter:admin.reauth",{url:"login"});return(0,D.confirm)("[[error:api.reauth-required]]",E=>{E&&ajaxify.go(g)})}throw n}}async function h(e){const{url:t}=e;delete e.url,e.data&&!(e.data instanceof FormData)&&(e.data=JSON.stringify(e.data||{}),e.headers["content-type"]="application/json; charset=utf-8"),{options:e}=await(0,f.fire)("filter:api.options",{options:e}),e.data&&(e.body=e.data,delete e.data);const n=await fetch(t,e),{headers:g}=n,E=g.get("content-type"),v=E&&E.startsWith("application/json");let r;if(e.method!=="HEAD"&&(v?r=await n.json():r=await n.text()),!n.ok)throw r?new Error(v?r.status.message:r):new Error(n.statusText);return v&&r&&r.hasOwnProperty("status")&&r.hasOwnProperty("response")?r.response:r}function i(e,t,n){return m({url:e+(t&&Object.keys(t).length?"?"+$.param(t):"")},n)}function a(e,t,n){return m({url:e+(t&&Object.keys(t).length?"?"+$.param(t):""),method:"HEAD"},n)}function s(e,t,n){return m({url:e,method:"POST",data:t,headers:{"x-csrf-token":config.csrf_token}},n)}function o(e,t,n){return m({url:e,method:"PATCH",data:t,headers:{"x-csrf-token":config.csrf_token}},n)}function c(e,t,n){return m({url:e,method:"PUT",data:t,headers:{"x-csrf-token":config.csrf_token}},n)}function u(e,t,n){return m({url:e,method:"DELETE",data:t,headers:{"x-csrf-token":config.csrf_token}},n)}},34405:(k,x,l)=>{var f,p;f=[l(49897),l(29930)],p=function(D,A){const _={},m={delay:200,appendTo:null};_.init=i=>{const a={...m,...i},{input:s,onSelect:o}=a;app.loadJQueryUI(function(){s.autocomplete({...a,open:function(){$(this).autocomplete("widget").css("z-index",100005)},select:function(c,u){h(s,o,c,u)}})})},_.user=function(i,a,s){typeof a=="function"&&(s=a,a={}),a=a||{},_.init({input:i,onSelect:s,source:(o,c)=>{a.query=o.term,D.get("/api/users",a,function(u,e){if(u)return A.error(u);if(e&&e.users){const t=e.users.map(function(n){const g=$("<div></div>").html(n.username).text();return n&&{label:g,value:g,user:{uid:n.uid,name:n.username,slug:n.userslug,username:n.username,userslug:n.userslug,picture:n.picture,banned:n.banned,"icon:text":n["icon:text"],"icon:bgColor":n["icon:bgColor"]}}});c(t)}$(".ui-autocomplete a").attr("data-ajaxify","false")})}})},_.group=function(i,a){_.init({input:i,onSelect:a,source:(s,o)=>{socket.emit("groups.search",{query:s.term},function(c,u){if(c)return A.error(c);if(u&&u.length){const e=u.map(function(t){return t&&{label:t.name,value:t.name,group:t}});o(e)}$(".ui-autocomplete a").attr("data-ajaxify","false")})}})},_.tag=function(i,a){_.init({input:i,onSelect:a,delay:100,source:(s,o)=>{socket.emit("topics.autocompleteTags",{query:s.term,cid:ajaxify.data.cid||0},function(c,u){if(c)return A.error(c);u&&o(u),$(".ui-autocomplete a").attr("data-ajaxify","false")})}})};function h(i,a,s,o){a=a||function(){};const c=jQuery.Event("keypress");c.which=13,c.keyCode=13,setTimeout(function(){i.trigger(c)},100),a(s,o)}return _}.apply(x,f),p!==void 0&&(k.exports=p)},39259:(k,x,l)=>{var f,p;f=[l(96349),l(49897),l(91749)],p=function(D,A,_){const m={};m.init=function(i,a){if(!i||!i.length)return;a=a||{},a.states=a.states||["watching","tracking","notwatching","ignoring"],a.template=a.template||"partials/category/filter-dropdown-left",_.fire("action:category.filter.options",{el:i,options:a}),D.init(i,a);let s=[],o=[];Array.isArray(a.selectedCids)?s=a.selectedCids.map(String):Array.isArray(ajaxify.data.selectedCids)&&(s=ajaxify.data.selectedCids.map(String)),o=s.slice(),i.on("hidden.bs.dropdown",function(){let c=o.length!==s.length;if(o.forEach(function(u,e){u!==s[e]&&(c=!0)}),o=s.slice(),c&&(a.updateButton?a.updateButton({el:i,changed:c,selectedCids:s.slice()}):a.updateButton!==!1&&h(i,s)),a.onHidden){a.onHidden({changed:c,selectedCids:s.slice()});return}if(c){let u=window.location.pathname;const e=utils.params();s.length?e.cid=s:delete e.cid,delete e.page,Object.keys(e).length&&(u+="?"+decodeURIComponent($.param(e))),ajaxify.go(u)}}),i.on("click",'[component="category/list"] [data-cid]',function(c){const u=i.find('[component="category/list"]'),e=$(this),t=e.find("a").attr("href");if(t&&t!=="#"&&t.length){c.stopPropagation();return}const n=e.attr("data-cid"),g=e.find('[component="category/select/icon"]');return n!=="all"?(s.includes(n)?s.splice(s.indexOf(n),1):s.push(n),s.sort(function(E,v){return E-v}),g.toggleClass("invisible"),u.find('[data-cid="all"] i').toggleClass("invisible",!!s.length)):(i.find('[component="category/select/icon"]').addClass("invisible"),u.find('[data-cid="all"] i').removeClass("invisible"),s=[]),a.selectedCids=s,a.onSelect&&a.onSelect({cid:n,selectedCids:s.slice()}),!1})};function h(i,a){a.length>1?s({icon:"fa-plus",name:"[[unread:multiple-categories-selected]]",bgColor:"#ddd"}):a.length===1?A.get(`/categories/${a[0]}`,{}).then(s):s();function s(o){app.parseAndTranslate("partials/category/filter-dropdown-content",{selectedCategory:o},function(c){i.find("button").replaceWith($("<div/>").html(c).find("button"))})}}return m}.apply(x,f),p!==void 0&&(k.exports=p)},96349:(k,x,l)=>{var f,p;f=[l(29930),l(89336),l(49897)],p=function(D,A,_){const m={};return m.init=function(h,i){let a=null;i=i||{},i.privilege=i.privilege||"topics:read",i.states=i.states||["watching","tracking","notwatching","ignoring"],i.cacheList=i.hasOwnProperty("cacheList")?i.cacheList:!0;let s=[];Array.isArray(i.localCategories)&&(s=i.localCategories.map(t=>({...t}))),i.selectedCids=i.selectedCids||ajaxify.data.selectedCids||[];const o=h.find('[component="category-selector-search"]');if(!o.length)return;const c=o.parent('[component="category/dropdown"]').length>0||o.parent('[component="category-selector"]').length>0;h.on("show.bs.dropdown",function(){c&&(h.find(".dropdown-toggle").css({visibility:"hidden"}),o.removeClass("hidden"),o.css({"z-index":h.find(".dropdown-toggle").css("z-index")+1}));function t(){const n=o.find("input").val();n.length>1||!n&&!a?u(n,function(g){a=i.cacheList&&(a||g),e(g)}):!n&&a&&e(a)}o.on("click",function(n){n.preventDefault(),n.stopPropagation()}),o.find("input").val("").on("keyup",utils.debounce(t,300)),t()}),h.on("shown.bs.dropdown",function(){["xs","sm"].includes(utils.findBootstrapEnvironment())||o.find("input").focus()}),h.on("hide.bs.dropdown",function(){c&&(h.find(".dropdown-toggle").css({visibility:"inherit"}),o.addClass("hidden")),o.off("click"),o.find("input").off("keyup")});function u(t,n){_.get("/search/categories",{search:t,query:utils.params(),parentCid:i.parentCid||0,selectedCids:i.selectedCids,privilege:i.privilege,states:i.states,showLinks:i.showLinks},function(g,{categories:E}){if(g)return D.error(g);n(s.concat(E))})}function e(t){const n=i.selectedCids.map(String);t.forEach(function(g){g.selected=n.includes(String(g.cid))}),app.parseAndTranslate(i.template,{categoryItems:t.slice(0,200),selectedCategory:ajaxify.data.selectedCategory,allCategoriesUrl:ajaxify.data.allCategoriesUrl},function(g){h.find('[component="category/list"]').html(g.find('[component="category/list"]').html()),h.find('[component="category/list"] [component="category/no-matches"]').toggleClass("hidden",!!t.length);const E=A.Dropdown.getInstance(h.find(".dropdown-toggle").get(0));E&&E.update()})}},m}.apply(x,f),p!==void 0&&(k.exports=p)},13230:(k,x,l)=>{var f,p,D;(function(A){p=[l(53050)],f=A,D=typeof f=="function"?f.apply(x,p):f,D!==void 0&&(k.exports=D)})(function(A){const _=A("[^\\p{L}\\s\\d\\-_]","g"),m=/[^\w\s\d\-_]/g,h=/^\s+|\s+$/g,i=/\s+/g,a=/-+/g,s=/-$/g,o=/^-/g,c=/^[\w\d\s.,\-@]+$/;return function(e,t){return e?(e=String(e).replace(h,""),c.test(e)?e=e.replace(m,"-"):e=A.replace(e,_,"-"),e=t?e:e.toLocaleLowerCase(),e=e.replace(i,"-"),e=e.replace(a,"-"),e=e.replace(s,""),e=e.replace(o,""),e):""}})},64308:(k,x,l)=>{var f,p;f=[l(49897),l(91749),l(13230),l(81335)],p=function(D,A,_,m){const h={};return h.init=function(i,a){if(!i||!i.length)return;a=a||{};let s,o=[];a.selectedUsers&&(o=a.selectedUsers.map(t=>({...t}))),A.fire("action:user.filter.options",{el:i,options:a});async function c(){const t=a.selectedBlock||"userFilterSelected",n={};if(t.indexOf(".")!==-1){const E=t.split(".");n[E[0]]={},n[E[0]][E[1]]=o}else n[t]=o;const g=await app.parseAndTranslate(a.template,t,n);i.find('[component="user/filter/selected"]').html(g)}async function u(){await c(),a.onSelect&&a.onSelect(o)}async function e(){let t={users:[]};const n=i.find('[component="user/filter/search"]').val();if(n&&n.length>1)if(app.user.privileges["search:users"])t=await D.get("/api/users",{query:n});else try{const v=await D.get(`/api/user/${_(n)}`);t.users.push(v)}catch{}if(!t.users.length){i.find('[component="user/filter/results"]').translateHtml("[[users:no-users-found]]");return}t.users=t.users.slice(0,20);const g={};t.users.forEach(v=>{g[v.uid]=v});const E=await app.parseAndTranslate(a.template,"userFilterResults",{userFilterResults:t.users});i.find('[component="user/filter/results"]').html(E),i.find('[component="user/filter/results"] [data-uid]').on("click",async function(){const v=parseInt($(this).attr("data-uid"),10);o.find(r=>r.uid===v)||(o.push(g[v]),await u())})}i.find('[component="user/filter/search"]').on("keyup",()=>{i.find('[component="user/filter/results"]').html(s)}),i.find('[component="user/filter/search"]').on("keyup",utils.debounce(function(){app.user.privileges["search:users"]&&e()},1e3)),i.on("click",'[component="user/filter/delete"]',async function(){const t=$(this).attr("data-uid");o=o.filter(n=>parseInt(n.uid,10)!==parseInt(t,10)),await u()}),i.find('[component="user/filter/search"]').on("keyup",t=>{t.key==="Enter"&&!app.user.privileges["search:users"]&&e()}),i.on("shown.bs.dropdown",function(){i.find('[component="user/filter/search"]').trigger("focus")}),i.on("hidden.bs.dropdown",function(){a.onHidden&&a.onHidden(o)}),m.render(a.placeholderTemplate||"partials/userFilter-placeholders").then(t=>{s=t})},h}.apply(x,f),p!==void 0&&(k.exports=p)}}]);
