"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[13201,99127,34271,1091,49897],{11599:(w,g,s)=>{var h,m;h=[s(52473),s(91749),s(49897)],m=function(f,D,C){const i={};i.prepareDOM=function(){const o=$('[component="chat/dropdown"]');o.length&&(o.on("show.bs.dropdown",r=>{u("loadChatsDropdown",$(r.target).parent().find('[component="chat/list"]'))}),o.each((r,a)=>{const t=$(a).parent().find(".dropdown-menu");t.hasClass("show")&&u("loadChatsDropdown",t.find('[component="chat/list"]'))}),socket.removeListener("event:chats.receive",d),socket.on("event:chats.receive",d),socket.removeListener("event:chats.typing",p),socket.on("event:chats.typing",p),socket.removeListener("event:chats.roomRename",E),socket.on("event:chats.roomRename",E),socket.on("event:unread.updateChatCount",async function(r){if(r){const[e,l]=await app.require(["chat","forum/chats"]);if(e.isFromBlockedUser(r.fromUid)||e.isLookingAtRoom(r.roomId)||app.user.uid===parseInt(r.fromUid,10))return;l.markChatPageElUnread(r)}let{count:a}=await C.get("/chats/unread");const t=f.get("chat/icon");a=Math.max(0,a),t.toggleClass("fa-comment",a>0).toggleClass("fa-comment-o",a<=0);const n=a>99?"99+":a;f.get("chat/icon").toggleClass("unread-count",a>0).attr("data-content",n),f.get("chat/count").toggleClass("hidden",a<=0).text(n),D.fire("action:chat.updateCount",{count:a})}))};function d(o){u("onChatMessageReceived",o)}function p(o){u("onUserTyping",o)}function E(o){u("onRoomRename",o)}async function u(o,r){(await app.require("chat"))[o](r)}return i}.apply(g,h),m!==void 0&&(w.exports=m)},49897:(w,g,s)=>{s.r(g),s.d(g,{del:()=>a,get:()=>p,head:()=>E,patch:()=>o,post:()=>u,put:()=>r});var h=s(91749),m=s.n(h),f=s(40027),D=s.n(f);const C=config.relative_path+"/api/v3";async function i(t,n){if(t.url=t.url.startsWith("/api")?config.relative_path+t.url:C+t.url,typeof n=="function"){d(t).then(e=>n(null,e),e=>n(e));return}try{return await d(t)}catch(e){if(e.message==="A valid login session was not found. Please log in and try again."){const{url:l}=await(0,h.fire)("filter:admin.reauth",{url:"login"});return(0,f.confirm)("[[error:api.reauth-required]]",v=>{v&&ajaxify.go(l)})}throw e}}async function d(t){const{url:n}=t;delete t.url,t.data&&!(t.data instanceof FormData)&&(t.data=JSON.stringify(t.data||{}),t.headers["content-type"]="application/json; charset=utf-8"),{options:t}=await(0,h.fire)("filter:api.options",{options:t}),t.data&&(t.body=t.data,delete t.data);const e=await fetch(n,t),{headers:l}=e,v=l.get("content-type"),y=v&&v.startsWith("application/json");let c;if(t.method!=="HEAD"&&(y?c=await e.json():c=await e.text()),!e.ok)throw c?new Error(y?c.status.message:c):new Error(e.statusText);return y&&c&&c.hasOwnProperty("status")&&c.hasOwnProperty("response")?c.response:c}function p(t,n,e){return i({url:t+(n&&Object.keys(n).length?"?"+$.param(n):"")},e)}function E(t,n,e){return i({url:t+(n&&Object.keys(n).length?"?"+$.param(n):""),method:"HEAD"},e)}function u(t,n,e){return i({url:t,method:"POST",data:n,headers:{"x-csrf-token":config.csrf_token}},e)}function o(t,n,e){return i({url:t,method:"PATCH",data:n,headers:{"x-csrf-token":config.csrf_token}},e)}function r(t,n,e){return i({url:t,method:"PUT",data:n,headers:{"x-csrf-token":config.csrf_token}},e)}function a(t,n,e){return i({url:t,method:"DELETE",data:n,headers:{"x-csrf-token":config.csrf_token}},e)}}}]);
