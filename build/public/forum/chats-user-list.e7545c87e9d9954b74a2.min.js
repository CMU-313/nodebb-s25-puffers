"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,34271,49897,56227,99127],{49897:(A,y,i)=>{i.r(y),i.d(y,{del:()=>f,get:()=>w,head:()=>r,patch:()=>s,post:()=>a,put:()=>l});var u=i(91749),_=i.n(u),h=i(40027),p=i.n(h);const c=config.relative_path+"/api/v3";async function d(t,n){if(t.url=t.url.startsWith("/api")?config.relative_path+t.url:c+t.url,typeof n=="function"){g(t).then(e=>n(null,e),e=>n(e));return}try{return await g(t)}catch(e){if(e.message==="A valid login session was not found. Please log in and try again."){const{url:E}=await(0,u.fire)("filter:admin.reauth",{url:"login"});return(0,h.confirm)("[[error:api.reauth-required]]",m=>{m&&ajaxify.go(E)})}throw e}}async function g(t){const{url:n}=t;delete t.url,t.data&&!(t.data instanceof FormData)&&(t.data=JSON.stringify(t.data||{}),t.headers["content-type"]="application/json; charset=utf-8"),{options:t}=await(0,u.fire)("filter:api.options",{options:t}),t.data&&(t.body=t.data,delete t.data);const e=await fetch(n,t),{headers:E}=e,m=E.get("content-type"),x=m&&m.startsWith("application/json");let o;if(t.method!=="HEAD"&&(x?o=await e.json():o=await e.text()),!e.ok)throw o?new Error(x?o.status.message:o):new Error(e.statusText);return x&&o&&o.hasOwnProperty("status")&&o.hasOwnProperty("response")?o.response:o}function w(t,n,e){return d({url:t+(n&&Object.keys(n).length?"?"+$.param(n):"")},e)}function r(t,n,e){return d({url:t+(n&&Object.keys(n).length?"?"+$.param(n):""),method:"HEAD"},e)}function a(t,n,e){return d({url:t,method:"POST",data:n,headers:{"x-csrf-token":config.csrf_token}},e)}function s(t,n,e){return d({url:t,method:"PATCH",data:n,headers:{"x-csrf-token":config.csrf_token}},e)}function l(t,n,e){return d({url:t,method:"PUT",data:n,headers:{"x-csrf-token":config.csrf_token}},e)}function f(t,n,e){return d({url:t,method:"DELETE",data:n,headers:{"x-csrf-token":config.csrf_token}},e)}},72513:(A,y,i)=>{var u,_;u=[i(49897)],_=function(h){const p={};let c=0;p.init=function(r,a){const s=a.find('[component="chat/user/list"]');if(!s.length)return;const l=a.find('[component="chat/messages/pinned/container"]');a.find('[component="chat/user/list/btn"]').on("click",()=>{s.toggleClass("hidden"),s.hasClass("hidden")?g():(l.addClass("hidden"),d(r,s))}),$(window).off("action:ajaxify.start",g).one("action:ajaxify.start",g),p.addInfiniteScrollHandler(r,s,async(f,t)=>{f.append(await app.parseAndTranslate("partials/chats/user-list","users",t))})};function d(r,a){c&&clearInterval(c),c=setInterval(()=>{w(r,a)},5e3)}function g(){c&&(clearInterval(c),c=0)}async function w(r,a){if(ajaxify.data.template.chats&&app.isFocused&&a.scrollTop()===0&&!a.hasClass("hidden")){const s=await h.get(`/chats/${r}/users`,{start:0});a.find('[data-bs-toggle="tooltip"]').tooltip("dispose"),a.html(await app.parseAndTranslate("partials/chats/user-list","users",s)),a.find('[data-bs-toggle="tooltip"]').tooltip()}}return p.addInfiniteScrollHandler=function(r,a,s){a.on("scroll",utils.debounce(async()=>{const l=(a[0].scrollHeight-a.height())*.85;if(a.scrollTop()>l){const f=a.find("[data-index]").last().attr("data-index"),t=await h.get(`/chats/${r}/users`,{start:parseInt(f,10)+1});t&&t.users.length&&s(a,t)}},200))},p.addSearchHandler=function(r,a,s){a.on("keyup",utils.debounce(async()=>{const l=a.val(),f=await h.get(`/search/chats/${r}/users`,{query:l});s(f)},200))},p}.apply(y,u),_!==void 0&&(A.exports=_)}}]);
