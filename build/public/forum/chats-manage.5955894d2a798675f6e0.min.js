"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[62010,99127,56227,34271,13417,1091,49897,34405],{58836:(T,_,u)=>{var g,m;g=[u(49897),u(29930),u(17459),u(34405),u(72513)],m=function(d,f,r,y,E){const l={};l.init=function(e,o){let t;o.on("click",async function(){let n=[];app.user.isAdmin&&({groups:n}=await d.get("/admin/groups"),n.sort((p,x)=>x.system-p.system).map(p=>{const{name:x,displayName:A}=p;return{name:x,displayName:A}}),Array.isArray(ajaxify.data.groups)&&n.forEach(p=>{p.selected=ajaxify.data.groups.includes(p.name)}));const a=await app.parseAndTranslate("modals/manage-room",{groups:n,user:app.user,room:ajaxify.data});t=bootbox.dialog({title:"[[modules:chat.manage-room]]",size:"large",message:a,onEscape:!0}),t.attr("component","chat/manage-modal"),c(e,t),i(e,t),s(e,t);const v=t.find('[component="chat/manage/user/list"]'),w=t.find('[component="chat/manage/user/list/search"]');E.addSearchHandler(e,w,async p=>{w.val()?v.html(await app.parseAndTranslate("partials/chats/manage-room-users",p)):c(e,t)}),E.addInfiniteScrollHandler(e,v,async(p,x)=>{p.append(await app.parseAndTranslate("partials/chats/manage-room-users",x))});const D=t.find('[component="chat/manage/user/add/search"]'),h=t.find(".text-danger");y.user(D,function(p,x){h.text(""),d.post(`/chats/${e}/users`,{uids:[x.item.user.uid]}).then(A=>{c(e,t,A),D.val("")}).catch(A=>{r.translate(A.message,function(b){h.text(b)})})}),t.find('[component="chat/manage/save"]').on("click",()=>{const p=t.find('[component="chat/room/notification/setting"]');d.put(`/chats/${e}`,{groups:t.find('[component="chat/room/groups"]').val(),notificationSetting:p.val()}).then(x=>{ajaxify.data.groups=x.groups,ajaxify.data.notificationSetting=x.notificationSetting;const A=x.notificationOptions[0];$('[component="chat/notification/setting"] [data-icon]').first().attr("data-icon",A.icon),$('[component="chat/notification/setting/sub-label"]').translateText(A.subLabel),A.selected&&$('[component="chat/notification/setting/icon"]').attr("class",`fa ${A.icon}`),t.modal("hide")}).catch(f.error)})})};function i(e,o){o.on("click",'[data-action="kick"]',function(){const t=parseInt(this.getAttribute("data-uid"),10);d.del(`/chats/${e}/users/${t}`,{}).then(n=>{c(e,o,n)}).catch(f.error)})}function s(e,o){o.on("click",'[data-action="toggleOwner"]',async function(){const t=parseInt(this.getAttribute("data-uid"),10),n=o.get(0).querySelector(`[component="chat/manage/user/list"] > [data-uid="${t}"] [component="chat/manage/user/owner/icon"]`),a=!n.classList.contains("hidden");await d[a?"del":"put"](`/chats/${e}/owners/${t}`),n.classList.toggle("hidden")})}async function c(e,o,t){const n=o.find('[component="chat/manage/user/list"]');if(!t)try{t=await d.get(`/chats/${e}/users`,{})}catch{n.find("li").text(await r.translate("[[error:invalid-data]]"))}n.find('[data-bs-toggle="tooltip"]').tooltip("dispose"),n.html(await app.parseAndTranslate("partials/chats/manage-room-users",t)),n.find('[data-bs-toggle="tooltip"]').tooltip()}return l}.apply(_,g),m!==void 0&&(T.exports=m)},72513:(T,_,u)=>{var g,m;g=[u(49897)],m=function(d){const f={};let r=0;f.init=function(i,s){const c=s.find('[component="chat/user/list"]');if(!c.length)return;const e=s.find('[component="chat/messages/pinned/container"]');s.find('[component="chat/user/list/btn"]').on("click",()=>{c.toggleClass("hidden"),c.hasClass("hidden")?E():(e.addClass("hidden"),y(i,c))}),$(window).off("action:ajaxify.start",E).one("action:ajaxify.start",E),f.addInfiniteScrollHandler(i,c,async(o,t)=>{o.append(await app.parseAndTranslate("partials/chats/user-list","users",t))})};function y(i,s){r&&clearInterval(r),r=setInterval(()=>{l(i,s)},5e3)}function E(){r&&(clearInterval(r),r=0)}async function l(i,s){if(ajaxify.data.template.chats&&app.isFocused&&s.scrollTop()===0&&!s.hasClass("hidden")){const c=await d.get(`/chats/${i}/users`,{start:0});s.find('[data-bs-toggle="tooltip"]').tooltip("dispose"),s.html(await app.parseAndTranslate("partials/chats/user-list","users",c)),s.find('[data-bs-toggle="tooltip"]').tooltip()}}return f.addInfiniteScrollHandler=function(i,s,c){s.on("scroll",utils.debounce(async()=>{const e=(s[0].scrollHeight-s.height())*.85;if(s.scrollTop()>e){const o=s.find("[data-index]").last().attr("data-index"),t=await d.get(`/chats/${i}/users`,{start:parseInt(o,10)+1});t&&t.users.length&&c(s,t)}},200))},f.addSearchHandler=function(i,s,c){s.on("keyup",utils.debounce(async()=>{const e=s.val(),o=await d.get(`/search/chats/${i}/users`,{query:e});c(o)},200))},f}.apply(_,g),m!==void 0&&(T.exports=m)},49897:(T,_,u)=>{u.r(_),u.d(_,{del:()=>o,get:()=>l,head:()=>i,patch:()=>c,post:()=>s,put:()=>e});var g=u(91749),m=u.n(g),d=u(40027),f=u.n(d);const r=config.relative_path+"/api/v3";async function y(t,n){if(t.url=t.url.startsWith("/api")?config.relative_path+t.url:r+t.url,typeof n=="function"){E(t).then(a=>n(null,a),a=>n(a));return}try{return await E(t)}catch(a){if(a.message==="A valid login session was not found. Please log in and try again."){const{url:v}=await(0,g.fire)("filter:admin.reauth",{url:"login"});return(0,d.confirm)("[[error:api.reauth-required]]",w=>{w&&ajaxify.go(v)})}throw a}}async function E(t){const{url:n}=t;delete t.url,t.data&&!(t.data instanceof FormData)&&(t.data=JSON.stringify(t.data||{}),t.headers["content-type"]="application/json; charset=utf-8"),{options:t}=await(0,g.fire)("filter:api.options",{options:t}),t.data&&(t.body=t.data,delete t.data);const a=await fetch(n,t),{headers:v}=a,w=v.get("content-type"),D=w&&w.startsWith("application/json");let h;if(t.method!=="HEAD"&&(D?h=await a.json():h=await a.text()),!a.ok)throw h?new Error(D?h.status.message:h):new Error(a.statusText);return D&&h&&h.hasOwnProperty("status")&&h.hasOwnProperty("response")?h.response:h}function l(t,n,a){return y({url:t+(n&&Object.keys(n).length?"?"+$.param(n):"")},a)}function i(t,n,a){return y({url:t+(n&&Object.keys(n).length?"?"+$.param(n):""),method:"HEAD"},a)}function s(t,n,a){return y({url:t,method:"POST",data:n,headers:{"x-csrf-token":config.csrf_token}},a)}function c(t,n,a){return y({url:t,method:"PATCH",data:n,headers:{"x-csrf-token":config.csrf_token}},a)}function e(t,n,a){return y({url:t,method:"PUT",data:n,headers:{"x-csrf-token":config.csrf_token}},a)}function o(t,n,a){return y({url:t,method:"DELETE",data:n,headers:{"x-csrf-token":config.csrf_token}},a)}},34405:(T,_,u)=>{var g,m;g=[u(49897),u(29930)],m=function(d,f){const r={},y={delay:200,appendTo:null};r.init=l=>{const i={...y,...l},{input:s,onSelect:c}=i;app.loadJQueryUI(function(){s.autocomplete({...i,open:function(){$(this).autocomplete("widget").css("z-index",100005)},select:function(e,o){E(s,c,e,o)}})})},r.user=function(l,i,s){typeof i=="function"&&(s=i,i={}),i=i||{},r.init({input:l,onSelect:s,source:(c,e)=>{i.query=c.term,d.get("/api/users",i,function(o,t){if(o)return f.error(o);if(t&&t.users){const n=t.users.map(function(a){const v=$("<div></div>").html(a.username).text();return a&&{label:v,value:v,user:{uid:a.uid,name:a.username,slug:a.userslug,username:a.username,userslug:a.userslug,picture:a.picture,banned:a.banned,"icon:text":a["icon:text"],"icon:bgColor":a["icon:bgColor"]}}});e(n)}$(".ui-autocomplete a").attr("data-ajaxify","false")})}})},r.group=function(l,i){r.init({input:l,onSelect:i,source:(s,c)=>{socket.emit("groups.search",{query:s.term},function(e,o){if(e)return f.error(e);if(o&&o.length){const t=o.map(function(n){return n&&{label:n.name,value:n.name,group:n}});c(t)}$(".ui-autocomplete a").attr("data-ajaxify","false")})}})},r.tag=function(l,i){r.init({input:l,onSelect:i,delay:100,source:(s,c)=>{socket.emit("topics.autocompleteTags",{query:s.term,cid:ajaxify.data.cid||0},function(e,o){if(e)return f.error(e);o&&c(o),$(".ui-autocomplete a").attr("data-ajaxify","false")})}})};function E(l,i,s,c){i=i||function(){};const e=jQuery.Event("keypress");e.which=13,e.keyCode=13,setTimeout(function(){l.trigger(e)},100),i(s,c)}return r}.apply(_,g),m!==void 0&&(T.exports=m)}}]);
