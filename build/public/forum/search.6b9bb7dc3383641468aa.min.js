"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[48201,99127,34271,51831,69185,1091,92717,26174,87212,26874,49897],{70187:(F,D,u)=>{var C,g;C=[u(69749),u(68636),u(91749),u(29930),u(49897),u(17459),u(39259),u(64308)],g=function(m,E,d,v,A,s,o,f){const n={};let l=[],r=[],e=[],t={};n.init=function(){const c=$("#search-in");c.on("change",function(){S(c.val())});const h=$("#results").attr("data-search-query");m.highlightMatches(h,$(".search-results .content p, .search-results .topic-title")),$("#advanced-search form").off("submit").on("submit",function(a){return a.preventDefault(),m.query(w()),!1}),k(),P(ajaxify.data.selectedCids),R($('[component="user/filter"]'),ajaxify.data.userFilterSelected),B($('[component="tag/filter"]'),ajaxify.data.tagFilterSelected),$('[component="search/filters"]').on("hidden.bs.dropdown",".dropdown",function(){const a={replies:x,time:y,sort:p,tag:i};a[$(this).attr("data-filter-name")]&&a[$(this).attr("data-filter-name")]();const T=w();JSON.stringify(t)!==JSON.stringify(T)&&(t=T,m.query(t))}),O(),y(),x(),p(),t=w()};function i(){const c=r.length>0;let h="[[search:tags]]";r.length&&(h=s.compile("search:tags-x",r.map(a=>a.valueEscaped).join(", "))),$('[component="tag/filter/button"]').toggleClass("active-filter",c).find(".filter-label").translateText(h)}function y(){const c=$("#post-time-range").val()>0;$("#post-time-button").toggleClass("active-filter",c).find(".filter-label").translateText(c?`[[search:time-${$("#post-time-filter").val()}-than-${$("#post-time-range").val()}]]`:"[[search:time]]")}function p(){const c=$("#post-sort-by").val()!=="relevance"||$("#post-sort-direction").val()!=="desc";$("#sort-by-button").toggleClass("active-filter",c).find(".filter-label").translateText(c?`[[search:sort-by-${$("#post-sort-by").val()}-${$("#post-sort-direction").val()}]]`:"[[search:sort]]")}function x(){const c=$("#reply-count").val()>0;$("#reply-count-button").toggleClass("active-filter",c).find(".filter-label").translateText(c?`[[search:replies-${$("#reply-count-filter").val()}-count, ${$("#reply-count").val()}]]`:"[[search:replies]]")}function w(){const c=$("#advanced-search"),h={in:$("#search-in").val()};return h.term=$("#search-input").val(),["posts","titlesposts","titles","bookmarks"].includes(h.in)&&(h.matchWords=c.find("#match-words-filter").val(),h.by=l.length?l.map(a=>a.username):void 0,h.categories=e.length?e:void 0,h.searchChildren=c.find("#search-children").is(":checked"),h.hasTags=r.length?r.map(a=>a.value):void 0,h.replies=c.find("#reply-count").val(),h.repliesFilter=c.find("#reply-count-filter").val(),h.timeFilter=c.find("#post-time-filter").val(),h.timeRange=c.find("#post-time-range").val(),h.sortBy=c.find("#post-sort-by").val(),h.sortDirection=c.find("#post-sort-direction").val(),h.showAs=c.find("#show-results-as").val()),d.fire("action:search.getSearchDataFromDOM",{form:c,data:h}),h}function S(c){const h=!["posts","titles","bookmarks"].some(a=>c.includes(a));$(".post-search-item").toggleClass("hidden",h)}function O(){const c=utils.params({disableToType:!0}),h=m.getSearchPreferences(),a=utils.merge(h,c);a&&(ajaxify.data.term&&$("#search-input").val(ajaxify.data.term),a.in=a.in||ajaxify.data.searchDefaultIn,$("#search-in").val(a.in),S(a.in),a.matchWords&&$("#match-words-filter").val(a.matchWords),a.showAs&&$("#show-results-as").val(a.showAs),a.by&&(a.by=Array.isArray(a.by)?a.by:[a.by],a.by.forEach(function(T){$("#posted-by-user").tagsinput("add",T)})),a.categories&&$("#posted-in-categories").val(a.categories),a.searchChildren&&$("#search-children").prop("checked",!0),a.hasTags&&(a.hasTags=Array.isArray(a.hasTags)?a.hasTags:[a.hasTags],a.hasTags.forEach(function(T){$("#has-tags").tagsinput("add",T)})),a.replies&&($("#reply-count").val(a.replies),$("#reply-count-filter").val(a.repliesFilter)),a.timeRange&&($("#post-time-range").val(a.timeRange),$("#post-time-filter").val(a.timeFilter)),(a.sortBy||ajaxify.data.searchDefaultSortBy)&&$("#post-sort-by").val(a.sortBy||ajaxify.data.searchDefaultSortBy),$("#post-sort-direction").val(a.sortDirection||"desc"),d.fire("action:search.fillOutForm",{form:a}))}function k(){$("#save-preferences").on("click",function(){const c=w(),h=["matchWords","in","showAs","replies","repliesFilter","timeFilter","timeRange","sortBy","sortDirection"],a={};return h.forEach(T=>{a[T]=c[T]}),E.setItem("search-preferences",JSON.stringify(a)),v.success("[[search:search-preferences-saved]]"),!1}),$("#clear-preferences").on("click",async function(){E.removeItem("search-preferences");const c=await app.parseAndTranslate("partials/search-filters",{});return $('[component="search/filters"]').replaceWith(c),$("#search-in").val(ajaxify.data.searchDefaultIn),$("#post-sort-by").val(ajaxify.data.searchDefaultSortBy),$("#match-words-filter").val("all"),$("#show-results-as").val("posts"),R($('[component="user/filter"]'),[]),B($('[component="tag/filter"]'),[]),P([]),v.success("[[search:search-preferences-cleared]]"),!1})}function P(c){ajaxify.data.allCategoriesUrl="",e=c||[];const h=$('[component="category/filter"]');o.init(h,{selectedCids:c,updateButton:!1,onHidden:async function(a){const T=a.selectedCids.length>0&&a.selectedCids[0]!=="all";let j="[[search:categories]]";if(ajaxify.data.selectedCids=a.selectedCids,e=a.selectedCids,a.selectedCids.length===1&&a.selectedCids[0]==="watched")ajaxify.data.selectedCategory={cid:"watched"},j="[[search:categories-watched-categories]]";else if(a.selectedCids.length===1&&a.selectedCids[0]==="all")ajaxify.data.selectedCategory=null;else if(a.selectedCids.length>0){const b=await A.get(`/categories/${a.selectedCids[0]}`);ajaxify.data.selectedCategory=b,j=`[[search:categories-x, ${b.name}]]`}a.selectedCids.length>1&&(j=`[[search:categories-x, ${a.selectedCids.length}]]`),$('[component="category/filter/button"]').toggleClass("active-filter",T).find(".filter-label").translateText(j)},localCategories:[{cid:"watched",name:"[[category:watched-categories]]",icon:""}]})}function R(c,h){l=h||[],f.init(c,{selectedUsers:h,template:"partials/search-filters",onSelect:function(a){l=a},onHidden:function(a){const T=a.length>0;let j="[[search:posted-by]]";T&&(j=s.compile("search:posted-by-usernames",l.map(b=>b.username).join(", "))),c.find('[component="user/filter/button"]').toggleClass("active-filter",T).find(".filter-label").translateText(j)}})}function B(c,h){r=h;async function a(){const b=await app.parseAndTranslate("partials/search-filters","tagFilterSelected",{tagFilterSelected:r});c.find('[component="tag/filter/selected"]').html(b)}function T(b){const I=utils.escapeHTML(b);return{value:b,valueEscaped:I,valueEncoded:encodeURIComponent(I),class:I.replace(/\s/g,"-")}}async function j(){let b={tags:[]};const I=c.find('[component="tag/filter/search"]').val();if(I&&I.length>1&&(app.user.privileges["search:tags"]?b=await socket.emit("topics.searchAndLoadTags",{query:I}):b={tags:[T(I)]}),!b.tags.length){c.find('[component="tag/filter/results"]').translateHtml("[[tags:no-tags-found]]");return}b.tags=b.tags.slice(0,20);const L={};b.tags.forEach(_=>{L[_.valueEscaped]=_});const M=await app.parseAndTranslate("partials/search-filters","tagFilterResults",{tagFilterResults:b.tags});c.find('[component="tag/filter/results"]').html(M),c.find('[component="tag/filter/results"] [data-tag]').on("click",async function(){r.push(L[$(this).attr("data-tag")]),a()})}c.find('[component="tag/filter/search"]').on("keyup",utils.debounce(function(){app.user.privileges["search:tags"]&&j()},1e3)),c.on("click",'[component="tag/filter/delete"]',function(){const b=$(this).attr("data-tag");r=r.filter(I=>I.valueEscaped!==b),a()}),c.find('[component="tag/filter/search"]').on("keyup",b=>{if(b.key==="Enter"&&!app.user.privileges["search:tags"]){const I=c.find('[component="tag/filter/search"]').val();I&&r.every(L=>L.value!==I)&&(r.push(T(I)),a()),c.find('[component="tag/filter/search"]').val("")}}),c.on("shown.bs.dropdown",function(){c.find('[component="tag/filter/search"]').trigger("focus")})}return n}.apply(D,C),g!==void 0&&(F.exports=g)},49897:(F,D,u)=>{u.r(D),u.d(D,{del:()=>r,get:()=>s,head:()=>o,patch:()=>n,post:()=>f,put:()=>l});var C=u(91749),g=u.n(C),m=u(40027),E=u.n(m);const d=config.relative_path+"/api/v3";async function v(e,t){if(e.url=e.url.startsWith("/api")?config.relative_path+e.url:d+e.url,typeof t=="function"){A(e).then(i=>t(null,i),i=>t(i));return}try{return await A(e)}catch(i){if(i.message==="A valid login session was not found. Please log in and try again."){const{url:y}=await(0,C.fire)("filter:admin.reauth",{url:"login"});return(0,m.confirm)("[[error:api.reauth-required]]",p=>{p&&ajaxify.go(y)})}throw i}}async function A(e){const{url:t}=e;delete e.url,e.data&&!(e.data instanceof FormData)&&(e.data=JSON.stringify(e.data||{}),e.headers["content-type"]="application/json; charset=utf-8"),{options:e}=await(0,C.fire)("filter:api.options",{options:e}),e.data&&(e.body=e.data,delete e.data);const i=await fetch(t,e),{headers:y}=i,p=y.get("content-type"),x=p&&p.startsWith("application/json");let w;if(e.method!=="HEAD"&&(x?w=await i.json():w=await i.text()),!i.ok)throw w?new Error(x?w.status.message:w):new Error(i.statusText);return x&&w&&w.hasOwnProperty("status")&&w.hasOwnProperty("response")?w.response:w}function s(e,t,i){return v({url:e+(t&&Object.keys(t).length?"?"+$.param(t):"")},i)}function o(e,t,i){return v({url:e+(t&&Object.keys(t).length?"?"+$.param(t):""),method:"HEAD"},i)}function f(e,t,i){return v({url:e,method:"POST",data:t,headers:{"x-csrf-token":config.csrf_token}},i)}function n(e,t,i){return v({url:e,method:"PATCH",data:t,headers:{"x-csrf-token":config.csrf_token}},i)}function l(e,t,i){return v({url:e,method:"PUT",data:t,headers:{"x-csrf-token":config.csrf_token}},i)}function r(e,t,i){return v({url:e,method:"DELETE",data:t,headers:{"x-csrf-token":config.csrf_token}},i)}},39259:(F,D,u)=>{var C,g;C=[u(96349),u(49897),u(91749)],g=function(m,E,d){const v={};v.init=function(s,o){if(!s||!s.length)return;o=o||{},o.states=o.states||["watching","tracking","notwatching","ignoring"],o.template=o.template||"partials/category/filter-dropdown-left",d.fire("action:category.filter.options",{el:s,options:o}),m.init(s,o);let f=[],n=[];Array.isArray(o.selectedCids)?f=o.selectedCids.map(String):Array.isArray(ajaxify.data.selectedCids)&&(f=ajaxify.data.selectedCids.map(String)),n=f.slice(),s.on("hidden.bs.dropdown",function(){let l=n.length!==f.length;if(n.forEach(function(r,e){r!==f[e]&&(l=!0)}),n=f.slice(),l&&(o.updateButton?o.updateButton({el:s,changed:l,selectedCids:f.slice()}):o.updateButton!==!1&&A(s,f)),o.onHidden){o.onHidden({changed:l,selectedCids:f.slice()});return}if(l){let r=window.location.pathname;const e=utils.params();f.length?e.cid=f:delete e.cid,delete e.page,Object.keys(e).length&&(r+="?"+decodeURIComponent($.param(e))),ajaxify.go(r)}}),s.on("click",'[component="category/list"] [data-cid]',function(l){const r=s.find('[component="category/list"]'),e=$(this),t=e.find("a").attr("href");if(t&&t!=="#"&&t.length){l.stopPropagation();return}const i=e.attr("data-cid"),y=e.find('[component="category/select/icon"]');return i!=="all"?(f.includes(i)?f.splice(f.indexOf(i),1):f.push(i),f.sort(function(p,x){return p-x}),y.toggleClass("invisible"),r.find('[data-cid="all"] i').toggleClass("invisible",!!f.length)):(s.find('[component="category/select/icon"]').addClass("invisible"),r.find('[data-cid="all"] i').removeClass("invisible"),f=[]),o.selectedCids=f,o.onSelect&&o.onSelect({cid:i,selectedCids:f.slice()}),!1})};function A(s,o){o.length>1?f({icon:"fa-plus",name:"[[unread:multiple-categories-selected]]",bgColor:"#ddd"}):o.length===1?E.get(`/categories/${o[0]}`,{}).then(f):f();function f(n){app.parseAndTranslate("partials/category/filter-dropdown-content",{selectedCategory:n},function(l){s.find("button").replaceWith($("<div/>").html(l).find("button"))})}}return v}.apply(D,C),g!==void 0&&(F.exports=g)},96349:(F,D,u)=>{var C,g;C=[u(29930),u(89336),u(49897)],g=function(m,E,d){const v={};return v.init=function(A,s){let o=null;s=s||{},s.privilege=s.privilege||"topics:read",s.states=s.states||["watching","tracking","notwatching","ignoring"],s.cacheList=s.hasOwnProperty("cacheList")?s.cacheList:!0;let f=[];Array.isArray(s.localCategories)&&(f=s.localCategories.map(t=>({...t}))),s.selectedCids=s.selectedCids||ajaxify.data.selectedCids||[];const n=A.find('[component="category-selector-search"]');if(!n.length)return;const l=n.parent('[component="category/dropdown"]').length>0||n.parent('[component="category-selector"]').length>0;A.on("show.bs.dropdown",function(){l&&(A.find(".dropdown-toggle").css({visibility:"hidden"}),n.removeClass("hidden"),n.css({"z-index":A.find(".dropdown-toggle").css("z-index")+1}));function t(){const i=n.find("input").val();i.length>1||!i&&!o?r(i,function(y){o=s.cacheList&&(o||y),e(y)}):!i&&o&&e(o)}n.on("click",function(i){i.preventDefault(),i.stopPropagation()}),n.find("input").val("").on("keyup",utils.debounce(t,300)),t()}),A.on("shown.bs.dropdown",function(){["xs","sm"].includes(utils.findBootstrapEnvironment())||n.find("input").focus()}),A.on("hide.bs.dropdown",function(){l&&(A.find(".dropdown-toggle").css({visibility:"inherit"}),n.addClass("hidden")),n.off("click"),n.find("input").off("keyup")});function r(t,i){d.get("/search/categories",{search:t,query:utils.params(),parentCid:s.parentCid||0,selectedCids:s.selectedCids,privilege:s.privilege,states:s.states,showLinks:s.showLinks},function(y,{categories:p}){if(y)return m.error(y);i(f.concat(p))})}function e(t){const i=s.selectedCids.map(String);t.forEach(function(y){y.selected=i.includes(String(y.cid))}),app.parseAndTranslate(s.template,{categoryItems:t.slice(0,200),selectedCategory:ajaxify.data.selectedCategory,allCategoriesUrl:ajaxify.data.allCategoriesUrl},function(y){A.find('[component="category/list"]').html(y.find('[component="category/list"]').html()),A.find('[component="category/list"] [component="category/no-matches"]').toggleClass("hidden",!!t.length);const p=E.Dropdown.getInstance(A.find(".dropdown-toggle").get(0));p&&p.update()})}},v}.apply(D,C),g!==void 0&&(F.exports=g)},69749:(F,D,u)=>{var C,g;C=[u(17459),u(68636),u(91749),u(29930),u(89336)],g=function(m,E,d,v,A){const s={current:{}};s.init=function(n){if(!config.searchEnabled)return;n=n||{in:config.searchDefaultInQuick||"titles"},$('[component="search/form"]').each((r,e)=>{o($(e),n)})};function o(n,l){const r=n.find('[component="search/button"]'),e=n.find('[component="search/fields"]'),t=e.find('input[name="query"]'),i=e.find("#quick-search-container");e.hasClass("hidden")&&t.off("blur").on("blur",function(){setTimeout(function(){t.is(":focus")||(e.addClass("hidden"),r.removeClass("hidden"))},200)}),t.off("focus");const p={inputEl:t,resultEl:i};s.enableQuickSearch({searchOptions:l,searchElements:p}),r.off("click").on("click",function(x){return!config.loggedIn&&!app.user.privileges["search:content"]?(v.alert({message:"[[error:search-requires-login]]",timeout:3e3}),ajaxify.go("login"),!1):(x.stopPropagation(),s.showAndFocusInput(n),!1)}),n.off("submit").on("submit",function(){const x=$(this).find('input[name="query"]'),w=s.getSearchPreferences();return w.term=x.val(),w.in=l.in,d.fire("action:search.submit",{searchOptions:w,searchElements:p}),s.query(w,function(){x.val(""),t.trigger("blur")}),!1})}s.enableQuickSearch=function(n){if(!config.searchEnabled||!app.user.privileges["search:content"])return;const l=Object.assign({in:config.searchDefaultInQuick||"titles"},n.searchOptions),r=n.searchElements.resultEl,e=n.searchElements.inputEl;let t=e.val();const i=r.find(".filter-category");function y(){ajaxify.data.template.category&&ajaxify.data.cid&&m.translate("[[search:search-in-category, "+ajaxify.data.name+"]]",function(S){const O=$("<div></div>").html(S).text();i.find(".name").text(O)}),i.toggleClass("hidden",!(ajaxify.data.template.category&&ajaxify.data.cid))}function p(){n.searchOptions=Object.assign({},l),n.searchOptions.term=e.val(),y(),ajaxify.data.template.category&&ajaxify.data.cid&&i.find('input[type="checkbox"]').is(":checked")&&(n.searchOptions.categories=[ajaxify.data.cid],n.searchOptions.searchChildren=!0),n.hideDuringSearch||(r.removeClass("hidden").find(".quick-search-results-container").html(""),r.find(".loading-indicator").removeClass("hidden")),d.fire("action:search.quick.start",n),n.searchOptions.searchOnly=1,s.api(n.searchOptions,function(S){if(r.find(".loading-indicator").addClass("hidden"),!S.posts||n.hideOnNoMatches&&!S.posts.length)return r.addClass("hidden").find(".quick-search-results-container").html("");S.posts.forEach(function(O){const k=$("<div>"+O.content+"</div>").text(),P=e.val().toLowerCase().replace(/^in:topic-\d+/,""),R=Math.max(0,k.toLowerCase().indexOf(P)-40);O.snippet=utils.escapeHTML((R>0?"...":"")+k.slice(R,R+80)+(k.length-R>80?"...":""))}),S.dropdown={maxWidth:"400px",maxHeight:"500px",...n.dropdown},app.parseAndTranslate("partials/quick-search-results",S,function(O){O.length&&O.find(".timeago").timeago(),r.toggleClass("hidden",!O.length||!e.is(":focus")).find(".quick-search-results-container").html(O.length?O:"");const k=r.find(".quick-search-results .quick-search-title, .quick-search-results .snippet");s.highlightMatches(n.searchOptions.term,k),d.fire("action:search.quick.complete",{data:S,options:n})})})}r.find('.filter-category input[type="checkbox"]').on("change",function(){e.focus(),p()}),e.off("keyup").on("keyup",utils.debounce(function(){if(e.val().length<3){r.addClass("hidden"),t=e.val();return}if(e.val()!==t){if(t=e.val(),!e.is(":focus"))return r.addClass("hidden");p()}},500));let x=!1;r.on("mousedown",".quick-search-results > *",function(){$(window).one("mouseup",function(){r.addClass("hidden")}),x=!0}),e.on("blur",function(){setTimeout(function(){!e.is(":focus")&&!x&&!r.hasClass("hidden")&&r.addClass("hidden")},200)});let w=!1;d.on("action:ajaxify.end",function(){ajaxify.isCold()||(w=!0)}),e.on("focus",function(){x=!1;const S=e.val();t=S,S&&r.find("#quick-search-results").children().length&&(y(),w?(p(),w=!1):r.removeClass("hidden"),e[0].setSelectionRange(S.startsWith("in:topic")?S.indexOf(" ")+1:0,S.length))}),e.off("refresh").on("refresh",function(){p()})},s.showAndFocusInput=function(n){const l=n.parents(".dropdown-menu");if(l.length){const r=l.siblings("[data-bs-toggle]"),e=A.Dropdown.getOrCreateInstance(r[0]);e&&e.show()}else n.find('[component="search/fields"]').removeClass("hidden"),n.find('[component="search/button"]').addClass("hidden"),n.find('[component="search/fields"] input[name="query"]').trigger("focus")},s.query=function(n,l){l=l||function(){},ajaxify.go("search?"+f(n),l)},s.api=function(n,l){const r=config.relative_path+"/api/search?"+f(n);n.hasOwnProperty("searchOnly")&&delete n.searchOnly;const e=config.relative_path+"/search?"+f(n);$.get(r,function(t){t.url=e,l(t)})};function f(n){const l=n.in||"titles";let r=n.term.replace(/^[ ?#]*/,"");try{r=encodeURIComponent(r)}catch{return v.error("[[error:invalid-search-term]]")}const e={...n,term:r,in:l};return d.fire("action:search.createQueryString",{query:e,data:n}),decodeURIComponent($.param(e))}return s.getSearchPreferences=function(){try{return JSON.parse(E.getItem("search-preferences")||"{}")}catch{return{}}},s.highlightMatches=function(n,l){if(!n||!l.length)return;n=utils.escapeHTML(n.replace(/^"/,"").replace(/"$/,"").trim());const r=n.split(" ").filter(t=>t.length>1).map(function(t){return utils.escapeRegexChars(t)}).join("|"),e=new RegExp("("+r+")","gi");l.each(function(){const t=$(this),i=[];t.find("*").each(function(){$(this).after("<!-- "+i.length+" -->"),i.push($("<div></div>").append($(this)))}),t.html(t.html().replace(e,function(y,p){return'<strong class="search-match fw-bold text-decoration-underline">'+p+"</strong>"})),i.forEach(function(y,p){t.html(t.html().replace("<!-- "+p+" -->",function(){return y.html()}))})}),$(".search-result-text").find("img:not(.not-responsive)").addClass("img-fluid")},s}.apply(D,C),g!==void 0&&(F.exports=g)},13230:(F,D,u)=>{var C,g,m;(function(E){g=[u(53050)],C=E,m=typeof C=="function"?C.apply(D,g):C,m!==void 0&&(F.exports=m)})(function(E){const d=E("[^\\p{L}\\s\\d\\-_]","g"),v=/[^\w\s\d\-_]/g,A=/^\s+|\s+$/g,s=/\s+/g,o=/-+/g,f=/-$/g,n=/^-/g,l=/^[\w\d\s.,\-@]+$/;return function(e,t){return e?(e=String(e).replace(A,""),l.test(e)?e=e.replace(v,"-"):e=E.replace(e,d,"-"),e=t?e:e.toLocaleLowerCase(),e=e.replace(s,"-"),e=e.replace(o,"-"),e=e.replace(f,""),e=e.replace(n,""),e):""}})},68636:(F,D,u)=>{var C;C=function(){function g(){this._store={},this._keys=[]}g.prototype.isMock=!0,g.prototype.setItem=function(d,v){d=String(d),this._keys.indexOf(d)===-1&&this._keys.push(d),this._store[d]=v},g.prototype.getItem=function(d){return d=String(d),this._keys.indexOf(d)===-1?null:this._store[d]},g.prototype.removeItem=function(d){d=String(d),this._keys=this._keys.filter(function(v){return v!==d}),this._store[d]=null},g.prototype.clear=function(){this._keys=[],this._store={}},g.prototype.key=function(d){return d=parseInt(d,10)||0,this._keys[d]},Object.defineProperty&&Object.defineProperty(g.prototype,"length",{get:function(){return this._keys.length}});let m;const E=Date.now().toString();try{if(m=window.localStorage,m.setItem(E,E),m.getItem(E)!==E)throw Error("localStorage behaved unexpectedly");return m.removeItem(E),m}catch(d){console.warn(d),console.warn("localStorage failed, falling back on sessionStorage");try{if(m=window.sessionStorage,m.setItem(E,E),m.getItem(E)!==E)throw Error("sessionStorage behaved unexpectedly");return m.removeItem(E),m}catch(v){return console.warn(v),console.warn("sessionStorage failed, falling back on memory storage"),new g}}}.call(D,u,D,F),C!==void 0&&(F.exports=C)},64308:(F,D,u)=>{var C,g;C=[u(49897),u(91749),u(13230),u(81335)],g=function(m,E,d,v){const A={};return A.init=function(s,o){if(!s||!s.length)return;o=o||{};let f,n=[];o.selectedUsers&&(n=o.selectedUsers.map(t=>({...t}))),E.fire("action:user.filter.options",{el:s,options:o});async function l(){const t=o.selectedBlock||"userFilterSelected",i={};if(t.indexOf(".")!==-1){const p=t.split(".");i[p[0]]={},i[p[0]][p[1]]=n}else i[t]=n;const y=await app.parseAndTranslate(o.template,t,i);s.find('[component="user/filter/selected"]').html(y)}async function r(){await l(),o.onSelect&&o.onSelect(n)}async function e(){let t={users:[]};const i=s.find('[component="user/filter/search"]').val();if(i&&i.length>1)if(app.user.privileges["search:users"])t=await m.get("/api/users",{query:i});else try{const x=await m.get(`/api/user/${d(i)}`);t.users.push(x)}catch{}if(!t.users.length){s.find('[component="user/filter/results"]').translateHtml("[[users:no-users-found]]");return}t.users=t.users.slice(0,20);const y={};t.users.forEach(x=>{y[x.uid]=x});const p=await app.parseAndTranslate(o.template,"userFilterResults",{userFilterResults:t.users});s.find('[component="user/filter/results"]').html(p),s.find('[component="user/filter/results"] [data-uid]').on("click",async function(){const x=parseInt($(this).attr("data-uid"),10);n.find(w=>w.uid===x)||(n.push(y[x]),await r())})}s.find('[component="user/filter/search"]').on("keyup",()=>{s.find('[component="user/filter/results"]').html(f)}),s.find('[component="user/filter/search"]').on("keyup",utils.debounce(function(){app.user.privileges["search:users"]&&e()},1e3)),s.on("click",'[component="user/filter/delete"]',async function(){const t=$(this).attr("data-uid");n=n.filter(i=>parseInt(i.uid,10)!==parseInt(t,10)),await r()}),s.find('[component="user/filter/search"]').on("keyup",t=>{t.key==="Enter"&&!app.user.privileges["search:users"]&&e()}),s.on("shown.bs.dropdown",function(){s.find('[component="user/filter/search"]').trigger("focus")}),s.on("hidden.bs.dropdown",function(){o.onHidden&&o.onHidden(n)}),v.render(o.placeholderTemplate||"partials/userFilter-placeholders").then(t=>{f=t})},A}.apply(D,C),g!==void 0&&(F.exports=g)}}]);
