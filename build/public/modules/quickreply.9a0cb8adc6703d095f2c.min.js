(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[18314,99127,34271,1091,87212,33069,62441,98463,49897],{49897:(h,E,o)=>{"use strict";o.r(E),o.d(E,{del:()=>a,get:()=>r,head:()=>c,patch:()=>t,post:()=>u,put:()=>s});var b=o(91749),m=o.n(b),d=o(40027),g=o.n(d);const n=config.relative_path+"/api/v3";async function f(e,l){if(e.url=e.url.startsWith("/api")?config.relative_path+e.url:n+e.url,typeof l=="function"){A(e).then(i=>l(null,i),i=>l(i));return}try{return await A(e)}catch(i){if(i.message==="A valid login session was not found. Please log in and try again."){const{url:v}=await(0,b.fire)("filter:admin.reauth",{url:"login"});return(0,d.confirm)("[[error:api.reauth-required]]",k=>{k&&ajaxify.go(v)})}throw i}}async function A(e){const{url:l}=e;delete e.url,e.data&&!(e.data instanceof FormData)&&(e.data=JSON.stringify(e.data||{}),e.headers["content-type"]="application/json; charset=utf-8"),{options:e}=await(0,b.fire)("filter:api.options",{options:e}),e.data&&(e.body=e.data,delete e.data);const i=await fetch(l,e),{headers:v}=i,k=v.get("content-type"),y=k&&k.startsWith("application/json");let p;if(e.method!=="HEAD"&&(y?p=await i.json():p=await i.text()),!i.ok)throw p?new Error(y?p.status.message:p):new Error(i.statusText);return y&&p&&p.hasOwnProperty("status")&&p.hasOwnProperty("response")?p.response:p}function r(e,l,i){return f({url:e+(l&&Object.keys(l).length?"?"+$.param(l):"")},i)}function c(e,l,i){return f({url:e+(l&&Object.keys(l).length?"?"+$.param(l):""),method:"HEAD"},i)}function u(e,l,i){return f({url:e,method:"POST",data:l,headers:{"x-csrf-token":config.csrf_token}},i)}function t(e,l,i){return f({url:e,method:"PATCH",data:l,headers:{"x-csrf-token":config.csrf_token}},i)}function s(e,l,i){return f({url:e,method:"PUT",data:l,headers:{"x-csrf-token":config.csrf_token}},i)}function a(e,l,i){return f({url:e,method:"DELETE",data:l,headers:{"x-csrf-token":config.csrf_token}},i)}},74566:(h,E,o)=>{h.exports=o(12236)},449:(h,E,o)=>{h.exports=o(91943)},89596:(h,E,o)=>{h.exports=o(62590)},99594:(h,E,o)=>{h.exports=o(57904)},95692:(h,E,o)=>{"use strict";var b,m;b=[o(52473),o(71431),o(88518),o(49897),o(29930),o(43103),o(6411),o(68636),o(91749)],m=function(d,g,n,f,A,r,c,u,t){const s={};s.init=function(){const e=d.get("topic/quickreply/text"),l=`qr:draft:tid:${ajaxify.data.tid}`,i={element:e,strategies:[],options:{style:{"z-index":100}}};a(),$(window).one("action:ajaxify.start",()=>{a()}),$(window).trigger("composer:autocomplete:init",i),n._active.core_qr=n.setup(i),c.bind("ctrl+return",y=>{y.target===e.get(0)&&d.get("topic/quickreply/button").get(0).click()}),r.init({dragDropAreaEl:$('[component="topic/quickreply/container"] .quickreply-message'),pasteEl:e,uploadFormEl:$('[component="topic/quickreply/upload"]'),inputEl:e,route:"/api/post/upload",callback:function(y){let p=e.val();y.forEach(x=>{p=p+(p?`
`:"")+(x.isImage?"!":"")+`[${x.filename}](${x.url})`}),e.val(p)}});let v=!0;d.get("topic/quickreply/button").on("click",function(y){if(y.preventDefault(),!v)return;const p=d.get("topic/quickreply/text").val(),x={tid:ajaxify.data.tid,handle:void 0,content:p},C=p.length;if(C<parseInt(config.minimumPostLength,10))return A.error("[[error:content-too-short, "+config.minimumPostLength+"]]");if(C>parseInt(config.maximumPostLength,10))return A.error("[[error:content-too-long, "+config.maximumPostLength+"]]");v=!1,f.post(`/topics/${ajaxify.data.tid}`,x,function(D,P){if(v=!0,D)return A.error(D);P&&P.queued&&A.alert({type:"success",title:"[[global:alert.success]]",message:P.message,timeout:1e4,clickfn:function(){ajaxify.go(`/post-queue/${P.id}`)}}),d.get("topic/quickreply/text").val(""),u.removeItem(l),n._active.core_qr.hide(),t.fire("action:quickreply.success",{data:P})})});const k=u.getItem(l);k&&e.val(k),e.on("keyup",utils.debounce(function(){const y=e.val();y?u.setItem(l,y):u.removeItem(l)},1e3)),d.get("topic/quickreply/expand").on("click",y=>{y.preventDefault(),u.removeItem(l);const p=d.get("topic/quickreply/text");g.newReply({tid:ajaxify.data.tid,title:ajaxify.data.titleRaw,body:p.val()}),p.val("")})};function a(){n._active.core_qr&&(n._active.core_qr.destroy(),n._active.core_qr=null)}return s}.apply(E,b),m!==void 0&&(h.exports=m)},68636:(h,E,o)=>{"use strict";var b;b=function(){function m(){this._store={},this._keys=[]}m.prototype.isMock=!0,m.prototype.setItem=function(n,f){n=String(n),this._keys.indexOf(n)===-1&&this._keys.push(n),this._store[n]=f},m.prototype.getItem=function(n){return n=String(n),this._keys.indexOf(n)===-1?null:this._store[n]},m.prototype.removeItem=function(n){n=String(n),this._keys=this._keys.filter(function(f){return f!==n}),this._store[n]=null},m.prototype.clear=function(){this._keys=[],this._store={}},m.prototype.key=function(n){return n=parseInt(n,10)||0,this._keys[n]},Object.defineProperty&&Object.defineProperty(m.prototype,"length",{get:function(){return this._keys.length}});let d;const g=Date.now().toString();try{if(d=window.localStorage,d.setItem(g,g),d.getItem(g)!==g)throw Error("localStorage behaved unexpectedly");return d.removeItem(g),d}catch(n){console.warn(n),console.warn("localStorage failed, falling back on sessionStorage");try{if(d=window.sessionStorage,d.setItem(g,g),d.getItem(g)!==g)throw Error("sessionStorage behaved unexpectedly");return d.removeItem(g),d}catch(f){return console.warn(f),console.warn("sessionStorage failed, falling back on memory storage"),new m}}}.call(E,o,E,h),b!==void 0&&(h.exports=b)},14063:(h,E,o)=>{"use strict";h=o.nmd(h);var b,m;b=[o(17459),o(91749)],m=function(d,g){const n={};let f=!1;n.init=function(){if(n.taskbar=$('[component="taskbar"]'),n.tasklist=n.taskbar.find("ul"),!n.taskbar.length||!n.tasklist.length){f=!0;return}n.taskbar.on("click","li",async function(){const t=$(this),s=t.attr("data-module"),a=t.attr("data-uuid"),e=await app.require(s);return t.hasClass("active")?e.minimize(a):(r(),e.load(a),n.toggleNew(a,!1),n.tasklist.removeClass("active"),t.addClass("active")),!1}),$(window).on("action:app.loggedOut",function(){n.closeAll()})},n.close=async function(t,s){if(f)return;if(n.tasklist.find('[data-module="'+h+'"][data-uuid="'+s+'"]').length){const e=await app.require(t);e&&typeof e.close=="function"&&e.close(s)}},n.closeAll=function(t){if(f)return;let s="[data-uuid]";t&&(s='[data-module="'+t+'"]'+s),n.tasklist.find(s).each(function(a,e){n.close(t||e.getAttribute("data-module"),e.getAttribute("data-uuid"))})},n.discard=function(t,s){if(f)return;n.tasklist.find('[data-module="'+t+'"][data-uuid="'+s+'"]').remove(),A()},n.push=function(t,s,a,e){if(e=e||function(){},f)return e();const l=n.tasklist.find('li[data-uuid="'+s+'"]'),i={module:t,uuid:s,options:a,element:l};g.fire("filter:taskbar.push",i),!l.length&&i.module?c(i,e):e(l)},n.get=function(t){return f?[]:$('[data-module="'+t+'"]').map(function(a,e){return $(e).data()})},n.minimize=function(t,s){if(f)return;n.tasklist.find('[data-module="'+t+'"][data-uuid="'+s+'"]').toggleClass("active",!1)},n.toggleNew=function(t,s,a){if(f)return;n.tasklist.find('[data-uuid="'+t+'"]').toggleClass("new",s),a||g.fire("action:taskbar.toggleNew",t)},n.updateActive=function(t){if(f)return;const s=n.tasklist.find("li");s.removeClass("active"),s.filter('[data-uuid="'+t+'"]').addClass("active"),$("[data-uuid]:not([data-module])").toggleClass("modal-unfocused",!0),$('[data-uuid="'+t+'"]:not([data-module])').toggleClass("modal-unfocused",!1)},n.isActive=function(t){return f?!1:n.tasklist.find('li[data-uuid="'+t+'"]').hasClass("active")};function A(){if(f)return;n.tasklist.find("li").length>0?n.taskbar.attr("data-active","1"):n.taskbar.removeAttr("data-active")}function r(){f||n.tasklist.find(".active").removeClass("active")}function c(t,s){if(f)return s();d.translate(t.options.title,function(a){const e=$("<div></div>").text(a||"NodeBB Task").html(),l=$("<li></li>").addClass(t.options.className).html('<a href="#"'+(t.options.image?` style="background-image: url('`+t.options.image.replace(/&#x2F;/g,"/")+`'); background-size: cover;"`:"")+">"+(t.options.icon?'<i class="fa '+t.options.icon+'"></i> ':"")+'<span aria-label="'+e+'" component="taskbar/title">'+e+"</span></a>").attr({title:e,"data-module":t.module,"data-uuid":t.uuid}).addClass(t.options.state!==void 0?t.options.state:"active");(!t.options.state||t.options.state==="active")&&r(),n.tasklist.append(l),A(),t.element=l,l.data(t),g.fire("action:taskbar.pushed",t),s(l)})}const u=function(t,s,a){switch(s){case"title":t.find('[component="taskbar/title"]').text(a);break;case"icon":t.find("i").attr("class","fa fa-"+a);break;case"image":t.find("a").css("background-image",a?'url("'+a.replace(/&#x2F;/g,"/")+'")':"");break;case"background-color":t.find("a").css("background-color",a);break;case"color":t.find("a").css("color",a);break}};return n.update=function(t,s,a){if(f)return;const e=n.tasklist.find('[data-module="'+t+'"][data-uuid="'+s+'"]');if(!e.length)return;const l=e.data();Object.keys(a).forEach(function(i){l[i]=a[i],u(e,i,a[i])}),e.data(l)},n}.apply(E,b),m!==void 0&&(h.exports=m)},36159:(h,E,o)=>{"use strict";var b,m;b=[o(49897),o(40027),o(29930),o(24187),o(81335),o(17459),o(65285)],m=function(d,g,n,f,A,r){const c={};return c.get=u=>d.get(`/topics/${u}/thumbs`,{}),c.getByPid=u=>d.get(`/posts/${u}`,{}).then(t=>c.get(t.tid)),c.delete=(u,t)=>d.del(`/topics/${u}/thumbs`,{path:t}),c.deleteAll=u=>{c.get(u).then(t=>{Promise.all(t.map(s=>c.delete(u,s.url)))})},c.upload=u=>new Promise(t=>{f.show({title:"[[topic:composer.thumb-title]]",method:"put",route:config.relative_path+`/api/v3/topics/${u}/thumbs`},function(s){t(s)})}),c.modal={},c.modal.open=function(u){const{id:t,pid:s}=u;let{modal:a}=u,e;return new Promise(l=>{Promise.all([c.get(t),s?c.getByPid(s):[]]).then(i=>new Promise(v=>{const k=i.reduce((y,p)=>y.concat(p));e=k.length,v(k)})).then(i=>A.render("modals/topic-thumbs",{thumbs:i})).then(i=>{a?r.translate(i,function(v){a.find(".bootbox-body").html(v),c.modal.handleSort({modal:a,numThumbs:e})}):(a=g.dialog({title:"[[modules:thumbs.modal.title]]",message:i,onEscape:!0,backdrop:!0,buttons:{add:{label:'<i class="fa fa-plus"></i> [[modules:thumbs.modal.add]]',className:"btn-success",callback:()=>(c.upload(t).then(()=>{c.modal.open({...u,modal:a}),Promise.all([o.e(54516),o.e(99166),o.e(47061),o.e(49775)]).then(function(){var v=[o(71431)];(k=>{k.updateThumbCount(t,$(`[component="composer"][data-uuid="${t}"]`)),l()}).apply(null,v)}).catch(o.oe)}),!1)},close:{label:"[[global:close]]",className:"btn-primary"}}}),c.modal.handleDelete({...u,modal:a}),c.modal.handleSort({modal:a,numThumbs:e}))})})},c.modal.handleDelete=u=>{const t=u.modal.get(0),{id:s}=u;t.addEventListener("click",a=>{a.target.closest('button[data-action="remove"]')&&g.confirm("[[modules:thumbs.modal.confirm-remove]]",e=>{if(!e)return;const l=a.target.closest("[data-id]").getAttribute("data-id"),i=a.target.closest("[data-path]").getAttribute("data-path");d.del(`/topics/${l}/thumbs`,{path:i}).then(()=>{c.modal.open(u),Promise.all([o.e(54516),o.e(99166),o.e(47061),o.e(49775)]).then(function(){var v=[o(71431)];(k=>{k.updateThumbCount(s,$(`[component="composer"][data-uuid="${s}"]`))}).apply(null,v)}).catch(o.oe)}).catch(n.error)})})},c.modal.handleSort=({modal:u,numThumbs:t})=>{if(t>1){const s=u.find(".topic-thumbs-modal");s.sortable({items:"[data-id]"}),s.on("sortupdate",c.modal.handleSortChange)}},c.modal.handleSortChange=(u,t)=>{const s=t.item.get(0).parentNode.querySelectorAll("[data-id]");Array.from(s).forEach((a,e)=>{const l=a.getAttribute("data-id");let i=a.getAttribute("data-path");i=i.replace(new RegExp(`^${config.upload_url}`),""),d.put(`/topics/${l}/thumbs/order`,{path:i,order:e}).catch(n.error)})},c}.apply(E,b),m!==void 0&&(h.exports=m)},24187:(h,E,o)=>{"use strict";var b,m;b=[o(64061)],m=function(){const d={};d.show=function(r,c){const u=r.hasOwnProperty("fileSize")&&r.fileSize!==void 0?parseInt(r.fileSize,10):!1;app.parseAndTranslate("modals/upload-file",{showHelp:r.hasOwnProperty("showHelp")&&r.showHelp!==void 0?r.showHelp:!0,fileSize:u,title:r.title||"[[global:upload-file]]",description:r.description||"",button:r.button||"[[global:upload]]",accept:r.accept?r.accept.replace(/,/g,"&#44; "):""},function(t){t.modal("show"),t.on("hidden.bs.modal",function(){t.remove()});const s=t.find("#uploadForm");s.attr("action",r.route),s.find("#params").val(JSON.stringify(r.params)),t.find("#fileUploadSubmitBtn").on("click",function(){$(this).addClass("disabled"),s.submit()}),s.submit(function(){return g(t,u,c),!1})})},d.hideAlerts=function(r){$(r).find("#alert-status, #alert-success, #alert-error, #upload-progress-box").addClass("hide")};function g(r,c,u){n(r,"status","[[uploads:uploading-file]]"),r.find("#upload-progress-bar").css("width","0%"),r.find("#upload-progress-box").show().removeClass("hide");const t=r.find("#fileInput");if(!t.val())return n(r,"error","[[uploads:select-file-to-upload]]");if(!A(t[0],c))return n(r,"error","[[error:file-too-big, "+c+"]]");d.ajaxSubmit(r,u)}function n(r,c,u){d.hideAlerts(r),c==="error"&&r.find("#fileUploadSubmitBtn").removeClass("disabled"),u=u.replace(/&amp;#44/g,"&#44"),r.find("#alert-"+c).translateText(u).removeClass("hide")}d.ajaxSubmit=function(r,c){r.find("#uploadForm").ajaxSubmit({headers:{"x-csrf-token":config.csrf_token},error:function(t){t=f(t),n(r,"error",t.responseJSON?.status?.message||t.responseJSON?.error||`[[error:upload-error-fallback, ${t.status} ${t.statusText}]]`)},uploadProgress:function(t,s,a,e){r.find("#upload-progress-bar").css("width",e+"%")},success:function(t){let s=f(t);t.hasOwnProperty("response")&&t.hasOwnProperty("status")&&t.status.code==="ok"&&(s=t.response.images),c(s[0].url),n(r,"success","[[uploads:upload-success]]"),setTimeout(function(){d.hideAlerts(r),r.modal("hide")},750)}})};function f(r){if(typeof r=="string")try{return JSON.parse(r)}catch{return{error:"[[error:parse-error]]"}}return r}function A(r,c){return window.FileReader&&c?r.files[0].size<=c*1e3:!0}return d}.apply(E,b),m!==void 0&&(h.exports=m)}}]);
