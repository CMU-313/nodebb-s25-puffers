"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[62441,99127,34271,1091,98463,49897],{49897:(S,b,a)=>{a.r(b),a.d(b,{del:()=>u,get:()=>t,head:()=>r,patch:()=>e,post:()=>s,put:()=>l});var g=a(91749),E=a.n(g),c=a(40027),P=a.n(c);const p=config.relative_path+"/api/v3";async function f(n,i){if(n.url=n.url.startsWith("/api")?config.relative_path+n.url:p+n.url,typeof i=="function"){A(n).then(o=>i(null,o),o=>i(o));return}try{return await A(n)}catch(o){if(o.message==="A valid login session was not found. Please log in and try again."){const{url:h}=await(0,g.fire)("filter:admin.reauth",{url:"login"});return(0,c.confirm)("[[error:api.reauth-required]]",m=>{m&&ajaxify.go(h)})}throw o}}async function A(n){const{url:i}=n;delete n.url,n.data&&!(n.data instanceof FormData)&&(n.data=JSON.stringify(n.data||{}),n.headers["content-type"]="application/json; charset=utf-8"),{options:n}=await(0,g.fire)("filter:api.options",{options:n}),n.data&&(n.body=n.data,delete n.data);const o=await fetch(i,n),{headers:h}=o,m=h.get("content-type"),y=m&&m.startsWith("application/json");let d;if(n.method!=="HEAD"&&(y?d=await o.json():d=await o.text()),!o.ok)throw d?new Error(y?d.status.message:d):new Error(o.statusText);return y&&d&&d.hasOwnProperty("status")&&d.hasOwnProperty("response")?d.response:d}function t(n,i,o){return f({url:n+(i&&Object.keys(i).length?"?"+$.param(i):"")},o)}function r(n,i,o){return f({url:n+(i&&Object.keys(i).length?"?"+$.param(i):""),method:"HEAD"},o)}function s(n,i,o){return f({url:n,method:"POST",data:i,headers:{"x-csrf-token":config.csrf_token}},o)}function e(n,i,o){return f({url:n,method:"PATCH",data:i,headers:{"x-csrf-token":config.csrf_token}},o)}function l(n,i,o){return f({url:n,method:"PUT",data:i,headers:{"x-csrf-token":config.csrf_token}},o)}function u(n,i,o){return f({url:n,method:"DELETE",data:i,headers:{"x-csrf-token":config.csrf_token}},o)}},36159:(S,b,a)=>{var g,E;g=[a(49897),a(40027),a(29930),a(24187),a(81335),a(17459),a(65285)],E=function(c,P,p,f,A,t){const r={};return r.get=s=>c.get(`/topics/${s}/thumbs`,{}),r.getByPid=s=>c.get(`/posts/${s}`,{}).then(e=>r.get(e.tid)),r.delete=(s,e)=>c.del(`/topics/${s}/thumbs`,{path:e}),r.deleteAll=s=>{r.get(s).then(e=>{Promise.all(e.map(l=>r.delete(s,l.url)))})},r.upload=s=>new Promise(e=>{f.show({title:"[[topic:composer.thumb-title]]",method:"put",route:config.relative_path+`/api/v3/topics/${s}/thumbs`},function(l){e(l)})}),r.modal={},r.modal.open=function(s){const{id:e,pid:l}=s;let{modal:u}=s,n;return new Promise(i=>{Promise.all([r.get(e),l?r.getByPid(l):[]]).then(o=>new Promise(h=>{const m=o.reduce((y,d)=>y.concat(d));n=m.length,h(m)})).then(o=>A.render("modals/topic-thumbs",{thumbs:o})).then(o=>{u?t.translate(o,function(h){u.find(".bootbox-body").html(h),r.modal.handleSort({modal:u,numThumbs:n})}):(u=P.dialog({title:"[[modules:thumbs.modal.title]]",message:o,onEscape:!0,backdrop:!0,buttons:{add:{label:'<i class="fa fa-plus"></i> [[modules:thumbs.modal.add]]',className:"btn-success",callback:()=>(r.upload(e).then(()=>{r.modal.open({...s,modal:u}),Promise.all([a.e(54516),a.e(99166),a.e(47061),a.e(49775)]).then(function(){var h=[a(71431)];(m=>{m.updateThumbCount(e,$(`[component="composer"][data-uuid="${e}"]`)),i()}).apply(null,h)}).catch(a.oe)}),!1)},close:{label:"[[global:close]]",className:"btn-primary"}}}),r.modal.handleDelete({...s,modal:u}),r.modal.handleSort({modal:u,numThumbs:n}))})})},r.modal.handleDelete=s=>{const e=s.modal.get(0),{id:l}=s;e.addEventListener("click",u=>{u.target.closest('button[data-action="remove"]')&&P.confirm("[[modules:thumbs.modal.confirm-remove]]",n=>{if(!n)return;const i=u.target.closest("[data-id]").getAttribute("data-id"),o=u.target.closest("[data-path]").getAttribute("data-path");c.del(`/topics/${i}/thumbs`,{path:o}).then(()=>{r.modal.open(s),Promise.all([a.e(54516),a.e(99166),a.e(47061),a.e(49775)]).then(function(){var h=[a(71431)];(m=>{m.updateThumbCount(l,$(`[component="composer"][data-uuid="${l}"]`))}).apply(null,h)}).catch(a.oe)}).catch(p.error)})})},r.modal.handleSort=({modal:s,numThumbs:e})=>{if(e>1){const l=s.find(".topic-thumbs-modal");l.sortable({items:"[data-id]"}),l.on("sortupdate",r.modal.handleSortChange)}},r.modal.handleSortChange=(s,e)=>{const l=e.item.get(0).parentNode.querySelectorAll("[data-id]");Array.from(l).forEach((u,n)=>{const i=u.getAttribute("data-id");let o=u.getAttribute("data-path");o=o.replace(new RegExp(`^${config.upload_url}`),""),c.put(`/topics/${i}/thumbs/order`,{path:o,order:n}).catch(p.error)})},r}.apply(b,g),E!==void 0&&(S.exports=E)},24187:(S,b,a)=>{var g,E;g=[a(64061)],E=function(){const c={};c.show=function(t,r){const s=t.hasOwnProperty("fileSize")&&t.fileSize!==void 0?parseInt(t.fileSize,10):!1;app.parseAndTranslate("modals/upload-file",{showHelp:t.hasOwnProperty("showHelp")&&t.showHelp!==void 0?t.showHelp:!0,fileSize:s,title:t.title||"[[global:upload-file]]",description:t.description||"",button:t.button||"[[global:upload]]",accept:t.accept?t.accept.replace(/,/g,"&#44; "):""},function(e){e.modal("show"),e.on("hidden.bs.modal",function(){e.remove()});const l=e.find("#uploadForm");l.attr("action",t.route),l.find("#params").val(JSON.stringify(t.params)),e.find("#fileUploadSubmitBtn").on("click",function(){$(this).addClass("disabled"),l.submit()}),l.submit(function(){return P(e,s,r),!1})})},c.hideAlerts=function(t){$(t).find("#alert-status, #alert-success, #alert-error, #upload-progress-box").addClass("hide")};function P(t,r,s){p(t,"status","[[uploads:uploading-file]]"),t.find("#upload-progress-bar").css("width","0%"),t.find("#upload-progress-box").show().removeClass("hide");const e=t.find("#fileInput");if(!e.val())return p(t,"error","[[uploads:select-file-to-upload]]");if(!A(e[0],r))return p(t,"error","[[error:file-too-big, "+r+"]]");c.ajaxSubmit(t,s)}function p(t,r,s){c.hideAlerts(t),r==="error"&&t.find("#fileUploadSubmitBtn").removeClass("disabled"),s=s.replace(/&amp;#44/g,"&#44"),t.find("#alert-"+r).translateText(s).removeClass("hide")}c.ajaxSubmit=function(t,r){t.find("#uploadForm").ajaxSubmit({headers:{"x-csrf-token":config.csrf_token},error:function(e){e=f(e),p(t,"error",e.responseJSON?.status?.message||e.responseJSON?.error||`[[error:upload-error-fallback, ${e.status} ${e.statusText}]]`)},uploadProgress:function(e,l,u,n){t.find("#upload-progress-bar").css("width",n+"%")},success:function(e){let l=f(e);e.hasOwnProperty("response")&&e.hasOwnProperty("status")&&e.status.code==="ok"&&(l=e.response.images),r(l[0].url),p(t,"success","[[uploads:upload-success]]"),setTimeout(function(){c.hideAlerts(t),t.modal("hide")},750)}})};function f(t){if(typeof t=="string")try{return JSON.parse(t)}catch{return{error:"[[error:parse-error]]"}}return t}function A(t,r){return window.FileReader&&r?t.files[0].size<=r*1e3:!0}return c}.apply(b,g),E!==void 0&&(S.exports=E)}}]);
